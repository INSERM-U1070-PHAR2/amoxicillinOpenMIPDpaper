<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Precision dosing approaches â€“ STP-BRIOCHE : A priori MIPD - Amoxicillin</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Machine_Learning.html" rel="next">
<link href="./Objectives.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-07ba0ad10f5680c660e360ac31d2f3b6.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-98f67bc07761c90b1382d524a234aef8.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Precision_dosing_methods.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Precision dosing approaches</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">STP-BRIOCHE : A priori MIPD - Amoxicillin</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Objectives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Objectives</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Precision_dosing_methods.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Precision dosing approaches</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Machine_Learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Machine learning dose prediction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#generate-predictions-with-each-model" id="toc-generate-predictions-with-each-model" class="nav-link active" data-scroll-target="#generate-predictions-with-each-model"><span class="header-section-number">3</span> Generate predictions with each model</a>
  <ul class="collapse">
  <li><a href="#carlier" id="toc-carlier" class="nav-link" data-scroll-target="#carlier"><span class="header-section-number">3.1</span> CARLIER</a></li>
  <li><a href="#fournier" id="toc-fournier" class="nav-link" data-scroll-target="#fournier"><span class="header-section-number">3.2</span> FOURNIER</a></li>
  <li><a href="#mellon" id="toc-mellon" class="nav-link" data-scroll-target="#mellon"><span class="header-section-number">3.3</span> MELLON</a></li>
  <li><a href="#rambaud" id="toc-rambaud" class="nav-link" data-scroll-target="#rambaud"><span class="header-section-number">3.4</span> RAMBAUD</a></li>
  <li><a href="#pool-all-predictions-and-save-them" id="toc-pool-all-predictions-and-save-them" class="nav-link" data-scroll-target="#pool-all-predictions-and-save-them"><span class="header-section-number">3.5</span> Pool all predictions and save them</a></li>
  <li><a href="#global-inspection-of-model-predictions" id="toc-global-inspection-of-model-predictions" class="nav-link" data-scroll-target="#global-inspection-of-model-predictions"><span class="header-section-number">3.6</span> Global inspection of model predictions</a>
  <ul class="collapse">
  <li><a href="#within-cohort-performance-inter-individual-variability" id="toc-within-cohort-performance-inter-individual-variability" class="nav-link" data-scroll-target="#within-cohort-performance-inter-individual-variability"><span class="header-section-number">3.6.1</span> Within-cohort performance (inter-individual variability)</a></li>
  <li><a href="#full-dataset-performance-model-performance" id="toc-full-dataset-performance-model-performance" class="nav-link" data-scroll-target="#full-dataset-performance-model-performance"><span class="header-section-number">3.6.2</span> Full dataset performance (model performance)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#single-model-approach" id="toc-single-model-approach" class="nav-link" data-scroll-target="#single-model-approach"><span class="header-section-number">4</span> Single model approach</a>
  <ul class="collapse">
  <li><a href="#carlier-1" id="toc-carlier-1" class="nav-link" data-scroll-target="#carlier-1"><span class="header-section-number">4.1</span> CARLIER</a></li>
  <li><a href="#fournier-1" id="toc-fournier-1" class="nav-link" data-scroll-target="#fournier-1"><span class="header-section-number">4.2</span> FOURNIER</a></li>
  <li><a href="#mellon-1" id="toc-mellon-1" class="nav-link" data-scroll-target="#mellon-1"><span class="header-section-number">4.3</span> MELLON</a></li>
  <li><a href="#rambaud-1" id="toc-rambaud-1" class="nav-link" data-scroll-target="#rambaud-1"><span class="header-section-number">4.4</span> RAMBAUD</a></li>
  <li><a href="#meta-model" id="toc-meta-model" class="nav-link" data-scroll-target="#meta-model"><span class="header-section-number">4.5</span> Meta model</a></li>
  </ul></li>
  <li><a href="#standard-dose" id="toc-standard-dose" class="nav-link" data-scroll-target="#standard-dose"><span class="header-section-number">5</span> Standard dose</a></li>
  <li><a href="#uninformed-model-ensembling" id="toc-uninformed-model-ensembling" class="nav-link" data-scroll-target="#uninformed-model-ensembling"><span class="header-section-number">6</span> Uninformed model ensembling</a></li>
  <li><a href="#nomogram" id="toc-nomogram" class="nav-link" data-scroll-target="#nomogram"><span class="header-section-number">7</span> Nomogram</a></li>
  <li><a href="#classification-tree-informed-ensembling" id="toc-classification-tree-informed-ensembling" class="nav-link" data-scroll-target="#classification-tree-informed-ensembling"><span class="header-section-number">8</span> Classification tree informed ensembling</a></li>
  <li><a href="#regression-tree-informed-ensembling" id="toc-regression-tree-informed-ensembling" class="nav-link" data-scroll-target="#regression-tree-informed-ensembling"><span class="header-section-number">9</span> Regression tree informed ensembling</a></li>
  <li><a href="#weighed-model-ensembling" id="toc-weighed-model-ensembling" class="nav-link" data-scroll-target="#weighed-model-ensembling"><span class="header-section-number">10</span> Weighed model ensembling</a>
  <ul class="collapse">
  <li><a href="#model-influence" id="toc-model-influence" class="nav-link" data-scroll-target="#model-influence"><span class="header-section-number">10.0.1</span> Model influence</a></li>
  <li><a href="#subgroup-influence" id="toc-subgroup-influence" class="nav-link" data-scroll-target="#subgroup-influence"><span class="header-section-number">10.0.2</span> Subgroup influence</a></li>
  <li><a href="#score-calculation" id="toc-score-calculation" class="nav-link" data-scroll-target="#score-calculation"><span class="header-section-number">10.0.3</span> Score calculation</a></li>
  </ul></li>
  <li><a href="#factor-analysis-of-mixed-data-famd" id="toc-factor-analysis-of-mixed-data-famd" class="nav-link" data-scroll-target="#factor-analysis-of-mixed-data-famd"><span class="header-section-number">11</span> Factor Analysis of Mixed Data (FAMD)</a></li>
  <li><a href="#method-ensembling" id="toc-method-ensembling" class="nav-link" data-scroll-target="#method-ensembling"><span class="header-section-number">12</span> Method ensembling</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Precision dosing approaches</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"Amoxicillin/MIPD/Precision_dosing_methods.qmd"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load openMIPD package from tar.gz file</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"stp-brioche-R-package/openMIPD_0.0.6.tar.gz"</span>, <span class="at">repos =</span> <span class="cn">NULL</span>, <span class="at">type =</span> <span class="st">"source"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(openMIPD)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mrgsolve)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kernlab)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1991</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="generate-predictions-with-each-model" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Generate predictions with each model</h1>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_OBS_TRAIN <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"Amoxicillin/Data/AMOX_CMIN_OBS_TRAIN.csv"</span>), <span class="at">quote =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEX_CAT =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>      SEX <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"M"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>      SEX <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"F"</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CRCL_CKD_EPI_BSA_NORM =</span> <span class="fu">estimate_GFR</span>(AGE,CREAT,SEX_CAT)) <span class="sc">|&gt;</span> </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CRCL_CKD_EPI_ABSOLUTE =</span> CRCL_CKD_EPI_BSA_NORM <span class="sc">*</span> (BSA<span class="sc">/</span><span class="fl">1.73</span>))</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_OBS_TEST <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"Amoxicillin/Data/AMOX_CMIN_OBS_TEST.csv"</span>), <span class="at">quote =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEX_CAT =</span> <span class="fu">case_when</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>      SEX <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"M"</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>      SEX <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"F"</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CRCL_CKD_EPI_BSA_NORM =</span> <span class="fu">estimate_GFR</span>(AGE,CREAT,SEX_CAT)) <span class="sc">|&gt;</span> </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CRCL_CKD_EPI_ABSOLUTE =</span> CRCL_CKD_EPI_BSA_NORM <span class="sc">*</span> (BSA<span class="sc">/</span><span class="fl">1.73</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>perform_mrgsolve_prediction <span class="ot">&lt;-</span> <span class="cf">function</span>(input_data,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>                                        mrgsolve_model_path,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                                        model_name,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                                        cmin_target) {</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  full_data <span class="ot">&lt;-</span> <span class="fu">select</span>(input_data,<span class="sc">-</span>MODEL) <span class="co">#MODEL column identifies the model with which the prediction was made thus we have to drop it to be able to join later on</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>data_for_mrgsolve <span class="ot">&lt;-</span> input_data <span class="sc">|&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    ID,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    TIME,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    CREAT,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    BURN,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    ICU,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    OBESE,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    AGE,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    SEX,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    HT,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    BSA,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    DOSE_ADM,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    FREQ,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    DUR,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    CMIN_IND,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    MODEL_COHORT</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">distinct</span>()</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>mrgsolve_model <span class="ot">&lt;-</span> <span class="fu">mread_cache</span>(mrgsolve_model_path)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>mrgsolve_dose_data <span class="ot">&lt;-</span> </span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(data_for_mrgsolve,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">AMT =</span> DOSE_ADM,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">II =</span> FREQ</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">|&gt;</span> </span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RATE =</span> AMT<span class="sc">/</span>DUR,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">ADDL =</span> TIME<span class="sc">/</span>II <span class="sc">-</span> <span class="dv">1</span>,</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">TIME =</span> <span class="dv">0</span>,</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">EVID =</span> <span class="dv">1</span>,</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">CMT =</span> <span class="dv">1</span>)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>mrgsolve_obs_data <span class="ot">&lt;-</span> <span class="fu">rename</span>(data_for_mrgsolve,</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">AMT =</span> DOSE_ADM,</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">II =</span> FREQ</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">|&gt;</span> </span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RATE =</span> <span class="cn">NA</span>,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">ADDL =</span> <span class="cn">NA</span>,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>         <span class="at">EVID =</span> <span class="dv">0</span>,</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>         <span class="at">CMT =</span> <span class="dv">1</span>)</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>mrgsolve_input_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(mrgsolve_dose_data,</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>                                        mrgsolve_obs_data) <span class="sc">|&gt;</span> </span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID,<span class="sc">-</span>EVID)</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>mrgsolve_model <span class="sc">|&gt;</span> </span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data_set</span>(mrgsolve_input_data) <span class="sc">|&gt;</span> </span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">zero_re</span>() <span class="sc">|&gt;</span>  </span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mrgsim</span>(<span class="at">obsonly =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">recover =</span> <span class="fu">colnames</span>(mrgsolve_input_data)) <span class="sc">|&gt;</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">CMIN_PRED =</span> IPRED) <span class="sc">|&gt;</span> </span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MODEL =</span> model_name) <span class="sc">|&gt;</span> </span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID,MODEL,CMIN_PRED) <span class="sc">|&gt;</span> </span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">right_join</span>(full_data) <span class="sc">|&gt;</span> </span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DOSE_PRED =</span> cmin_target<span class="sc">/</span>CMIN_PRED <span class="sc">*</span> DOSE_ADM)</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="carlier" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="carlier"><span class="header-section-number">3.1</span> CARLIER</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TRAIN_CARLIER <span class="ot">&lt;-</span> <span class="fu">perform_mrgsolve_prediction</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">input_data =</span> AMOX_CMIN_OBS_TRAIN ,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrgsolve_model_path =</span> <span class="fu">here</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amoxicillin/Simulations/amox_Carlier"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"CARLIER"</span>,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cmin_target =</span> <span class="dv">60</span> <span class="co">#mg/L</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_CARLIER <span class="ot">&lt;-</span> <span class="fu">perform_mrgsolve_prediction</span>(</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">input_data =</span> AMOX_CMIN_OBS_TEST ,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrgsolve_model_path =</span> <span class="fu">here</span>(</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amoxicillin/Simulations/amox_Carlier"</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"CARLIER"</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cmin_target =</span> <span class="dv">60</span> <span class="co">#mg/L</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="fournier" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="fournier"><span class="header-section-number">3.2</span> FOURNIER</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TRAIN_FOURNIER <span class="ot">&lt;-</span> <span class="fu">perform_mrgsolve_prediction</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">input_data =</span> AMOX_CMIN_OBS_TRAIN ,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrgsolve_model_path =</span> <span class="fu">here</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amoxicillin/Simulations/amox_Fournier"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"FOURNIER"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cmin_target =</span> <span class="dv">60</span> <span class="co">#mg/L</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_FOURNIER <span class="ot">&lt;-</span> <span class="fu">perform_mrgsolve_prediction</span>(</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">input_data =</span> AMOX_CMIN_OBS_TEST ,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrgsolve_model_path =</span> <span class="fu">here</span>(</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amoxicillin/Simulations/amox_Fournier"</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"FOURNIER"</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cmin_target =</span> <span class="dv">60</span> <span class="co">#mg/L</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="mellon" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="mellon"><span class="header-section-number">3.3</span> MELLON</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TRAIN_MELLON <span class="ot">&lt;-</span> <span class="fu">perform_mrgsolve_prediction</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">input_data =</span> AMOX_CMIN_OBS_TRAIN ,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrgsolve_model_path =</span> <span class="fu">here</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amoxicillin/Simulations/amox_Mellon"</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"MELLON"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cmin_target =</span> <span class="dv">60</span> <span class="co">#mg/L</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_MELLON <span class="ot">&lt;-</span> <span class="fu">perform_mrgsolve_prediction</span>(</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">input_data =</span> AMOX_CMIN_OBS_TEST ,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrgsolve_model_path =</span> <span class="fu">here</span>(</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amoxicillin/Simulations/amox_Mellon"</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"MELLON"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cmin_target =</span> <span class="dv">60</span> <span class="co">#mg/L</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="rambaud" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="rambaud"><span class="header-section-number">3.4</span> RAMBAUD</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TRAIN_RAMBAUD <span class="ot">&lt;-</span> <span class="fu">perform_mrgsolve_prediction</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">input_data =</span> AMOX_CMIN_OBS_TRAIN ,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrgsolve_model_path =</span> <span class="fu">here</span>(</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amoxicillin/Simulations/amox_Rambaud"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"RAMBAUD"</span>,</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cmin_target =</span> <span class="dv">60</span> <span class="co">#mg/L</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_RAMBAUD <span class="ot">&lt;-</span> <span class="fu">perform_mrgsolve_prediction</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">input_data =</span> AMOX_CMIN_OBS_TEST ,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrgsolve_model_path =</span> <span class="fu">here</span>(</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amoxicillin/Simulations/amox_Rambaud"</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"RAMBAUD"</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cmin_target =</span> <span class="dv">60</span> <span class="co">#mg/L</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="pool-all-predictions-and-save-them" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="pool-all-predictions-and-save-them"><span class="header-section-number">3.5</span> Pool all predictions and save them</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_TRAIN <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  AMOX_CMIN_PRED_TRAIN_CARLIER,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  AMOX_CMIN_PRED_TRAIN_FOURNIER,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  AMOX_CMIN_PRED_TRAIN_MELLON,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  AMOX_CMIN_PRED_TRAIN_RAMBAUD</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID,MODEL) <span class="sc">|&gt;</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REFERENCE =</span> <span class="fu">if_else</span>(MODEL <span class="sc">==</span> MODEL_COHORT, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="co"># Add a variable called REFERENCE which is 1 for the the line where the model used for simulation is the same as the model cohort (otherwise 0) and take only observed values</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(AMOX_CMIN_TRAIN, <span class="fu">here</span>(<span class="st">"Amoxicillin/Data/AMOX_CMIN_TRAIN.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_TEST <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  AMOX_CMIN_PRED_TEST_CARLIER,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  AMOX_CMIN_PRED_TEST_FOURNIER,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  AMOX_CMIN_PRED_TEST_MELLON,</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  AMOX_CMIN_PRED_TEST_RAMBAUD</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID,MODEL) <span class="sc">|&gt;</span> </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">REFERENCE =</span> <span class="fu">if_else</span>(MODEL <span class="sc">==</span> MODEL_COHORT, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="co"># Add a variable called REFERENCE which is 1 for the the line where the model used for simulation is the same as the model cohort (otherwise 0) and take only observed values</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(AMOX_CMIN_TEST, <span class="fu">here</span>(<span class="st">"Amoxicillin/Data/AMOX_CMIN_TEST.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="global-inspection-of-model-predictions" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="global-inspection-of-model-predictions"><span class="header-section-number">3.6</span> Global inspection of model predictions</h2>
<section id="within-cohort-performance-inter-individual-variability" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="within-cohort-performance-inter-individual-variability"><span class="header-section-number">3.6.1</span> Within-cohort performance (inter-individual variability)</h3>
<p>Visualization of the inter-individual variability of models by dividing PRED (predicted) values by IPRED (observed) both generated by the same model.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CMIN</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide each PRED by the IPRED reference </span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(AMOX_CMIN_TRAIN,AMOX_CMIN_TEST) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(REFERENCE <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, MODEL) <span class="sc">%&gt;%</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ratio =</span> (CMIN_PRED <span class="sc">/</span> CMIN_IND) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of ratios stratified by model</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>stratified_ratios_CMIN <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(AMOX_CMIN2, <span class="fu">aes</span>(<span class="at">x =</span> MODEL, <span class="at">y =</span> ratio, <span class="at">fill =</span> MODEL)) <span class="sc">+</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">80</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">125</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Predicted/observed ratios for the same model (Cmax)"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"MODEL"</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Ratio (%)"</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">20</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),    </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>stratified_ratios_CMIN <span class="sc">+</span> <span class="fu">scale_y_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/Ratios-var-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="Precision_dosing_methods_files/figure-html/Ratios-var-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="full-dataset-performance-model-performance" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="full-dataset-performance-model-performance"><span class="header-section-number">3.6.2</span> Full dataset performance (model performance)</h3>
<p>In this section, the focus is no longer solely on observed concentrations (IPRED), but the performance of the models is explored by illustrating how the predicted concentrations (PRED) for <strong>all</strong> the cohorts (not just for covariates on which the model was developed) compare the the observed concentration. Visualization of PRED/IPRED ratios. In all cases we compare PRED (predicted) values to a reference IPRED (observed), which is the IPRED of the model whose cohort was used to simulate a particular set of covariates. Red lines indicate the bioequivalence range of 80-125 %.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># CMIN</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide each PRED by the IPRED reference </span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN3 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(AMOX_CMIN_TRAIN,AMOX_CMIN_TEST) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">ref_CMIN =</span> <span class="fu">first</span>(CMIN_IND[REFERENCE <span class="sc">==</span> <span class="dv">1</span>], <span class="at">default =</span> <span class="cn">NA</span>),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">ratio =</span> (CMIN_PRED <span class="sc">/</span> ref_CMIN) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot of ratios stratified by model</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>perf_CMIN <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(AMOX_CMIN3, <span class="fu">aes</span>(<span class="at">x =</span> MODEL, <span class="at">y =</span> ratio, <span class="at">fill =</span> MODEL)) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">80</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">125</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Boxplots of predicted/observed ratios (CMIN)"</span>,</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"MODEL"</span>,</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Ratio (%)"</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">20</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),    </span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">20</span>),</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>perf_CMIN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/Ratios-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="Precision_dosing_methods_files/figure-html/Ratios-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="single-model-approach" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Single model approach</h1>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>explore_predictions <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">conc_inf =</span> <span class="dv">40</span>, <span class="at">conc_sup =</span> <span class="dv">80</span>, <span class="at">freq_column =</span> <span class="st">"FREQ"</span>) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate true dose range and prediction correctness</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">DOSE_inf =</span> (conc_inf <span class="sc">/</span> CMIN_IND) <span class="sc">*</span> DOSE_ADM,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">DOSE_sup =</span> (conc_sup <span class="sc">/</span> CMIN_IND) <span class="sc">*</span> DOSE_ADM</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">Prediction_correctness =</span> <span class="fu">ifelse</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        (DOSE_PRED <span class="sc">&gt;=</span> DOSE_inf <span class="sc">&amp;</span> DOSE_PRED <span class="sc">&lt;=</span> DOSE_sup),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Correct"</span>, <span class="st">"Incorrect"</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>(Prediction_correctness) <span class="sc">%&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">Dosing =</span> <span class="fu">case_when</span>(</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        Prediction_correctness <span class="sc">==</span> <span class="st">"Correct"</span> <span class="sc">~</span> <span class="st">"On target"</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>        DOSE_PRED <span class="sc">&lt;</span> DOSE_inf <span class="sc">~</span> <span class="st">"Underdosed"</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>        DOSE_PRED <span class="sc">&gt;</span> DOSE_sup <span class="sc">~</span> <span class="st">"Overdosed"</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Proportions of under- and overdosing</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  dosing <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(Dosing) <span class="sc">%&gt;%</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">Proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">Dosing =</span> <span class="fu">factor</span>(Dosing, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Overdosed"</span>, <span class="st">"On target"</span>, <span class="st">"Underdosed"</span>)),</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">Label =</span> <span class="fu">paste0</span>(Dosing, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">round</span>(Proportion), <span class="st">"%"</span>)</span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Over/underdosed graph</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dosing, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> Proportion, <span class="at">fill =</span> Dosing)) <span class="sc">+</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Label), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Underdosed"</span> <span class="ot">=</span> <span class="st">"darkorange"</span>, <span class="st">"On target"</span> <span class="ot">=</span> <span class="st">"chartreuse4"</span>, <span class="st">"Overdosed"</span> <span class="ot">=</span> <span class="st">"#A91A27"</span>)) <span class="sc">+</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"%"</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="st">"Target attainment"</span>, <span class="at">fill =</span> <span class="st">"Dosing Category"</span>) <span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span> </span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CREAT binning (based on the American Kidney Fund's categories)</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">CREAT_bin =</span> <span class="fu">case_when</span>(<span class="co"># males</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>      SEX <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">cut</span>(</span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>        CREAT,</span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.7</span>, <span class="fl">1.3</span>, <span class="cn">Inf</span>),</span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Below normal"</span>, <span class="st">"Normal"</span>, <span class="st">"Above normal"</span>),</span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">right =</span> <span class="cn">FALSE</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>      SEX <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="fu">cut</span>( <span class="co"># females</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>        CREAT,</span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>        <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.6</span>, <span class="fl">1.1</span>, <span class="cn">Inf</span>),</span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Below normal"</span>, <span class="st">"Normal"</span>, <span class="st">"Above normal"</span>),</span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">right =</span> <span class="cn">FALSE</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Binning stats</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>  bin_summary <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CREAT_bin, Prediction_correctness) <span class="sc">%&gt;%</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Prediction_correctness, <span class="at">values_from =</span> Count, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Proportion_Correct =</span> (Correct <span class="sc">/</span> (Correct <span class="sc">+</span> Incorrect)) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Binning graph</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bin_summary, <span class="fu">aes</span>(<span class="at">x =</span> CREAT_bin, <span class="at">y =</span> Proportion_Correct)) <span class="sc">+</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"chartreuse4"</span>, <span class="at">color =</span> <span class="st">"chartreuse4"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(Proportion_Correct)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Target attainement by serum creatinine level"</span>, <span class="at">x =</span> <span class="st">"Serum creatinine"</span>, <span class="at">y =</span> <span class="st">"Correct predictions (%)"</span>) <span class="sc">+</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">24</span>),</span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>)</span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">20</span>))</span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># CRCL binning for chronic kidney disease categories</span></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">CRCL_bin =</span> <span class="fu">cut</span>(</span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a>        CRCL_CKD_EPI_ABSOLUTE,</span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a>        <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">130</span>, <span class="cn">Inf</span>),</span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0-30"</span>, <span class="st">"31-60"</span>, <span class="st">"61-90"</span>,  <span class="st">"90-130"</span>,  <span class="st">"&gt; 130"</span>),</span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a>        <span class="at">right =</span> <span class="cn">FALSE</span></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Binning stats</span></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a>  bin_summary <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(CRCL_bin, Prediction_correctness) <span class="sc">%&gt;%</span></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Prediction_correctness, <span class="at">values_from =</span> Count, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Proportion_Correct =</span> (Correct <span class="sc">/</span> (Correct <span class="sc">+</span> Incorrect)) <span class="sc">*</span> <span class="dv">100</span>)</span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Binning graph</span></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a>  p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(bin_summary, <span class="fu">aes</span>(<span class="at">x =</span> CRCL_bin, <span class="at">y =</span> Proportion_Correct)) <span class="sc">+</span></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"chartreuse4"</span>, <span class="at">color =</span> <span class="st">"chartreuse4"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(Proportion_Correct)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Target attainement by creatinine clearance category"</span>, <span class="at">x =</span> <span class="st">"Creatinine clearance (mL/min)"</span>, <span class="at">y =</span> <span class="st">"Correct predictions (%)"</span>) <span class="sc">+</span></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">24</span>),</span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>)</span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100</span>, <span class="at">by =</span> <span class="dv">20</span>))</span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summary statistics</span></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a>  summary_stats <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Prediction_correctness) <span class="sc">%&gt;%</span></span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_CREAT =</span> <span class="fu">mean</span>(CREAT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_CREAT =</span> <span class="fu">sd</span>(CREAT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_WT =</span> <span class="fu">mean</span>(WT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_WT =</span> <span class="fu">sd</span>(WT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_AGE =</span> <span class="fu">mean</span>(AGE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_AGE =</span> <span class="fu">sd</span>(AGE, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a>      <span class="at">Count =</span> <span class="fu">n</span>()</span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Proportion =</span> Count <span class="sc">/</span> <span class="fu">sum</span>(Count))</span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a>  correct_proportion <span class="ot">&lt;-</span> summary_stats <span class="sc">%&gt;%</span></span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Prediction_correctness <span class="sc">==</span> <span class="st">"Correct"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(Proportion)</span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"Proportion of 'correct' predictions: %.2f%%"</span>, correct_proportion <span class="sc">*</span> <span class="dv">100</span>))</span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_attainment =</span> p1,</span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">creat_plot =</span> p2,</span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">crcl_plot =</span> p3,</span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">summary_stats =</span> summary_stats</span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="carlier-1" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="carlier-1"><span class="header-section-number">4.1</span> CARLIER</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In this specific case predictions were already</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># created before, thus "making predictions"</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># simply involve loading them and filtering for the correct model</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TRAIN_CARLIER <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"Amoxicillin/Data/AMOX_CMIN_TRAIN.csv"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MODEL <span class="sc">==</span> <span class="st">"CARLIER"</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_CARLIER <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"Amoxicillin/Data/AMOX_CMIN_TEST.csv"</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MODEL <span class="sc">==</span> <span class="st">"CARLIER"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>results_carlier_train <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TRAIN_CARLIER)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>results_carlier_train<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-carlier-train-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-carlier-train-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>creat_plot_carlier_train <span class="ot">&lt;-</span> results_carlier_train<span class="sc">$</span>creat_plot</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>creat_plot_carlier_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-carlier-train-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-carlier-train-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_carlier_train <span class="ot">&lt;-</span> results_carlier_train<span class="sc">$</span>crcl_plot</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_carlier_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-carlier-train-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-carlier-train-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>results_carlier_train<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     0.982    0.558    79.0  14.2     64.1   17.2   512
2 Incorrect                   0.912    0.606    86.4  19.0     57.4   15.6  1363
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>results_carlier_test <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TEST_CARLIER)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>results_carlier_test<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-carlier-test-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-carlier-test-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>creat_plot_carlier_test <span class="ot">&lt;-</span> results_carlier_test<span class="sc">$</span>creat_plot</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>creat_plot_carlier_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-carlier-test-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-carlier-test-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_carlier_test <span class="ot">&lt;-</span> results_carlier_test<span class="sc">$</span>crcl_plot</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_carlier_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-carlier-test-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-carlier-test-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>results_carlier_test<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     1.02     0.593    79.7  14.8     65.1   17.3   171
2 Incorrect                   0.921    0.571    86.3  19.7     57.9   15.6   429
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="fournier-1" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="fournier-1"><span class="header-section-number">4.2</span> FOURNIER</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In this specific case predictions were already</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># created before, thus "making predictions"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># simply involve loading them and filtering for the correct model</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TRAIN_FOURNIER <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"Amoxicillin/Data/AMOX_CMIN_TRAIN.csv"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MODEL <span class="sc">==</span> <span class="st">"FOURNIER"</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_FOURNIER <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"Amoxicillin/Data/AMOX_CMIN_TEST.csv"</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MODEL <span class="sc">==</span> <span class="st">"FOURNIER"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>results_fournier_train <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TRAIN_FOURNIER)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>results_fournier_train<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-fournier-train-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-fournier-train-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>creat_plot_fournier_train <span class="ot">&lt;-</span> results_fournier_train<span class="sc">$</span>creat_plot</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>creat_plot_fournier_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-fournier-train-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-fournier-train-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_fournier_train <span class="ot">&lt;-</span> results_fournier_train<span class="sc">$</span>crcl_plot</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_fournier_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-fournier-train-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-fournier-train-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>results_fournier_train<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     0.965    0.608    80.7  16.1     64.1   17.9   605
2 Incorrect                   0.914    0.586    86.1  18.7     56.9   15.0  1270
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>results_fournier_test <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TEST_FOURNIER)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>results_fournier_test<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-fournier-test-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-fournier-test-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>creat_plot_fournier_test <span class="ot">&lt;-</span> results_fournier_test<span class="sc">$</span>creat_plot</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>creat_plot_fournier_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-fournier-test-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-fournier-test-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_fournier_test <span class="ot">&lt;-</span> results_fournier_test<span class="sc">$</span>crcl_plot</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_fournier_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-fournier-test-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-fournier-test-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>results_fournier_test<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     0.907    0.432    79.0  15.8     62.7   16.9   191
2 Incorrect                   0.970    0.635    86.9  19.4     58.6   16.0   409
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="mellon-1" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="mellon-1"><span class="header-section-number">4.3</span> MELLON</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In this specific case predictions were already</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># created before, thus "making predictions"</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># simply involve loading them and filtering for the correct model</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TRAIN_MELLON <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"Amoxicillin/Data/AMOX_CMIN_TRAIN.csv"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MODEL <span class="sc">==</span> <span class="st">"MELLON"</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_MELLON <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"Amoxicillin/Data/AMOX_CMIN_TEST.csv"</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MODEL <span class="sc">==</span> <span class="st">"MELLON"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>results_mellon_train <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TRAIN_MELLON)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>results_mellon_train<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-mellon-train-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-mellon-train-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>creat_plot_mellon_train <span class="ot">&lt;-</span> results_mellon_train<span class="sc">$</span>creat_plot</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>creat_plot_mellon_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-mellon-train-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-mellon-train-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_mellon_train <span class="ot">&lt;-</span> results_mellon_train<span class="sc">$</span>crcl_plot</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_mellon_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-mellon-train-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-mellon-train-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>results_mellon_train<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     0.681    0.177    94.9  19.3     52.9   11.9   290
2 Incorrect                   0.977    0.630    82.4  17.2     60.4   16.8  1585
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>results_mellon_test <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TEST_MELLON)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>results_mellon_test<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-mellon-test-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-mellon-test-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>creat_plot_mellon_test <span class="ot">&lt;-</span> results_mellon_test<span class="sc">$</span>creat_plot</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>creat_plot_mellon_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-mellon-test-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-mellon-test-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_mellon_test <span class="ot">&lt;-</span> results_mellon_test<span class="sc">$</span>crcl_plot</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_mellon_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-mellon-test-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-mellon-test-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>results_mellon_test<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     0.713    0.184    93.0  21.8     49.5   13.1    87
2 Incorrect                   0.990    0.612    82.9  17.7     61.7   16.2   513
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="rambaud-1" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="rambaud-1"><span class="header-section-number">4.4</span> RAMBAUD</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In this specific case predictions were already</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># created before, thus "making predictions"</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># simply involve loading them and filtering for the correct model</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TRAIN_RAMBAUD <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"Amoxicillin/Data/AMOX_CMIN_TRAIN.csv"</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MODEL <span class="sc">==</span> <span class="st">"RAMBAUD"</span>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_RAMBAUD <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">here</span>(<span class="st">"Amoxicillin/Data/AMOX_CMIN_TEST.csv"</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MODEL <span class="sc">==</span> <span class="st">"RAMBAUD"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>results_rambaud_train <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TRAIN_RAMBAUD)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>results_rambaud_train<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-rambaud-train-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-rambaud-train-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>creat_plot_rambaud_train <span class="ot">&lt;-</span> results_rambaud_train<span class="sc">$</span>creat_plot</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>creat_plot_rambaud_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-rambaud-train-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-rambaud-train-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_rambaud_train <span class="ot">&lt;-</span> results_rambaud_train<span class="sc">$</span>crcl_plot</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_rambaud_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-rambaud-train-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-rambaud-train-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>results_rambaud_train<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     1.07     0.492    77.4  13.6     70.9   14.6   329
2 Incorrect                   0.901    0.609    85.9  18.6     56.7   15.6  1546
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>results_rambaud_test <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TEST_RAMBAUD)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>results_rambaud_test<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-rambaud-test-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-rambaud-test-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>creat_plot_rambaud_test <span class="ot">&lt;-</span> results_rambaud_test<span class="sc">$</span>creat_plot</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>creat_plot_rambaud_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-rambaud-test-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-rambaud-test-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_rambaud_test <span class="ot">&lt;-</span> results_rambaud_test<span class="sc">$</span>crcl_plot</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_rambaud_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-rambaud-test-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-rambaud-test-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>results_rambaud_test<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     1.09     0.645    76.5  15.2     70.1   14.1   104
2 Incorrect                   0.921    0.560    86.1  19.0     57.8   16.0   496
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="meta-model" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="meta-model"><span class="header-section-number">4.5</span> Meta model</h2>
<p>This is an ensembling method where a PopPK model is built based on data simulated with the four models (Carlier, Fournier, Mellon, and Rambaud).</p>
<p>The model is built on the training set used for the ensembling algorithms and tested on the test set. The data is rich and does not contain below quantification limit concentrations. The 3 three compartment structural model was a better fit than a two compartment one (OFV drop &lt; 0.1 %), however as the estimate of the second peripheral volume was negligeable (&lt; 1 L), the two-compartment model was preferred. The pharmacostatistical model is developed using the automatic statistical model building tool in Monolix 2024R1. The best model has IIV on all parameters with no covariance between them. The error model is combined with log-normal distribution.</p>
<p>The covariate model is built using the automatic SCM tool of Monolix with respective forward and backward p values of 5 and 1 % (Likelihood Ratio Test). CREAT and WT were added on the clearance.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_META <span class="ot">&lt;-</span> <span class="fu">perform_mrgsolve_prediction</span>(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">input_data =</span> AMOX_CMIN_OBS_TEST ,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mrgsolve_model_path =</span> <span class="fu">here</span>(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amoxicillin/MIPD/amox_Meta"</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_name =</span> <span class="st">"META"</span>,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cmin_target =</span> <span class="dv">60</span> <span class="co">#mg/L</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>results_meta_test <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TEST_META)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>results_meta_test<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-meta-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-meta-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>creat_plot_meta_test <span class="ot">&lt;-</span> results_meta_test<span class="sc">$</span>creat_plot</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>creat_plot_meta_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-meta-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-meta-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_meta_test <span class="ot">&lt;-</span> results_meta_test<span class="sc">$</span>crcl_plot</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_meta_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-predictions-meta-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img src="Precision_dosing_methods_files/figure-html/evaluate-predictions-meta-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>results_meta_test<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     0.839    0.301    86.3  20.4     60.4   15.7   168
2 Incorrect                   0.993    0.651    83.6  17.9     59.7   16.6   432
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="standard-dose" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Standard dose</h1>
<p>Based on the our standard dose screening, out of five potential dosing regimens guided by the <a href="https://www.infectiologie.com/UserFiles/File/spilf/recos/doses-spilf-sfpt-casfm-2023.pdf">SPILF</a> recommendation and hospital practices, 200 mg/kg is selected as standard dose reference as it gave the highest target attainment on clinical data.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TRAIN_STD <span class="ot">&lt;-</span> AMOX_CMIN_TRAIN <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DOSE_PRED =</span> (<span class="dv">200</span> <span class="sc">*</span> WT) <span class="sc">/</span> (<span class="dv">24</span><span class="sc">/</span>FREQ)) <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID, CREAT, WT, BURN, SEX, AGE, HT, FREQ, DOSE_ADM, DOSE_PRED, CMIN_IND, SEX, BSA, CRCL_CKD_EPI_ABSOLUTE) <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_STD <span class="ot">&lt;-</span> AMOX_CMIN_TEST <span class="sc">%&gt;%</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DOSE_PRED =</span> (<span class="dv">200</span> <span class="sc">*</span> WT) <span class="sc">/</span> (<span class="dv">24</span><span class="sc">/</span>FREQ)) <span class="sc">%&gt;%</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID, CREAT, WT, BURN, SEX, AGE, HT, FREQ, DOSE_ADM, DOSE_PRED, CMIN_IND, SEX, BSA, CRCL_CKD_EPI_ABSOLUTE) <span class="sc">%&gt;%</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>results_standard_train <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TRAIN_STD)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>results_standard_train<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-standard-dose-train-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-standard-dose-train-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>results_standard_train<span class="sc">$</span>creat_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-standard-dose-train-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-standard-dose-train-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>results_standard_train<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     1.19     0.743    76.9  12.0     70.1   14.5   291
2 Incorrect                   0.883    0.549    85.7  18.7     57.2   15.8  1584
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>results_standard_test <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TEST_STD)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>results_standard_test<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-standard-dose-test-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-standard-dose-test-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>results_standard_test<span class="sc">$</span>creat_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-standard-dose-test-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-standard-dose-test-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>results_standard_test<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     1.10     0.511    77.7  13.2     70.4   13.7    93
2 Incorrect                   0.923    0.587    85.6  19.3     58.0   16.1   507
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="uninformed-model-ensembling" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Uninformed model ensembling</h1>
<p>All the models are given the same weight (one quarter in this case). The performance of the models or the development cohort characteristics are not taken into account.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TRAIN_UNINF_MOD_ENS <span class="ot">&lt;-</span>  AMOX_CMIN_TRAIN <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WEIGHT =</span> <span class="fl">0.25</span>) <span class="sc">%&gt;%</span> <span class="co"># Add uniform weight</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WEIGHTED_PRED =</span> CMIN_PRED <span class="sc">*</span> WEIGHT) <span class="sc">%&gt;%</span> <span class="co"># Weigh prediction</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WEIGHTED_PREDICTION =</span> <span class="fu">sum</span>(WEIGHTED_PRED)) <span class="sc">%&gt;%</span> <span class="co"># Ensemble weighted predictions</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID, CREAT, WT, BURN, SEX, AGE, HT, FREQ, DOSE_ADM, WEIGHTED_PREDICTION, CMIN_IND, SEX, CRCL_CKD_EPI_ABSOLUTE) <span class="sc">%&gt;%</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DOSE_PRED =</span> (<span class="dv">60</span><span class="sc">/</span>WEIGHTED_PREDICTION) <span class="sc">*</span> DOSE_ADM) <span class="co"># Administered dose extrapolation to reach 60 mg/L</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_UNINF_MOD_ENS <span class="ot">&lt;-</span> AMOX_CMIN_TEST <span class="sc">%&gt;%</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WEIGHT =</span> <span class="fl">0.25</span>) <span class="sc">%&gt;%</span> <span class="co"># Add uniform weight</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WEIGHTED_PRED =</span> CMIN_PRED <span class="sc">*</span> WEIGHT) <span class="sc">%&gt;%</span> <span class="co"># Weigh prediction</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">WEIGHTED_PREDICTION =</span> <span class="fu">sum</span>(WEIGHTED_PRED)) <span class="sc">%&gt;%</span> <span class="co"># Ensemble weighted predictions</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID, CREAT, WT, BURN, SEX, AGE, HT, FREQ, DOSE_ADM, WEIGHTED_PREDICTION, CMIN_IND, SEX, CRCL_CKD_EPI_ABSOLUTE) <span class="sc">%&gt;%</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DOSE_PRED =</span> (<span class="dv">60</span><span class="sc">/</span>WEIGHTED_PREDICTION) <span class="sc">*</span> DOSE_ADM) <span class="co"># Administered dose extrapolation to reach 60 mg/L</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>results_uninf_mod_ens_train <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TRAIN_UNINF_MOD_ENS)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>results_uninf_mod_ens_train<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-uninf-mod-ens-train-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-uninf-mod-ens-train-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>results_uninf_mod_ens_train<span class="sc">$</span>creat_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-uninf-mod-ens-train-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-uninf-mod-ens-train-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>results_uninf_mod_ens_train<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     0.939    0.468    82.8  17.8     62.0   17.0   613
2 Incorrect                   0.927    0.646    85.1  18.2     57.8   15.8  1262
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>results_uninf_mod_ens_test <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TEST_UNINF_MOD_ENS)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>results_uninf_mod_ens_test<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-uninf-mod-ens-test-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-uninf-mod-ens-test-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>results_uninf_mod_ens_test<span class="sc">$</span>creat_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-uninf-mod-ens-test-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-uninf-mod-ens-test-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>results_uninf_mod_ens_test<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     0.937    0.515    82.2  18.6     62.3   16.6   194
2 Incorrect                   0.956    0.607    85.5  18.7     58.8   16.2   406
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="nomogram" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Nomogram</h1>
<p>The nomogram developed by <span class="citation" data-cites="rambaud2020">Rambaud et al. (<a href="references.html#ref-rambaud2020" role="doc-biblioref">2020</a>)</span> in Nantes which predicts the dose in endocarditis patients based solely on absolute glomerular filtration rate.</p>
<p>The daily dose in g to reach 20 mg/L is predicted by the nomogram based on CRCL in mL/min (x) estimated using the CKD-EPI equation <span class="math display">\[
\text{Dose} = 0.0001x^2 + 0.0613x + 1.157
\]</span> and then extrapolated to attain 60 mg/L.</p>
<p>Although the nomogram has been validated only for CRCL between 30 and 120 mL/min and continuous infusion, in this study, it was also evaluated in patients with CRCL outside of this range and applied to intermittent infusion.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TRAIN_NOMOGRAM <span class="ot">&lt;-</span>  AMOX_CMIN_TRAIN <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(ID, CREAT, WT, BURN, SEX, AGE, HT, FREQ, DOSE_ADM, CMIN_IND, SEX, CRCL_CKD_EPI_ABSOLUTE) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DOSE_PRED =</span> ((<span class="fl">0.0001</span> <span class="sc">*</span> CRCL_CKD_EPI_ABSOLUTE<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.0613</span> <span class="sc">*</span> CRCL_CKD_EPI_ABSOLUTE <span class="sc">+</span> <span class="fl">1.157</span>) <span class="sc">*</span> <span class="dv">3000</span>) <span class="sc">/</span> (<span class="dv">24</span><span class="sc">/</span>FREQ)) <span class="sc">|&gt;</span> </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_NOMOGRAM <span class="ot">&lt;-</span> AMOX_CMIN_TEST <span class="sc">%&gt;%</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID, CREAT, WT, BURN, SEX, AGE, HT, FREQ, DOSE_ADM, CMIN_IND, SEX, CRCL_CKD_EPI_ABSOLUTE) <span class="sc">%&gt;%</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DOSE_PRED =</span> ((<span class="fl">0.0001</span> <span class="sc">*</span> CRCL_CKD_EPI_ABSOLUTE<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.0613</span> <span class="sc">*</span> CRCL_CKD_EPI_ABSOLUTE <span class="sc">+</span> <span class="fl">1.157</span>) <span class="sc">*</span> <span class="dv">3000</span>) <span class="sc">/</span> (<span class="dv">24</span><span class="sc">/</span>FREQ)) <span class="sc">|&gt;</span> </span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>results_nomogram_train <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TRAIN_NOMOGRAM)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>results_nomogram_train<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-nomogram-train-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-38"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-nomogram-train-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>results_nomogram_train<span class="sc">$</span>creat_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-nomogram-train-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-39"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-nomogram-train-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>results_nomogram_train<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     1.04     0.431    75.6  12.6     67.7   15.7   360
2 Incorrect                   0.905    0.623    86.4  18.6     57.2   15.8  1515
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>results_nomogram_test <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(AMOX_CMIN_PRED_TEST_NOMOGRAM)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>results_nomogram_test<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-nomogram-test-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-40"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-nomogram-test-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>results_nomogram_test<span class="sc">$</span>creat_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-nomogram-test-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-41"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-nomogram-test-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>results_nomogram_test<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     1.12     0.587    77.0  13.6     69.8   15.1   129
2 Incorrect                   0.904    0.568    86.4  19.4     57.2   15.7   471
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="classification-tree-informed-ensembling" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Classification tree informed ensembling</h1>
<p>This method is used to attribute weights to models based on their probability to give correct predictions for a set of covariates.</p>
<p>The method is based on <span class="citation" data-cites="Agema2024-cf">Agema et al. (<a href="references.html#ref-Agema2024-cf" role="doc-biblioref">2024</a>)</span>.</p>
<p>Bioequivalence ratios between <span class="math inline">\(Cmin_{\text{pred}}\)</span> and <span class="math inline">\(Cmin_{\text{ind}}\)</span> are calculated and transformed to a binary variable based on if the ratio is in the bioequivalence range [0.80-1.25] or not. This categorical variable is called CORRECT.</p>
<p>First, for each set of covariates, the ratios between the predicted values of the 4 models are compared to the <em>true</em> value. Then, we add the variable CORRECT which takes the value of YES if the ratio is in the bioequivalence range, and the value of NO, if not.</p>
<p>Then, decision tree is developed where the predictors are the seven covariates and a binary variable indicating continuous or intermittent infusion (CON), and the target variable is the categorical variable named CORRECT. A decision tree is fitted separately for each MODEL where the following parameters need to be defined</p>
<p>- <strong>Complexity</strong> â€“ a penalty that the information gain has to overcome to add a split. A higher complexity value leads to a smaller tree meaning that subjects are divided into smaller number of categories, so their scores will be less diverse. Comlexity is found by automatic hyperparameter tuning based on cross-validation error.<br>
<strong>Minsplit</strong> â€“ minimum number of samples to split a node (smaller value, deeper tree).<br>
<strong>Minbucket</strong> â€“ minimum number of samples in the terminal node (smaller value, deeper tree). Minsplit and minbucket in the range of 2-30 range does not affect the results , so 4 is fixed as a value to have deeper trees.<br>
- <strong>xval</strong> â€“ number of cross validations. 10-fold cross validation is used (the same number as for the ML methods).<br>
- <strong>splitting criterion</strong> - entropy or Gini impurity. Gini meausures the frequency (f) with which an element is misclassified:</p>
<p><span class="math display">\[
  Gini\ impurity = 2 \cdot f \cdot \left(1 - f \right) \
\]</span> Entropy (called information in rpart) measures the disorder of the predictors as a function of the target:</p>
<p><span class="math display">\[
  Entropy = f \cdot log_2(f)
\]</span></p>
<p>Normally, the two splitting criteria give similar results. Entropy is more computationally complex as it uses logarithms.</p>
<p>For certain models, the root node is not split any further (same model score for all subjects).<br>
In the obtained leaf_results table, only the leaf nodes are included with the following columns</p>
<ul>
<li><p><strong>node</strong> - node number</p></li>
<li><p><strong>var</strong> - splitting variable (it always says leaf, as only leaves are included in the table)</p></li>
<li><p><strong>n</strong>- number of subjects per node</p></li>
<li><p><strong>wt</strong> - subject weight (all the subject have the same weight)</p></li>
<li><p><strong>dev</strong> - Gini index</p></li>
<li><p><strong>yval</strong> - the predicted class</p></li>
<li><p><strong>ncompete</strong> - Alternative splitting variables that were not selected for a node but give slightly worse performance than the selected variable. As only leaves are included, there are no competing splitting variables.</p></li>
<li><p><strong>nsurrogate</strong> - Used for missing values. Not applicable to leaves.</p></li>
<li><p><strong>yval2[, 2]</strong> - number of NO for the CORRECT variable</p></li>
<li><p><strong>yval2[, 3]</strong> - number of YES</p></li>
<li><p><strong>yval2[, 4]</strong> - proportion of NO</p></li>
<li><p><strong>yval2[, 5]</strong> - proportion of YES</p></li>
<li><p><strong>prob_yes</strong> - same as yval2[, 5], this column is used later to attribute model weights</p></li>
<li><p><strong>n_obs</strong> - number of observations</p></li>
</ul>
<p>To this table, in the path column is added containing all the decisions that led to that particular leaf. Then, this string is transformed to lower and upper limits for continuous and categories for categorical covariates. If there are no upper or lower limits or selected categories, NA is added.</p>
<p>In the original method ( <span class="citation" data-cites="Agema2024-cf">Agema et al. (<a href="references.html#ref-Agema2024-cf" role="doc-biblioref">2024</a>)</span>), the leaves are selected with at least a YES proportion of 0.5 and then the selected models are taken into account with equal weight. Here, all models are used with their respective YES proportions. This way, no subject will end up without a model, and the weights will be more nuancedly calculated. Then, for each subject, the four corresponding nodes are found based on its covariates (one for each model). The probabilites (proportions) of having YES (=prob_yes or score) are normalized by their sum for each subject, so that the scores of the models for a subject will always add up to 1. These normalized scores (=weights) are used to ensemble the model predictions.</p>
<p>Finally, the method is tested by ensembling the predictions of the test data using the weights calibrated base on the training data. The administered dose is extrapolated by dividing the weighted concentration prediction by the target concentration (= 60 mg/L).</p>
<p>Our <em>openMIPD</em> package is used to apply this method.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_TRAINED_CT <span class="ot">&lt;-</span> <span class="fu">classification_tree_model_ensembling_train</span>(</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> AMOX_CMIN_TRAIN, </span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_variable =</span> <span class="st">"CMIN"</span>, </span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">continuous_cov =</span> <span class="fu">c</span>(<span class="st">"WT"</span>, <span class="st">"CREAT"</span>, <span class="st">"AGE"</span>), </span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">categorical_cov =</span> <span class="fu">c</span>(<span class="st">"OBESE"</span>, <span class="st">"ICU"</span>, <span class="st">"BURN"</span>, <span class="st">"SEX"</span>, <span class="st">"CON"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/train-ct-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-42"><img src="Precision_dosing_methods_files/figure-html/train-ct-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Confusion matrix for model: CARLIER"

 node number: 1 
   root</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/train-ct-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-43"><img src="Precision_dosing_methods_files/figure-html/train-ct-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Confusion matrix for model: FOURNIER"

 node number: 1 
   root</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/train-ct-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-44"><img src="Precision_dosing_methods_files/figure-html/train-ct-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Confusion matrix for model: MELLON"

 node number: 1 
   root</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/train-ct-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-45"><img src="Precision_dosing_methods_files/figure-html/train-ct-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Confusion matrix for model: RAMBAUD"

 node number: 2 
   root
   CON=0

 node number: 12 
   root
   CON=1
   CREAT&lt; 0.5407
   AGE&lt; 50.43

 node number: 26 
   root
   CON=1
   CREAT&lt; 0.5407
   AGE&gt;=50.43
   AGE&gt;=74.79

 node number: 108 
   root
   CON=1
   CREAT&lt; 0.5407
   AGE&gt;=50.43
   AGE&lt; 74.79
   CREAT&gt;=0.4709
   AGE&lt; 63.61

 node number: 109 
   root
   CON=1
   CREAT&lt; 0.5407
   AGE&gt;=50.43
   AGE&lt; 74.79
   CREAT&gt;=0.4709
   AGE&gt;=63.61

 node number: 55 
   root
   CON=1
   CREAT&lt; 0.5407
   AGE&gt;=50.43
   AGE&lt; 74.79
   CREAT&lt; 0.4709

 node number: 56 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&lt; 62.11

 node number: 228 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&gt;=71.67
   AGE&lt; 64.82

 node number: 916 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&gt;=71.67
   AGE&gt;=64.82
   AGE&gt;=69.52
   CREAT&lt; 1.194

 node number: 1834 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&gt;=71.67
   AGE&gt;=64.82
   AGE&gt;=69.52
   CREAT&gt;=1.194
   CREAT&gt;=1.741

 node number: 3670 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&gt;=71.67
   AGE&gt;=64.82
   AGE&gt;=69.52
   CREAT&gt;=1.194
   CREAT&lt; 1.741
   WT&lt; 76.98

 node number: 29368 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&gt;=71.67
   AGE&gt;=64.82
   AGE&gt;=69.52
   CREAT&gt;=1.194
   CREAT&lt; 1.741
   WT&gt;=76.98
   AGE&lt; 81.84
   OBESE=0
   CREAT&lt; 1.239

 node number: 58738 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&gt;=71.67
   AGE&gt;=64.82
   AGE&gt;=69.52
   CREAT&gt;=1.194
   CREAT&lt; 1.741
   WT&gt;=76.98
   AGE&lt; 81.84
   OBESE=0
   CREAT&gt;=1.239
   CREAT&gt;=1.298

 node number: 58739 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&gt;=71.67
   AGE&gt;=64.82
   AGE&gt;=69.52
   CREAT&gt;=1.194
   CREAT&lt; 1.741
   WT&gt;=76.98
   AGE&lt; 81.84
   OBESE=0
   CREAT&gt;=1.239
   CREAT&lt; 1.298

 node number: 58740 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&gt;=71.67
   AGE&gt;=64.82
   AGE&gt;=69.52
   CREAT&gt;=1.194
   CREAT&lt; 1.741
   WT&gt;=76.98
   AGE&lt; 81.84
   OBESE=1
   AGE&gt;=77.57
   CREAT&gt;=1.355

 node number: 58741 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&gt;=71.67
   AGE&gt;=64.82
   AGE&gt;=69.52
   CREAT&gt;=1.194
   CREAT&lt; 1.741
   WT&gt;=76.98
   AGE&lt; 81.84
   OBESE=1
   AGE&gt;=77.57
   CREAT&lt; 1.355

 node number: 29371 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&gt;=71.67
   AGE&gt;=64.82
   AGE&gt;=69.52
   CREAT&gt;=1.194
   CREAT&lt; 1.741
   WT&gt;=76.98
   AGE&lt; 81.84
   OBESE=1
   AGE&lt; 77.57

 node number: 7343 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&gt;=71.67
   AGE&gt;=64.82
   AGE&gt;=69.52
   CREAT&gt;=1.194
   CREAT&lt; 1.741
   WT&gt;=76.98
   AGE&gt;=81.84

 node number: 459 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&gt;=71.67
   AGE&gt;=64.82
   AGE&lt; 69.52

 node number: 460 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&lt; 71.67
   WT&lt; 69.69
   SEX=1

 node number: 1844 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&lt; 71.67
   WT&lt; 69.69
   SEX=0
   WT&lt; 67.65
   WT&gt;=63.78

 node number: 1845 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&lt; 71.67
   WT&lt; 69.69
   SEX=0
   WT&lt; 67.65
   WT&lt; 63.78

 node number: 923 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&lt; 71.67
   WT&lt; 69.69
   SEX=0
   WT&gt;=67.65

 node number: 231 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&lt; 102
   WT&gt;=62.11
   WT&lt; 71.67
   WT&gt;=69.69

 node number: 29 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&gt;=1.146
   WT&gt;=102

 node number: 60 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&lt; 56.88

 node number: 488 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&gt;=1.04

 node number: 1956 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&gt;=84.27

 node number: 7828 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&lt; 55.7

 node number: 31316 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&lt; 0.7382
   CREAT&gt;=0.7009

 node number: 62634 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&lt; 0.7382
   CREAT&lt; 0.7009
   WT&lt; 70.5

 node number: 62635 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&lt; 0.7382
   CREAT&lt; 0.7009
   WT&gt;=70.5

 node number: 31318 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&gt;=0.7382
   WT&lt; 61.96

 node number: 250552 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&gt;=0.7382
   WT&gt;=61.96
   AGE&gt;=60.53
   AGE&lt; 69.15
   AGE&gt;=67.93

 node number: 1002212 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&gt;=0.7382
   WT&gt;=61.96
   AGE&gt;=60.53
   AGE&lt; 69.15
   AGE&lt; 67.93
   AGE&lt; 65.49
   WT&gt;=70.42

 node number: 1002213 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&gt;=0.7382
   WT&gt;=61.96
   AGE&gt;=60.53
   AGE&lt; 69.15
   AGE&lt; 67.93
   AGE&lt; 65.49
   WT&lt; 70.42

 node number: 501107 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&gt;=0.7382
   WT&gt;=61.96
   AGE&gt;=60.53
   AGE&lt; 69.15
   AGE&lt; 67.93
   AGE&gt;=65.49

 node number: 1002216 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&gt;=0.7382
   WT&gt;=61.96
   AGE&gt;=60.53
   AGE&gt;=69.15
   CREAT&gt;=0.8211
   WT&gt;=66.9
   WT&lt; 76.18

 node number: 1002217 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&gt;=0.7382
   WT&gt;=61.96
   AGE&gt;=60.53
   AGE&gt;=69.15
   CREAT&gt;=0.8211
   WT&gt;=66.9
   WT&gt;=76.18

 node number: 501109 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&gt;=0.7382
   WT&gt;=61.96
   AGE&gt;=60.53
   AGE&gt;=69.15
   CREAT&gt;=0.8211
   WT&lt; 66.9

 node number: 250555 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&gt;=0.7382
   WT&gt;=61.96
   AGE&gt;=60.53
   AGE&gt;=69.15
   CREAT&lt; 0.8211

 node number: 62639 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&gt;=51.17
   AGE&gt;=55.7
   CREAT&gt;=0.7382
   WT&gt;=61.96
   AGE&lt; 60.53

 node number: 3915 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&lt; 86.58
   WT&lt; 84.27
   AGE&lt; 51.17

 node number: 3916 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&gt;=86.58
   AGE&lt; 51.92
   AGE&gt;=44.95

 node number: 3917 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&gt;=86.58
   AGE&lt; 51.92
   AGE&lt; 44.95

 node number: 15672 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&gt;=86.58
   AGE&gt;=51.92
   CREAT&lt; 0.926
   CREAT&gt;=0.795
   CREAT&lt; 0.8616

 node number: 15673 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&gt;=86.58
   AGE&gt;=51.92
   CREAT&lt; 0.926
   CREAT&gt;=0.795
   CREAT&gt;=0.8616

 node number: 7837 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&gt;=86.58
   AGE&gt;=51.92
   CREAT&lt; 0.926
   CREAT&lt; 0.795

 node number: 3919 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&lt; 1.055
   CREAT&lt; 1.04
   WT&gt;=86.58
   AGE&gt;=51.92
   CREAT&gt;=0.926

 node number: 245 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&gt;=58.14
   CREAT&gt;=1.055

 node number: 123 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&lt; 81.53
   WT&gt;=56.88
   WT&lt; 58.14

 node number: 248 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&gt;=81.53
   WT&lt; 80.57
   AGE&gt;=84.67
   AGE&lt; 86.04

 node number: 996 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&gt;=81.53
   WT&lt; 80.57
   AGE&gt;=84.67
   AGE&gt;=86.04
   CREAT&lt; 0.7409
   WT&lt; 60.25

 node number: 997 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&gt;=81.53
   WT&lt; 80.57
   AGE&gt;=84.67
   AGE&gt;=86.04
   CREAT&lt; 0.7409
   WT&gt;=60.25

 node number: 1996 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&gt;=81.53
   WT&lt; 80.57
   AGE&gt;=84.67
   AGE&gt;=86.04
   CREAT&gt;=0.7409
   CREAT&gt;=0.8719
   WT&gt;=61.77

 node number: 1997 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&gt;=81.53
   WT&lt; 80.57
   AGE&gt;=84.67
   AGE&gt;=86.04
   CREAT&gt;=0.7409
   CREAT&gt;=0.8719
   WT&lt; 61.77

 node number: 999 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&gt;=81.53
   WT&lt; 80.57
   AGE&gt;=84.67
   AGE&gt;=86.04
   CREAT&gt;=0.7409
   CREAT&lt; 0.8719

 node number: 125 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&gt;=81.53
   WT&lt; 80.57
   AGE&lt; 84.67

 node number: 63 
   root
   CON=1
   CREAT&gt;=0.5407
   CREAT&lt; 1.146
   AGE&gt;=81.53
   WT&gt;=80.57</code></pre>
</div>
</div>
<p>To evaluate the method training, the decision trees and their corresponding confusion matrices are visualized. On the visualized nodes, the first line indicates the target variable majority class in that node (YES/NO), the second line the proportion of correct predictions (= proportion of YES), and the third line the percentage of subjects in that particular node.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_TRAINED_CT<span class="sc">$</span>plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$obj
n= 1875 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

      1) root 1875 234 NO (0.875200000 0.124800000)  
        2) CON=0 1425   5 NO (0.996491228 0.003508772) *
        3) CON=1 450 221 YES (0.491111111 0.508888889)  
          6) CREAT&lt; 0.5406907 30   8 NO (0.733333333 0.266666667)  
           12) AGE&lt; 50.42605 7   0 NO (1.000000000 0.000000000) *
           13) AGE&gt;=50.42605 23   8 NO (0.652173913 0.347826087)  
             26) AGE&gt;=74.79412 7   0 NO (1.000000000 0.000000000) *
             27) AGE&lt; 74.79412 16   8 NO (0.500000000 0.500000000)  
               54) CREAT&gt;=0.4709054 11   3 NO (0.727272727 0.272727273)  
                108) AGE&lt; 63.61155 6   0 NO (1.000000000 0.000000000) *
                109) AGE&gt;=63.61155 5   2 YES (0.400000000 0.600000000) *
               55) CREAT&lt; 0.4709054 5   0 YES (0.000000000 1.000000000) *
          7) CREAT&gt;=0.5406907 420 199 YES (0.473809524 0.526190476)  
           14) CREAT&gt;=1.146159 167  76 NO (0.544910180 0.455089820)  
             28) WT&lt; 101.9952 161  70 NO (0.565217391 0.434782609)  
               56) WT&lt; 62.10829 11   1 NO (0.909090909 0.090909091) *
               57) WT&gt;=62.10829 150  69 NO (0.540000000 0.460000000)  
                114) WT&gt;=71.66666 117  48 NO (0.589743590 0.410256410)  
                  228) AGE&lt; 64.82186 22   3 NO (0.863636364 0.136363636) *
                  229) AGE&gt;=64.82186 95  45 NO (0.526315789 0.473684211)  
                    458) AGE&gt;=69.51973 78  32 NO (0.589743590 0.410256410)  
                      916) CREAT&lt; 1.194147 8   1 NO (0.875000000 0.125000000) *
                      917) CREAT&gt;=1.194147 70  31 NO (0.557142857 0.442857143)  
                       1834) CREAT&gt;=1.741118 11   2 NO (0.818181818 0.181818182) *
                       1835) CREAT&lt; 1.741118 59  29 NO (0.508474576 0.491525424)  
                         3670) WT&lt; 76.98115 15   4 NO (0.733333333 0.266666667) *
                         3671) WT&gt;=76.98115 44  19 YES (0.431818182 0.568181818)  
                           7342) AGE&lt; 81.84138 36  18 NO (0.500000000 0.500000000)  
                            14684) OBESE=0 18   7 NO (0.611111111 0.388888889)  
                              29368) CREAT&lt; 1.238723 4   0 NO (1.000000000 0.000000000) *
                              29369) CREAT&gt;=1.238723 14   7 NO (0.500000000 0.500000000)  
                                58738) CREAT&gt;=1.298427 8   2 NO (0.750000000 0.250000000) *
                                58739) CREAT&lt; 1.298427 6   1 YES (0.166666667 0.833333333) *
                            14685) OBESE=1 18   7 YES (0.388888889 0.611111111)  
                              29370) AGE&gt;=77.56952 9   4 NO (0.555555556 0.444444444)  
                                58740) CREAT&gt;=1.354561 4   1 NO (0.750000000 0.250000000) *
                                58741) CREAT&lt; 1.354561 5   2 YES (0.400000000 0.600000000) *
                              29371) AGE&lt; 77.56952 9   2 YES (0.222222222 0.777777778) *
                           7343) AGE&gt;=81.84138 8   1 YES (0.125000000 0.875000000) *
                    459) AGE&lt; 69.51973 17   4 YES (0.235294118 0.764705882) *
                115) WT&lt; 71.66666 33  12 YES (0.363636364 0.636363636)  
                  230) WT&lt; 69.6873 23  11 NO (0.521739130 0.478260870)  
                    460) SEX=1 4   0 NO (1.000000000 0.000000000) *
                    461) SEX=0 19   8 YES (0.421052632 0.578947368)  
                      922) WT&lt; 67.64966 13   6 NO (0.538461538 0.461538462)  
                       1844) WT&gt;=63.77837 9   3 NO (0.666666667 0.333333333) *
                       1845) WT&lt; 63.77837 4   1 YES (0.250000000 0.750000000) *
                      923) WT&gt;=67.64966 6   1 YES (0.166666667 0.833333333) *
                  231) WT&gt;=69.6873 10   0 YES (0.000000000 1.000000000) *
             29) WT&gt;=101.9952 6   0 YES (0.000000000 1.000000000) *
           15) CREAT&lt; 1.146159 253 108 YES (0.426877470 0.573122530)  
             30) AGE&lt; 81.5308 191  92 YES (0.481675393 0.518324607)  
               60) WT&lt; 56.88156 8   2 NO (0.750000000 0.250000000) *
               61) WT&gt;=56.88156 183  86 YES (0.469945355 0.530054645)  
                122) WT&gt;=58.14381 179  86 YES (0.480446927 0.519553073)  
                  244) CREAT&lt; 1.055043 164  82 NO (0.500000000 0.500000000)  
                    488) CREAT&gt;=1.039779 5   0 NO (1.000000000 0.000000000) *
                    489) CREAT&lt; 1.039779 159  77 YES (0.484276730 0.515723270)  
                      978) WT&lt; 86.58055 119  56 NO (0.529411765 0.470588235)  
                       1956) WT&gt;=84.27392 5   0 NO (1.000000000 0.000000000) *
                       1957) WT&lt; 84.27392 114  56 NO (0.508771930 0.491228070)  
                         3914) AGE&gt;=51.17455 101  46 NO (0.544554455 0.455445545)  
                           7828) AGE&lt; 55.70456 13   2 NO (0.846153846 0.153846154) *
                           7829) AGE&gt;=55.70456 88  44 NO (0.500000000 0.500000000)  
                            15658) CREAT&lt; 0.7382098 24   8 NO (0.666666667 0.333333333)  
                              31316) CREAT&gt;=0.7008613 5   0 NO (1.000000000 0.000000000) *
                              31317) CREAT&lt; 0.7008613 19   8 NO (0.578947368 0.421052632)  
                                62634) WT&lt; 70.50466 10   2 NO (0.800000000 0.200000000) *
                                62635) WT&gt;=70.50466 9   3 YES (0.333333333 0.666666667) *
                            15659) CREAT&gt;=0.7382098 64  28 YES (0.437500000 0.562500000)  
                              31318) WT&lt; 61.95855 8   2 NO (0.750000000 0.250000000) *
                              31319) WT&gt;=61.95855 56  22 YES (0.392857143 0.607142857)  
                                62638) AGE&gt;=60.52909 48  21 YES (0.437500000 0.562500000)  
                                 125276) AGE&lt; 69.14929 20   8 NO (0.600000000 0.400000000)  
                                   250552) AGE&gt;=67.92727 6   0 NO (1.000000000 0.000000000) *
                                   250553) AGE&lt; 67.92727 14   6 YES (0.428571429 0.571428571)  
                                     501106) AGE&lt; 65.48585 10   4 NO (0.600000000 0.400000000)  
                                      1002212) WT&gt;=70.41755 6   1 NO (0.833333333 0.166666667) *
                                      1002213) WT&lt; 70.41755 4   1 YES (0.250000000 0.750000000) *
                                     501107) AGE&gt;=65.48585 4   0 YES (0.000000000 1.000000000) *
                                 125277) AGE&gt;=69.14929 28   9 YES (0.321428571 0.678571429)  
                                   250554) CREAT&gt;=0.8210599 21   9 YES (0.428571429 0.571428571)  
                                     501108) WT&gt;=66.90488 12   5 NO (0.583333333 0.416666667)  
                                      1002216) WT&lt; 76.17987 8   2 NO (0.750000000 0.250000000) *
                                      1002217) WT&gt;=76.17987 4   1 YES (0.250000000 0.750000000) *
                                     501109) WT&lt; 66.90488 9   2 YES (0.222222222 0.777777778) *
                                   250555) CREAT&lt; 0.8210599 7   0 YES (0.000000000 1.000000000) *
                                62639) AGE&lt; 60.52909 8   1 YES (0.125000000 0.875000000) *
                         3915) AGE&lt; 51.17455 13   3 YES (0.230769231 0.769230769) *
                      979) WT&gt;=86.58055 40  14 YES (0.350000000 0.650000000)  
                       1958) AGE&lt; 51.91959 10   4 NO (0.600000000 0.400000000)  
                         3916) AGE&gt;=44.95318 5   1 NO (0.800000000 0.200000000) *
                         3917) AGE&lt; 44.95318 5   2 YES (0.400000000 0.600000000) *
                       1959) AGE&gt;=51.91959 30   8 YES (0.266666667 0.733333333)  
                         3918) CREAT&lt; 0.9259867 21   8 YES (0.380952381 0.619047619)  
                           7836) CREAT&gt;=0.7950074 9   4 NO (0.555555556 0.444444444)  
                            15672) CREAT&lt; 0.8615979 5   1 NO (0.800000000 0.200000000) *
                            15673) CREAT&gt;=0.8615979 4   1 YES (0.250000000 0.750000000) *
                           7837) CREAT&lt; 0.7950074 12   3 YES (0.250000000 0.750000000) *
                         3919) CREAT&gt;=0.9259867 9   0 YES (0.000000000 1.000000000) *
                  245) CREAT&gt;=1.055043 15   4 YES (0.266666667 0.733333333) *
                123) WT&lt; 58.14381 4   0 YES (0.000000000 1.000000000) *
             31) AGE&gt;=81.5308 62  16 YES (0.258064516 0.741935484)  
               62) WT&lt; 80.57075 46  16 YES (0.347826087 0.652173913)  
                124) AGE&gt;=84.67447 34  15 YES (0.441176471 0.558823529)  
                  248) AGE&lt; 86.03799 6   1 NO (0.833333333 0.166666667) *
                  249) AGE&gt;=86.03799 28  10 YES (0.357142857 0.642857143)  
                    498) CREAT&lt; 0.7409344 8   3 NO (0.625000000 0.375000000)  
                      996) WT&lt; 60.2531 4   0 NO (1.000000000 0.000000000) *
                      997) WT&gt;=60.2531 4   1 YES (0.250000000 0.750000000) *
                    499) CREAT&gt;=0.7409344 20   5 YES (0.250000000 0.750000000)  
                      998) CREAT&gt;=0.8718551 12   5 YES (0.416666667 0.583333333)  
                       1996) WT&gt;=61.77331 6   2 NO (0.666666667 0.333333333) *
                       1997) WT&lt; 61.77331 6   1 YES (0.166666667 0.833333333) *
                      999) CREAT&lt; 0.8718551 8   0 YES (0.000000000 1.000000000) *
                125) AGE&lt; 84.67447 12   1 YES (0.083333333 0.916666667) *
               63) WT&gt;=80.57075 16   0 YES (0.000000000 1.000000000) *

$snipped.nodes
NULL

$xlim
[1] 0 1

$ylim
[1] 0 1

$x
  [1] 0.148649696 0.004955367 0.292344025 0.040148286 0.022018600 0.058277971
  [7] 0.039081834 0.077474109 0.064676684 0.056145067 0.073208300 0.090271534
 [13] 0.544539764 0.303378654 0.192284341 0.107334767 0.277233914 0.181586493
 [19] 0.124398000 0.238774986 0.165456405 0.141461234 0.189451577 0.158524467
 [25] 0.220378688 0.175587700 0.265169675 0.235309017 0.205448358 0.192650934
 [31] 0.218245783 0.209714167 0.226777400 0.265169675 0.252372250 0.243840633
 [37] 0.260903867 0.277967100 0.295030333 0.312093567 0.372881335 0.348352938
 [43] 0.329156800 0.367549075 0.354751650 0.346220033 0.363283267 0.380346500
 [49] 0.397409733 0.414472967 0.785700875 0.604773217 0.431536200 0.778010235
 [55] 0.697903437 0.554753074 0.448599433 0.660906714 0.543680302 0.465662667
 [61] 0.621697937 0.521784708 0.482725900 0.560843515 0.512586558 0.499789133
 [67] 0.525383983 0.516852367 0.533915600 0.609100472 0.550978833 0.667222110
 [73] 0.629896287 0.587238204 0.568042067 0.606434342 0.593636917 0.585105300
 [79] 0.602168533 0.619231767 0.672554371 0.657624042 0.644826617 0.636295000
 [85] 0.653358233 0.670421467 0.687484700 0.704547933 0.721611167 0.778133127
 [91] 0.747206017 0.738674400 0.755737633 0.809060237 0.794129908 0.781332483
 [97] 0.772800866 0.789864100 0.806927333 0.823990566 0.841053800 0.858117033
[103] 0.966628533 0.938634165 0.899708664 0.875180266 0.924237062 0.900775116
[109] 0.892243500 0.909306733 0.947699008 0.934901583 0.926369966 0.943433200
[115] 0.960496433 0.977559666 0.994622900

$y
  [1] 0.98311135 0.01001217 0.93655158 0.88999181 0.01001217 0.84343204
  [7] 0.01001217 0.79687227 0.75031250 0.01001217 0.01001217 0.01001217
 [13] 0.88999181 0.84343204 0.79687227 0.01001217 0.75031250 0.70375273
 [19] 0.01001217 0.65719296 0.61063319 0.01001217 0.56407342 0.01001217
 [25] 0.51751365 0.01001217 0.47095388 0.42439411 0.37783434 0.01001217
 [31] 0.33127457 0.01001217 0.01001217 0.37783434 0.33127457 0.01001217
 [37] 0.01001217 0.01001217 0.01001217 0.01001217 0.70375273 0.65719296
 [43] 0.01001217 0.61063319 0.56407342 0.01001217 0.01001217 0.01001217
 [49] 0.01001217 0.01001217 0.84343204 0.79687227 0.01001217 0.75031250
 [55] 0.70375273 0.65719296 0.01001217 0.61063319 0.56407342 0.01001217
 [61] 0.51751365 0.47095388 0.01001217 0.42439411 0.37783434 0.01001217
 [67] 0.33127457 0.01001217 0.01001217 0.37783434 0.01001217 0.33127457
 [73] 0.28471481 0.23815504 0.01001217 0.19159527 0.14503550 0.01001217
 [79] 0.01001217 0.01001217 0.23815504 0.19159527 0.14503550 0.01001217
 [85] 0.01001217 0.01001217 0.01001217 0.01001217 0.01001217 0.56407342
 [91] 0.51751365 0.01001217 0.01001217 0.51751365 0.47095388 0.42439411
 [97] 0.01001217 0.01001217 0.01001217 0.01001217 0.01001217 0.01001217
[103] 0.79687227 0.75031250 0.70375273 0.01001217 0.65719296 0.61063319
[109] 0.01001217 0.01001217 0.61063319 0.56407342 0.01001217 0.01001217
[115] 0.01001217 0.01001217 0.01001217

$branch.x
       [,1]        [,2]      [,3]       [,4]       [,5]       [,6]       [,7]
x 0.1486497 0.004955367 0.2923440 0.04014829 0.02201860 0.05827797 0.03908183
         NA 0.004955367 0.2923440 0.04014829 0.02201860 0.05827797 0.03908183
         NA 0.148649696 0.1486497 0.29234403 0.04014829 0.04014829 0.05827797
        [,8]       [,9]      [,10]      [,11]      [,12]     [,13]     [,14]
x 0.07747411 0.06467668 0.05614507 0.07320830 0.09027153 0.5445398 0.3033787
  0.07747411 0.06467668 0.05614507 0.07320830 0.09027153 0.5445398 0.3033787
  0.05827797 0.07747411 0.06467668 0.06467668 0.07747411 0.2923440 0.5445398
      [,15]     [,16]     [,17]     [,18]     [,19]     [,20]     [,21]
x 0.1922843 0.1073348 0.2772339 0.1815865 0.1243980 0.2387750 0.1654564
  0.1922843 0.1073348 0.2772339 0.1815865 0.1243980 0.2387750 0.1654564
  0.3033787 0.1922843 0.1922843 0.2772339 0.1815865 0.1815865 0.2387750
      [,22]     [,23]     [,24]     [,25]     [,26]     [,27]     [,28]
x 0.1414612 0.1894516 0.1585245 0.2203787 0.1755877 0.2651697 0.2353090
  0.1414612 0.1894516 0.1585245 0.2203787 0.1755877 0.2651697 0.2353090
  0.1654564 0.1654564 0.1894516 0.1894516 0.2203787 0.2203787 0.2651697
      [,29]     [,30]     [,31]     [,32]     [,33]     [,34]     [,35]
x 0.2054484 0.1926509 0.2182458 0.2097142 0.2267774 0.2651697 0.2523723
  0.2054484 0.1926509 0.2182458 0.2097142 0.2267774 0.2651697 0.2523723
  0.2353090 0.2054484 0.2054484 0.2182458 0.2182458 0.2353090 0.2651697
      [,36]     [,37]     [,38]     [,39]     [,40]     [,41]     [,42]
x 0.2438406 0.2609039 0.2779671 0.2950303 0.3120936 0.3728813 0.3483529
  0.2438406 0.2609039 0.2779671 0.2950303 0.3120936 0.3728813 0.3483529
  0.2523723 0.2523723 0.2651697 0.2651697 0.2387750 0.2772339 0.3728813
      [,43]     [,44]     [,45]     [,46]     [,47]     [,48]     [,49]
x 0.3291568 0.3675491 0.3547517 0.3462200 0.3632833 0.3803465 0.3974097
  0.3291568 0.3675491 0.3547517 0.3462200 0.3632833 0.3803465 0.3974097
  0.3483529 0.3483529 0.3675491 0.3547517 0.3547517 0.3675491 0.3728813
      [,50]     [,51]     [,52]     [,53]     [,54]     [,55]     [,56]
x 0.4144730 0.7857009 0.6047732 0.4315362 0.7780102 0.6979034 0.5547531
  0.4144730 0.7857009 0.6047732 0.4315362 0.7780102 0.6979034 0.5547531
  0.3033787 0.5445398 0.7857009 0.6047732 0.6047732 0.7780102 0.6979034
      [,57]     [,58]     [,59]     [,60]     [,61]     [,62]     [,63]
x 0.4485994 0.6609067 0.5436803 0.4656627 0.6216979 0.5217847 0.4827259
  0.4485994 0.6609067 0.5436803 0.4656627 0.6216979 0.5217847 0.4827259
  0.5547531 0.5547531 0.6609067 0.5436803 0.5436803 0.6216979 0.5217847
      [,64]     [,65]     [,66]     [,67]     [,68]     [,69]     [,70]
x 0.5608435 0.5125866 0.4997891 0.5253840 0.5168524 0.5339156 0.6091005
  0.5608435 0.5125866 0.4997891 0.5253840 0.5168524 0.5339156 0.6091005
  0.5217847 0.5608435 0.5125866 0.5125866 0.5253840 0.5253840 0.5608435
      [,71]     [,72]     [,73]     [,74]     [,75]     [,76]     [,77]
x 0.5509788 0.6672221 0.6298963 0.5872382 0.5680421 0.6064343 0.5936369
  0.5509788 0.6672221 0.6298963 0.5872382 0.5680421 0.6064343 0.5936369
  0.6091005 0.6091005 0.6672221 0.6298963 0.5872382 0.5872382 0.6064343
      [,78]     [,79]     [,80]     [,81]     [,82]     [,83]     [,84]
x 0.5851053 0.6021685 0.6192318 0.6725544 0.6576240 0.6448266 0.6362950
  0.5851053 0.6021685 0.6192318 0.6725544 0.6576240 0.6448266 0.6362950
  0.5936369 0.5936369 0.6064343 0.6298963 0.6725544 0.6576240 0.6448266
      [,85]     [,86]     [,87]     [,88]     [,89]     [,90]     [,91]
x 0.6533582 0.6704215 0.6874847 0.7045479 0.7216112 0.7781331 0.7472060
  0.6533582 0.6704215 0.6874847 0.7045479 0.7216112 0.7781331 0.7472060
  0.6448266 0.6576240 0.6725544 0.6672221 0.6216979 0.6609067 0.7781331
      [,92]     [,93]     [,94]     [,95]     [,96]     [,97]     [,98]
x 0.7386744 0.7557376 0.8090602 0.7941299 0.7813325 0.7728009 0.7898641
  0.7386744 0.7557376 0.8090602 0.7941299 0.7813325 0.7728009 0.7898641
  0.7472060 0.7472060 0.7781331 0.8090602 0.7941299 0.7813325 0.7813325
      [,99]    [,100]    [,101]    [,102]    [,103]    [,104]    [,105]
x 0.8069273 0.8239906 0.8410538 0.8581170 0.9666285 0.9386342 0.8997087
  0.8069273 0.8239906 0.8410538 0.8581170 0.9666285 0.9386342 0.8997087
  0.7941299 0.8090602 0.6979034 0.7780102 0.7857009 0.9666285 0.9386342
     [,106]    [,107]    [,108]    [,109]    [,110]    [,111]    [,112]
x 0.8751803 0.9242371 0.9007751 0.8922435 0.9093067 0.9476990 0.9349016
  0.8751803 0.9242371 0.9007751 0.8922435 0.9093067 0.9476990 0.9349016
  0.8997087 0.8997087 0.9242371 0.9007751 0.9007751 0.9242371 0.9476990
     [,113]    [,114]    [,115]    [,116]    [,117]
x 0.9263700 0.9434332 0.9604964 0.9775597 0.9946229
  0.9263700 0.9434332 0.9604964 0.9775597 0.9946229
  0.9349016 0.9349016 0.9476990 0.9386342 0.9666285

$branch.y
      [,1]       [,2]      [,3]      [,4]       [,5]      [,6]       [,7]
y 1.001852 0.02875275 0.9552922 0.9087324 0.02875275 0.8621726 0.02875275
        NA 0.95837830 0.9583783 0.9118185 0.86525877 0.8652588 0.81869900
        NA 0.95837830 0.9583783 0.9118185 0.86525877 0.8652588 0.81869900
       [,8]      [,9]      [,10]      [,11]      [,12]     [,13]     [,14]
y 0.8156129 0.7690531 0.02875275 0.02875275 0.02875275 0.9087324 0.8621726
  0.8186990 0.7721392 0.72557946 0.72557946 0.77213923 0.9118185 0.8652588
  0.8186990 0.7721392 0.72557946 0.72557946 0.77213923 0.9118185 0.8652588
      [,15]      [,16]     [,17]     [,18]      [,19]     [,20]     [,21]
y 0.8156129 0.02875275 0.7690531 0.7224933 0.02875275 0.6759335 0.6293738
  0.8186990 0.77213923 0.7721392 0.7255795 0.67901969 0.6790197 0.6324599
  0.8186990 0.77213923 0.7721392 0.7255795 0.67901969 0.6790197 0.6324599
       [,22]     [,23]      [,24]     [,25]      [,26]     [,27]     [,28]
y 0.02875275 0.5828140 0.02875275 0.5362542 0.02875275 0.4896945 0.4431347
  0.58590015 0.5859001 0.53934038 0.5393404 0.49278061 0.4927806 0.4462208
  0.58590015 0.5859001 0.53934038 0.5393404 0.49278061 0.4927806 0.4462208
      [,29]      [,30]     [,31]      [,32]      [,33]     [,34]     [,35]
y 0.3965749 0.02875275 0.3500152 0.02875275 0.02875275 0.3965749 0.3500152
  0.3996611 0.35310130 0.3531013 0.30654153 0.30654153 0.3996611 0.3531013
  0.3996611 0.35310130 0.3531013 0.30654153 0.30654153 0.3996611 0.3531013
       [,36]      [,37]      [,38]      [,39]      [,40]     [,41]     [,42]
y 0.02875275 0.02875275 0.02875275 0.02875275 0.02875275 0.7224933 0.6759335
  0.30654153 0.30654153 0.35310130 0.44622084 0.63245992 0.7255795 0.6790197
  0.30654153 0.30654153 0.35310130 0.44622084 0.63245992 0.7255795 0.6790197
       [,43]     [,44]     [,45]      [,46]      [,47]      [,48]      [,49]
y 0.02875275 0.6293738 0.5828140 0.02875275 0.02875275 0.02875275 0.02875275
  0.63245992 0.6324599 0.5859001 0.53934038 0.53934038 0.58590015 0.67901969
  0.63245992 0.6324599 0.5859001 0.53934038 0.53934038 0.58590015 0.67901969
       [,50]     [,51]     [,52]      [,53]     [,54]     [,55]     [,56]
y 0.02875275 0.8621726 0.8156129 0.02875275 0.7690531 0.7224933 0.6759335
  0.81869900 0.8652588 0.8186990 0.77213923 0.7721392 0.7255795 0.6790197
  0.81869900 0.8652588 0.8186990 0.77213923 0.7721392 0.7255795 0.6790197
       [,57]     [,58]     [,59]      [,60]     [,61]     [,62]      [,63]
y 0.02875275 0.6293738 0.5828140 0.02875275 0.5362542 0.4896945 0.02875275
  0.63245992 0.6324599 0.5859001 0.53934038 0.5393404 0.4927806 0.44622084
  0.63245992 0.6324599 0.5859001 0.53934038 0.5393404 0.4927806 0.44622084
      [,64]     [,65]      [,66]     [,67]      [,68]      [,69]     [,70]
y 0.4431347 0.3965749 0.02875275 0.3500152 0.02875275 0.02875275 0.3965749
  0.4462208 0.3996611 0.35310130 0.3531013 0.30654153 0.30654153 0.3996611
  0.4462208 0.3996611 0.35310130 0.3531013 0.30654153 0.30654153 0.3996611
       [,71]     [,72]     [,73]     [,74]      [,75]     [,76]     [,77]
y 0.02875275 0.3500152 0.3034554 0.2568956 0.02875275 0.2103358 0.1637761
  0.35310130 0.3531013 0.3065415 0.2599818 0.21342199 0.2134220 0.1668622
  0.35310130 0.3531013 0.3065415 0.2599818 0.21342199 0.2134220 0.1668622
       [,78]      [,79]      [,80]     [,81]     [,82]     [,83]      [,84]
y 0.02875275 0.02875275 0.02875275 0.2568956 0.2103358 0.1637761 0.02875275
  0.12030245 0.12030245 0.16686222 0.2599818 0.2134220 0.1668622 0.12030245
  0.12030245 0.12030245 0.16686222 0.2599818 0.2134220 0.1668622 0.12030245
       [,85]      [,86]      [,87]      [,88]      [,89]     [,90]     [,91]
y 0.02875275 0.02875275 0.02875275 0.02875275 0.02875275 0.5828140 0.5362542
  0.12030245 0.16686222 0.21342199 0.30654153 0.49278061 0.5859001 0.5393404
  0.12030245 0.16686222 0.21342199 0.30654153 0.49278061 0.5859001 0.5393404
       [,92]      [,93]     [,94]     [,95]     [,96]      [,97]      [,98]
y 0.02875275 0.02875275 0.5362542 0.4896945 0.4431347 0.02875275 0.02875275
  0.49278061 0.49278061 0.5393404 0.4927806 0.4462208 0.39966107 0.39966107
  0.49278061 0.49278061 0.5393404 0.4927806 0.4462208 0.39966107 0.39966107
       [,99]     [,100]     [,101]     [,102]    [,103]    [,104]    [,105]
y 0.02875275 0.02875275 0.02875275 0.02875275 0.8156129 0.7690531 0.7224933
  0.44622084 0.49278061 0.67901969 0.72557946 0.8186990 0.7721392 0.7255795
  0.44622084 0.49278061 0.67901969 0.72557946 0.8186990 0.7721392 0.7255795
      [,106]    [,107]    [,108]     [,109]     [,110]    [,111]    [,112]
y 0.02875275 0.6759335 0.6293738 0.02875275 0.02875275 0.6293738 0.5828140
  0.67901969 0.6790197 0.6324599 0.58590015 0.58590015 0.6324599 0.5859001
  0.67901969 0.6790197 0.6324599 0.58590015 0.58590015 0.6324599 0.5859001
      [,113]     [,114]     [,115]     [,116]     [,117]
y 0.02875275 0.02875275 0.02875275 0.02875275 0.02875275
  0.53934038 0.53934038 0.58590015 0.72557946 0.77213923
  0.53934038 0.53934038 0.58590015 0.72557946 0.77213923

$labs
  [1] "NO\n0.12\n100%" "NO\n0.00\n76%"  "YES\n0.51\n24%" "NO\n0.27\n2%"  
  [5] "NO\n0.00\n0%"   "NO\n0.35\n1%"   "NO\n0.00\n0%"   "NO\n0.50\n1%"  
  [9] "NO\n0.27\n1%"   "NO\n0.00\n0%"   "YES\n0.60\n0%"  "YES\n1.00\n0%" 
 [13] "YES\n0.53\n22%" "NO\n0.46\n9%"   "NO\n0.43\n9%"   "NO\n0.09\n1%"  
 [17] "NO\n0.46\n8%"   "NO\n0.41\n6%"   "NO\n0.14\n1%"   "NO\n0.47\n5%"  
 [21] "NO\n0.41\n4%"   "NO\n0.12\n0%"   "NO\n0.44\n4%"   "NO\n0.18\n1%"  
 [25] "NO\n0.49\n3%"   "NO\n0.27\n1%"   "YES\n0.57\n2%"  "NO\n0.50\n2%"  
 [29] "NO\n0.39\n1%"   "NO\n0.00\n0%"   "NO\n0.50\n1%"   "NO\n0.25\n0%"  
 [33] "YES\n0.83\n0%"  "YES\n0.61\n1%"  "NO\n0.44\n0%"   "NO\n0.25\n0%"  
 [37] "YES\n0.60\n0%"  "YES\n0.78\n0%"  "YES\n0.88\n0%"  "YES\n0.76\n1%" 
 [41] "YES\n0.64\n2%"  "NO\n0.48\n1%"   "NO\n0.00\n0%"   "YES\n0.58\n1%" 
 [45] "NO\n0.46\n1%"   "NO\n0.33\n0%"   "YES\n0.75\n0%"  "YES\n0.83\n0%" 
 [49] "YES\n1.00\n1%"  "YES\n1.00\n0%"  "YES\n0.57\n13%" "YES\n0.52\n10%"
 [53] "NO\n0.25\n0%"   "YES\n0.53\n10%" "YES\n0.52\n10%" "NO\n0.50\n9%"  
 [57] "NO\n0.00\n0%"   "YES\n0.52\n8%"  "NO\n0.47\n6%"   "NO\n0.00\n0%"  
 [61] "NO\n0.49\n6%"   "NO\n0.46\n5%"   "NO\n0.15\n1%"   "NO\n0.50\n5%"  
 [65] "NO\n0.33\n1%"   "NO\n0.00\n0%"   "NO\n0.42\n1%"   "NO\n0.20\n1%"  
 [69] "YES\n0.67\n0%"  "YES\n0.56\n3%"  "NO\n0.25\n0%"   "YES\n0.61\n3%" 
 [73] "YES\n0.56\n3%"  "NO\n0.40\n1%"   "NO\n0.00\n0%"   "YES\n0.57\n1%" 
 [77] "NO\n0.40\n1%"   "NO\n0.17\n0%"   "YES\n0.75\n0%"  "YES\n1.00\n0%" 
 [81] "YES\n0.68\n1%"  "YES\n0.57\n1%"  "NO\n0.42\n1%"   "NO\n0.25\n0%"  
 [85] "YES\n0.75\n0%"  "YES\n0.78\n0%"  "YES\n1.00\n0%"  "YES\n0.88\n0%" 
 [89] "YES\n0.77\n1%"  "YES\n0.65\n2%"  "NO\n0.40\n1%"   "NO\n0.20\n0%"  
 [93] "YES\n0.60\n0%"  "YES\n0.73\n2%"  "YES\n0.62\n1%"  "NO\n0.44\n0%"  
 [97] "NO\n0.20\n0%"   "YES\n0.75\n0%"  "YES\n0.75\n1%"  "YES\n1.00\n0%" 
[101] "YES\n0.73\n1%"  "YES\n1.00\n0%"  "YES\n0.74\n3%"  "YES\n0.65\n2%" 
[105] "YES\n0.56\n2%"  "NO\n0.17\n0%"   "YES\n0.64\n1%"  "NO\n0.38\n0%"  
[109] "NO\n0.00\n0%"   "YES\n0.75\n0%"  "YES\n0.75\n1%"  "YES\n0.58\n1%" 
[113] "NO\n0.33\n0%"   "YES\n0.83\n0%"  "YES\n1.00\n0%"  "YES\n0.92\n1%" 
[117] "YES\n1.00\n1%" 

$cex
[1] 0.15

$boxes
$boxes$x1
  [1]  0.141405377 -0.001010543  0.286378115  0.034182376  0.016052691
  [6]  0.052312062  0.033115924  0.071508199  0.058710774  0.050179157
 [11]  0.067242391  0.084305624  0.538573855  0.297412744  0.186318431
 [16]  0.101368857  0.271268005  0.175620584  0.118432091  0.232809077
 [21]  0.159490496  0.135495324  0.183485668  0.152558557  0.214412778
 [26]  0.169621791  0.259203766  0.229343107  0.199482449  0.186685024
 [31]  0.212279874  0.203748257  0.220811491  0.259203766  0.246406341
 [36]  0.237874724  0.254937957  0.272001191  0.289064424  0.306127657
 [41]  0.366915426  0.342387028  0.323190891  0.361583166  0.348785741
 [46]  0.340254124  0.357317357  0.374380590  0.391443824  0.408507057
 [51]  0.779734965  0.598807308  0.425570290  0.772044325  0.691937527
 [56]  0.548787164  0.442633524  0.654940805  0.537714392  0.459696757
 [61]  0.615732027  0.515818798  0.476759990  0.554877605  0.506620649
 [66]  0.493823224  0.519418074  0.510886457  0.527949690  0.603134562
 [71]  0.545012924  0.661256201  0.623930378  0.581272295  0.562076157
 [76]  0.600468432  0.587671007  0.579139390  0.596202624  0.613265857
 [81]  0.666588461  0.651658132  0.638860707  0.630329090  0.647392324
 [86]  0.664455557  0.681518790  0.698582024  0.715645257  0.772167217
 [91]  0.741240107  0.732708490  0.749771724  0.803094328  0.788163999
 [96]  0.775366574  0.766834957  0.783898190  0.800961424  0.818024657
[101]  0.835087890  0.852151124  0.960662623  0.932668256  0.893742755
[106]  0.869214357  0.918271153  0.894809207  0.886277590  0.903340824
[111]  0.941733098  0.928935674  0.920404057  0.937467290  0.954530523
[116]  0.971593757  0.988656990

$boxes$y1
  [1]  0.971437352 -0.001661831  0.924877582  0.878317812 -0.001661831
  [6]  0.831758043 -0.001661831  0.785198273  0.738638504 -0.001661831
 [11] -0.001661831 -0.001661831  0.878317812  0.831758043  0.785198273
 [16] -0.001661831  0.738638504  0.692078734 -0.001661831  0.645518965
 [21]  0.598959195 -0.001661831  0.552399426 -0.001661831  0.505839656
 [26] -0.001661831  0.459279887  0.412720117  0.366160348 -0.001661831
 [31]  0.319600578 -0.001661831 -0.001661831  0.366160348  0.319600578
 [36] -0.001661831 -0.001661831 -0.001661831 -0.001661831 -0.001661831
 [41]  0.692078734  0.645518965 -0.001661831  0.598959195  0.552399426
 [46] -0.001661831 -0.001661831 -0.001661831 -0.001661831 -0.001661831
 [51]  0.831758043  0.785198273 -0.001661831  0.738638504  0.692078734
 [56]  0.645518965 -0.001661831  0.598959195  0.552399426 -0.001661831
 [61]  0.505839656  0.459279887 -0.001661831  0.412720117  0.366160348
 [66] -0.001661831  0.319600578 -0.001661831 -0.001661831  0.366160348
 [71] -0.001661831  0.319600578  0.273040809  0.226481039 -0.001661831
 [76]  0.179921270  0.133361500 -0.001661831 -0.001661831 -0.001661831
 [81]  0.226481039  0.179921270  0.133361500 -0.001661831 -0.001661831
 [86] -0.001661831 -0.001661831 -0.001661831 -0.001661831  0.552399426
 [91]  0.505839656 -0.001661831 -0.001661831  0.505839656  0.459279887
 [96]  0.412720117 -0.001661831 -0.001661831 -0.001661831 -0.001661831
[101] -0.001661831 -0.001661831  0.785198273  0.738638504  0.692078734
[106] -0.001661831  0.645518965  0.598959195 -0.001661831 -0.001661831
[111]  0.598959195  0.552399426 -0.001661831 -0.001661831 -0.001661831
[116] -0.001661831 -0.001661831

$boxes$x2
  [1] 0.15589401 0.01092128 0.29830993 0.04611420 0.02798451 0.06424388
  [7] 0.04504774 0.08344002 0.07064259 0.06211098 0.07917421 0.09623744
 [13] 0.55050567 0.30934456 0.19825025 0.11330068 0.28319982 0.18755240
 [19] 0.13036391 0.24474090 0.17142231 0.14742714 0.19541749 0.16449038
 [25] 0.22634460 0.18155361 0.27113558 0.24127493 0.21141427 0.19861684
 [31] 0.22421169 0.21568008 0.23274331 0.27113558 0.25833816 0.24980654
 [37] 0.26686978 0.28393301 0.30099624 0.31805948 0.37884725 0.35431885
 [43] 0.33512271 0.37351498 0.36071756 0.35218594 0.36924918 0.38631241
 [49] 0.40337564 0.42043888 0.79166678 0.61073913 0.43750211 0.78397614
 [55] 0.70386935 0.56071898 0.45456534 0.66687262 0.54964621 0.47162858
 [61] 0.62766385 0.52775062 0.48869181 0.56680942 0.51855247 0.50575504
 [67] 0.53134989 0.52281828 0.53988151 0.61506638 0.55694474 0.67318802
 [73] 0.63586220 0.59320411 0.57400798 0.61240025 0.59960283 0.59107121
 [79] 0.60813444 0.62519768 0.67852028 0.66358995 0.65079253 0.64226091
 [85] 0.65932414 0.67638738 0.69345061 0.71051384 0.72757708 0.78409904
 [91] 0.75317193 0.74464031 0.76170354 0.81502615 0.80009582 0.78729839
 [97] 0.77876678 0.79583001 0.81289324 0.82995648 0.84701971 0.86408294
[103] 0.97259444 0.94460007 0.90567457 0.88114618 0.93020297 0.90674103
[109] 0.89820941 0.91527264 0.95366492 0.94086749 0.93233588 0.94939911
[115] 0.96646234 0.98352558 1.00058881

$boxes$y2
  [1] 1.00185193 0.02875275 0.95529216 0.90873239 0.02875275 0.86217262
  [7] 0.02875275 0.81561285 0.76905308 0.02875275 0.02875275 0.02875275
 [13] 0.90873239 0.86217262 0.81561285 0.02875275 0.76905308 0.72249331
 [19] 0.02875275 0.67593354 0.62937377 0.02875275 0.58281400 0.02875275
 [25] 0.53625423 0.02875275 0.48969446 0.44313469 0.39657492 0.02875275
 [31] 0.35001516 0.02875275 0.02875275 0.39657492 0.35001516 0.02875275
 [37] 0.02875275 0.02875275 0.02875275 0.02875275 0.72249331 0.67593354
 [43] 0.02875275 0.62937377 0.58281400 0.02875275 0.02875275 0.02875275
 [49] 0.02875275 0.02875275 0.86217262 0.81561285 0.02875275 0.76905308
 [55] 0.72249331 0.67593354 0.02875275 0.62937377 0.58281400 0.02875275
 [61] 0.53625423 0.48969446 0.02875275 0.44313469 0.39657492 0.02875275
 [67] 0.35001516 0.02875275 0.02875275 0.39657492 0.02875275 0.35001516
 [73] 0.30345539 0.25689562 0.02875275 0.21033585 0.16377608 0.02875275
 [79] 0.02875275 0.02875275 0.25689562 0.21033585 0.16377608 0.02875275
 [85] 0.02875275 0.02875275 0.02875275 0.02875275 0.02875275 0.58281400
 [91] 0.53625423 0.02875275 0.02875275 0.53625423 0.48969446 0.44313469
 [97] 0.02875275 0.02875275 0.02875275 0.02875275 0.02875275 0.02875275
[103] 0.81561285 0.76905308 0.72249331 0.02875275 0.67593354 0.62937377
[109] 0.02875275 0.02875275 0.62937377 0.58281400 0.02875275 0.02875275
[115] 0.02875275 0.02875275 0.02875275


$split.labs
[1] ""

$split.cex
  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 [38] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
 [75] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
[112] 1 1 1 1 1 1

$split.box
$split.box$x1
  [1] 0.13842242         NA 0.27657698 0.02906874         NA 0.04592002
  [7]         NA 0.06042865 0.05359714         NA         NA         NA
 [13] 0.52877272 0.29229911 0.18248320         NA 0.26615437 0.17050695
 [19]         NA 0.22641703 0.15096777         NA 0.17368453         NA
 [25] 0.21057755         NA 0.25409013 0.22295106 0.19095972         NA
 [31] 0.20247874         NA         NA 0.25281172 0.23660520         NA
 [37]         NA         NA         NA         NA 0.36308020 0.33940407
 [43]         NA 0.35774794 0.34367210         NA         NA         NA
 [49]         NA         NA 0.77462133 0.59497208         NA 0.76693069
 [55] 0.68341480 0.54069057         NA 0.65110558 0.53260076         NA
 [61] 0.60933998 0.51070516         NA 0.54507647 0.49681951         NA
 [67] 0.51558285         NA         NA 0.59929933         NA 0.65486415
 [73] 0.61881674 0.57488025         NA 0.59535480 0.58255737         NA
 [79]         NA         NA 0.65550891 0.64654450 0.63502548         NA
 [85]         NA         NA         NA         NA         NA 0.76705358
 [91] 0.73484806         NA         NA 0.79329319 0.77836286 0.76556544
 [97]         NA         NA         NA         NA         NA         NA
[103] 0.95682740 0.92627621 0.88862912         NA 0.90847002 0.89097398
[109]         NA         NA 0.93065355 0.92382204         NA         NA
[115]         NA         NA         NA

$split.box$y1
  [1] 0.9513117        NA 0.9047520 0.8581922        NA 0.8116324        NA
  [8] 0.7650726 0.7185129        NA        NA        NA 0.8581922 0.8116324
 [15] 0.7650726        NA 0.7185129 0.6719531        NA 0.6253933 0.5788336
 [22]        NA 0.5322738        NA 0.4857140        NA 0.4391543 0.3925945
 [29] 0.3460347        NA 0.2994749        NA        NA 0.3460347 0.2994749
 [36]        NA        NA        NA        NA        NA 0.6719531 0.6253933
 [43]        NA 0.5788336 0.5322738        NA        NA        NA        NA
 [50]        NA 0.8116324 0.7650726        NA 0.7185129 0.6719531 0.6253933
 [57]        NA 0.5788336 0.5322738        NA 0.4857140 0.4391543        NA
 [64] 0.3925945 0.3460347        NA 0.2994749        NA        NA 0.3460347
 [71]        NA 0.2994749 0.2529152 0.2063554        NA 0.1597956 0.1132359
 [78]        NA        NA        NA 0.2063554 0.1597956 0.1132359        NA
 [85]        NA        NA        NA        NA        NA 0.5322738 0.4857140
 [92]        NA        NA 0.4857140 0.4391543 0.3925945        NA        NA
 [99]        NA        NA        NA        NA 0.7650726 0.7185129 0.6719531
[106]        NA 0.6253933 0.5788336        NA        NA 0.5788336 0.5322738
[113]        NA        NA        NA        NA        NA

$split.box$x2
  [1] 0.15887697         NA 0.30811107 0.05122783         NA 0.07063593
  [7]         NA 0.09451956 0.07575623         NA         NA         NA
 [13] 0.56030681 0.31445820 0.20208548         NA 0.28831346 0.19266604
 [19]         NA 0.25113294 0.17994504         NA 0.20521862         NA
 [25] 0.23017982         NA 0.27624922 0.24766697 0.21993700         NA
 [31] 0.23401283         NA         NA 0.27752763 0.26813930         NA
 [37]         NA         NA         NA         NA 0.38268247 0.35730180
 [43]         NA 0.37735021 0.36583120         NA         NA         NA
 [49]         NA         NA 0.79678042 0.61457435         NA 0.78908978
 [55] 0.71239207 0.56881557         NA 0.67070785 0.55475985         NA
 [61] 0.63405589 0.53286425         NA 0.57661056 0.52835361         NA
 [67] 0.53518512         NA         NA 0.61890161         NA 0.67958007
 [73] 0.64097583 0.59959616         NA 0.61751389 0.60471646         NA
 [79]         NA         NA 0.68959983 0.66870359 0.65462775         NA
 [85]         NA         NA         NA         NA         NA 0.78921267
 [91] 0.75956397         NA         NA 0.82482728 0.80989695 0.79709953
 [97]         NA         NA         NA         NA         NA         NA
[103] 0.97642967 0.95099212 0.91078821         NA 0.94000411 0.91057625
[109]         NA         NA 0.96474446 0.94598113         NA         NA
[115]         NA         NA         NA

$split.box$y2
  [1] 0.9654449        NA 0.9188851 0.8723253        NA 0.8257656        NA
  [8] 0.7792058 0.7326460        NA        NA        NA 0.8723253 0.8257656
 [15] 0.7792058        NA 0.7326460 0.6860863        NA 0.6395265 0.5929667
 [22]        NA 0.5464070        NA 0.4998472        NA 0.4532874 0.4067277
 [29] 0.3601679        NA 0.3136081        NA        NA 0.3601679 0.3136081
 [36]        NA        NA        NA        NA        NA 0.6860863 0.6395265
 [43]        NA 0.5929667 0.5464070        NA        NA        NA        NA
 [50]        NA 0.8257656 0.7792058        NA 0.7326460 0.6860863 0.6395265
 [57]        NA 0.5929667 0.5464070        NA 0.4998472 0.4532874        NA
 [64] 0.4067277 0.3601679        NA 0.3136081        NA        NA 0.3601679
 [71]        NA 0.3136081 0.2670483 0.2204886        NA 0.1739288 0.1273690
 [78]        NA        NA        NA 0.2204886 0.1739288 0.1273690        NA
 [85]        NA        NA        NA        NA        NA 0.5464070 0.4998472
 [92]        NA        NA 0.4998472 0.4532874 0.4067277        NA        NA
 [99]        NA        NA        NA        NA 0.7792058 0.7326460 0.6860863
[106]        NA 0.6395265 0.5929667        NA        NA 0.5929667 0.5464070
[113]        NA        NA        NA        NA        NA</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_TRAINED_CT_confusion_matrix <span class="ot">&lt;-</span> AMOX_CMIN_TRAINED_CT<span class="sc">$</span>confusion_matrix</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(AMOX_CMIN_TRAINED_CT_confusion_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$CARLIER</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-train-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-46"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-train-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$FOURNIER</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-train-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-47"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-train-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$MELLON</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-train-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-48"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-train-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$RAMBAUD</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-train-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-49"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-train-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>cfit_list <span class="ot">&lt;-</span> AMOX_CMIN_TRAINED_CT<span class="sc">$</span>cfit_list</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the plot of the four trees</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="fu">jpeg</span>(<span class="fu">here</span>(<span class="st">"Amoxicillin/Figures/S7.jpg"</span>), <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">7</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">res =</span> <span class="dv">300</span>)</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>n_trees <span class="ot">&lt;-</span> <span class="fu">length</span>(cfit_list)</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="fu">ceiling</span>(n_trees <span class="sc">/</span> <span class="dv">2</span>), <span class="dv">2</span>))</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (model_name <span class="cf">in</span> <span class="fu">names</span>(cfit_list)) {</span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart.plot</span>(cfit_list[[model_name]],</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">main =</span> model_name,</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">roundint =</span> <span class="cn">FALSE</span>)</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the plot of the four confusion matrices</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>confusion_plot <span class="ot">&lt;-</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  (AMOX_CMIN_TRAINED_CT_confusion_matrix<span class="sc">$</span>CARLIER  <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Carlier"</span>))  <span class="sc">+</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  (AMOX_CMIN_TRAINED_CT_confusion_matrix<span class="sc">$</span>FOURNIER <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Fournier"</span>)) <span class="sc">+</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  (AMOX_CMIN_TRAINED_CT_confusion_matrix<span class="sc">$</span>MELLON   <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Mellon"</span>))   <span class="sc">+</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>  (AMOX_CMIN_TRAINED_CT_confusion_matrix<span class="sc">$</span>RAMBAUD  <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Rambaud"</span>))  <span class="sc">+</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">here</span>(<span class="st">"Amoxicillin/Figures/S8.jpg"</span>),</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> confusion_plot,</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">7</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_CT <span class="ot">&lt;-</span> <span class="fu">classification_tree_model_ensembling_test</span>(</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">test_data =</span> AMOX_CMIN_TEST, </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">train_results =</span> AMOX_CMIN_TRAINED_CT) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To evaluate the method, a predictions as a function of observed concentrations goodness of fit plot is presented as well a boxplot indicating the predicted/observed ratios in %. Then, the average model weights are plotted, stratified by covariate categories/quantiles.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>test_data_CT <span class="ot">&lt;-</span> AMOX_CMIN_PRED_TEST_CT<span class="sc">$</span>test_results</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_CT<span class="sc">$</span>GOF_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-50"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_PRED_TEST_CT<span class="sc">$</span>Boxplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-51"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots showing the average attributed weight stratified by covariates</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>weight_BURN_CT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_CT, <span class="st">"BURN"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>weight_ICU_CT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_CT, <span class="st">"ICU"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>weight_OBESE_CT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_CT, <span class="st">"OBESE"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>weight_CREAT_CT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_CT, <span class="st">"CREAT"</span>, <span class="at">is_categorical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>weight_WT_CT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_CT, <span class="st">"WT"</span>, <span class="at">is_categorical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>weight_AGE_CT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_CT, <span class="st">"AGE"</span>, <span class="at">is_categorical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>weight_SEX_CT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_CT, <span class="st">"SEX"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>weight_CON_CT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_CT, <span class="st">"CON"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>weight_BURN_CT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-52"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>weight_ICU_CT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-53"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>weight_OBESE_CT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-54"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-5.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>weight_CREAT_CT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-6.png" class="lightbox" data-gallery="quarto-lightbox-gallery-55"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-6.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>weight_WT_CT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-7.png" class="lightbox" data-gallery="quarto-lightbox-gallery-56"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-7.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>weight_AGE_CT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-8.png" class="lightbox" data-gallery="quarto-lightbox-gallery-57"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-8.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>weight_SEX_CT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-9.png" class="lightbox" data-gallery="quarto-lightbox-gallery-58"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-9.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>weight_CON_CT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-10.png" class="lightbox" data-gallery="quarto-lightbox-gallery-59"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-10.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print overall average weight</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>test_data_CT <span class="sc">%&gt;%</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(MODEL) <span class="sc">%&gt;%</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_weight =</span> <span class="fu">mean</span>(WEIGHT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 2
  MODEL    avg_weight
  &lt;chr&gt;         &lt;dbl&gt;
1 CARLIER       0.319
2 FOURNIER      0.389
3 MELLON        0.179
4 RAMBAUD       0.113</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrapolate dose based on the ensembled concentrations and compare it to the true simulated dose.</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>test_data_CT <span class="ot">&lt;-</span> test_data_CT <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(REFERENCE <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DOSE_PRED =</span> (<span class="dv">60</span><span class="sc">/</span>WEIGHTED_PREDICTION) <span class="sc">*</span> DOSE_ADM) <span class="co"># Administered dose extrapolation to reach 60 mg/L</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>final_results_CT <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(test_data_CT)</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>final_results_CT<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-11.png" class="lightbox" data-gallery="quarto-lightbox-gallery-60"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-11.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_CT <span class="ot">&lt;-</span> final_results_CT<span class="sc">$</span>crcl_plot</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_CT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-12.png" class="lightbox" data-gallery="quarto-lightbox-gallery-61"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-ct-test-12.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>final_results_CT<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     0.966    0.513    79.0  15.5     64.2   15.7   186
2 Incorrect                   0.943    0.606    86.8  19.5     58.0   16.3   414
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep data for method ensembling</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>test_data_CT_ens <span class="ot">&lt;-</span> test_data_CT <span class="sc">%&gt;%</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CT =</span> DOSE_PRED) <span class="sc">%&gt;%</span> </span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"ID"</span>,<span class="st">"CT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="regression-tree-informed-ensembling" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Regression tree informed ensembling</h1>
<p>This method is similar to the previous decision tree-based method, with the difference that not prediction correctness is used as a target variable, but the log-transformed prediction/observation ratio:</p>
<p><span class="math display">\[
\text{Ratio} = \left( log (\frac{predicted}{true}) \right)
\]</span></p>
<p>Therefore these are not classification, but regression trees.</p>
<p>Our <em>openMIPD</em> package is used to apply this method.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>train_results_RT <span class="ot">&lt;-</span> <span class="fu">regression_tree_model_ensembling_train</span>(</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> AMOX_CMIN_TRAIN, </span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_variable =</span> <span class="st">"CMIN"</span>, </span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">continuous_cov =</span> <span class="fu">c</span>(<span class="st">"WT"</span>, <span class="st">"CREAT"</span>, <span class="st">"AGE"</span>), </span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">categorical_cov =</span> <span class="fu">c</span>(<span class="st">"OBESE"</span>, <span class="st">"ICU"</span>, <span class="st">"BURN"</span>, <span class="st">"SEX"</span>, <span class="st">"CON"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/train-RT-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-62"><img src="Precision_dosing_methods_files/figure-html/train-RT-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/train-RT-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-63"><img src="Precision_dosing_methods_files/figure-html/train-RT-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/train-RT-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-64"><img src="Precision_dosing_methods_files/figure-html/train-RT-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/train-RT-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-65"><img src="Precision_dosing_methods_files/figure-html/train-RT-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>To evaluate the method training, the regression trees are visualized. On the visualized nodes, the first line indicates average log-transformed prediction/observation ratio and the second line, percentage of subjects in that particular node.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>model_trees <span class="ot">&lt;-</span> train_results_RT<span class="sc">$</span>model_trees</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_trees)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$CARLIER
n= 1875 

node), split, n, deviance, yval
      * denotes terminal node

 1) root 1875 2722.349000  0.7215246  
   2) ICU=1 1400 1254.040000  0.3662242  
     4) BURN=0 925  584.076200  0.1997434 *
     5) BURN=1 475  594.401200  0.6904237  
      10) CREAT&lt; 0.5087704 76  103.572900 -0.4073936  
        20) AGE&gt;=90.55131 9   12.324480 -2.1388150 *
        21) AGE&lt; 90.55131 67   60.643800 -0.1748146 *
      11) CREAT&gt;=0.5087704 399  381.786200  0.8995317  
        22) CREAT&lt; 0.9848673 253  225.506200  0.6357652 *
        23) CREAT&gt;=0.9848673 146  108.176100  1.3566070 *
   3) ICU=0 475  770.676800  1.7687260  
     6) CREAT&lt; 0.6594764 202  182.581600  1.3189530 *
     7) CREAT&gt;=0.6594764 273  516.995300  2.1015250  
      14) CREAT&gt;=0.6603812 270  469.309000  2.0584990  
        28) WT&gt;=110.0654 116  171.808100  1.7276860 *
        29) WT&lt; 110.0654 154  275.244000  2.3076830 *
      15) CREAT&lt; 0.6603812 3    2.202036  5.9738390 *

$FOURNIER
n= 1875 

node), split, n, deviance, yval
      * denotes terminal node

 1) root 1875 2668.353000  0.29249860  
   2) ICU=1 1400 1254.534000 -0.06534612  
     4) CREAT&gt;=1.279099 304  218.536600 -0.49097220  
       8) BURN=0 214  122.258400 -0.73177000  
        16) CON=0 98   44.940400 -1.29009300 *
        17) CON=1 116   20.960400 -0.26008340 *
       9) BURN=1 90   54.365010  0.08159171 *
     5) CREAT&lt; 1.279099 1096  965.650100  0.05271073 *
   3) ICU=0 475  706.159000  1.34719900  
     6) CREAT&lt; 0.6594764 202  172.563800  0.99242950 *
     7) CREAT&gt;=0.6594764 273  489.359400  1.60970200  
      14) CREAT&gt;=0.6603812 270  440.864100  1.56628600 *
      15) CREAT&lt; 0.6603812 3    2.182976  5.51710600 *

$MELLON
n= 1875 

node), split, n, deviance, yval
      * denotes terminal node

 1) root 1875 32866.19000 -2.52319600  
   2) CON=1 450   118.99190 -9.50437800  
     4) CREAT&gt;=1.123887 175    37.91400 -9.89345100 *
     5) CREAT&lt; 1.123887 275    37.72864 -9.25678500 *
   3) CON=0 1425  3889.82100 -0.31861170  
     6) CREAT&gt;=1.153214 228   306.36100 -2.37156900  
      12) BURN=0 120    96.38875 -3.02996000 *
      13) BURN=1 108   100.15760 -1.64002300 *
     7) CREAT&lt; 1.153214 1197  2439.48900  0.07242772  
      14) ICU=1 724  1282.75200 -0.44429380  
        28) CREAT&gt;=0.6333707 396   497.33880 -0.93833000  
          56) AGE&gt;=52.98266 243   240.10380 -1.25474200 *
          57) AGE&lt; 52.98266 153   194.26780 -0.43579410 *
        29) CREAT&lt; 0.6333707 328   572.07040  0.15216460  
          58) AGE&gt;=47.39281 233   427.46600 -0.07053408 *
          59) AGE&lt; 47.39281 95   104.70730  0.69836230 *
      15) ICU=0 473   667.53890  0.86335030 *

$RAMBAUD
n=1873 (2 observations effacÃ©es parce que manquantes)

node), split, n, deviance, yval
      * denotes terminal node

 1) root 1873 63965.02000  -8.089378000  
   2) CON=0 1423 25214.15000 -10.645500000  
     4) CREAT&lt; 1.209516 1215 15077.22000 -11.650850000  
       8) ICU=1 741  7335.49100 -13.440420000  
        16) CREAT&lt; 0.8776082 574  4308.17400 -14.240640000  
          32) BURN=0 287   950.34510 -15.400710000 *
          33) BURN=1 287  2585.36900 -13.080580000 *
        17) CREAT&gt;=0.8776082 167  1396.37900 -10.689950000  
          34) BURN=0 79   353.27190 -12.157220000 *
          35) BURN=1 88   720.34340  -9.372733000 *
       9) ICU=0 474  1658.77700  -8.853227000  
        18) CREAT&lt; 0.7359913 314   440.58620  -9.616361000 *
        19) CREAT&gt;=0.7359913 160   676.45370  -7.355578000  
          38) SEX=0 59   213.14900  -8.431385000 *
          39) SEX=1 101   355.13170  -6.727137000 *
     5) CREAT&gt;=1.209516 208  1735.59100  -4.772933000  
      10) CREAT&lt; 1.859952 134   606.10390  -6.273502000  
        20) CREAT&lt; 1.487287 72   250.51200  -7.370088000  
          40) BURN=0 42    79.34322  -8.173240000 *
          41) BURN=1 30   106.14740  -6.245676000 *
        21) CREAT&gt;=1.487287 62   168.46720  -5.000047000  
          42) BURN=0 32    22.69181  -6.179260000 *
          43) BURN=1 30    53.81415  -3.742221000 *
      11) CREAT&gt;=1.859952 74   281.38510  -2.055687000  
        22) CREAT&lt; 2.391933 33    73.24242  -3.498949000 *
        23) CREAT&gt;=2.391933 41    84.07702  -0.894038000 *
   3) CON=1 450    52.32690  -0.006339534 *</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the plot of the four trees</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">jpeg</span>(<span class="fu">here</span>(<span class="st">"Amoxicillin/Figures/S9.jpg"</span>), <span class="at">width =</span> <span class="dv">7</span>, <span class="at">height =</span> <span class="dv">7</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">res =</span> <span class="dv">300</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>n_trees <span class="ot">&lt;-</span> <span class="fu">length</span>(model_trees)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="fu">ceiling</span>(n_trees <span class="sc">/</span> <span class="dv">2</span>), <span class="dv">2</span>))</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (model_name <span class="cf">in</span> <span class="fu">names</span>(model_trees)) {</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart.plot</span>(model_trees[[model_name]],</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">main =</span> model_name,</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">roundint =</span> <span class="cn">FALSE</span>)</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>test_results_RT <span class="ot">&lt;-</span> <span class="fu">regression_tree_model_ensembling_test</span>(</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">test_data =</span> AMOX_CMIN_TEST, </span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">train_results =</span> train_results_RT) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To evaluate the method, a predictions as a function of observed concentrations goodness of fit plot is presented as well a boxplot indicating the predicted/observed ratios in %. Then, the average model weights are plotted, stratified by covariate categories/quantiles.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>test_data_RT <span class="ot">&lt;-</span> test_results_RT<span class="sc">$</span>test_results</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>test_results_RT<span class="sc">$</span>GOF_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-66"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>test_results_RT<span class="sc">$</span>Boxplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-67"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots showing the average attributed weight stratified by covariates</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>weight_BURN_RT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_RT, <span class="st">"BURN"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>weight_ICU_RT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_RT, <span class="st">"ICU"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>weight_OBESE_RT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_RT, <span class="st">"OBESE"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>weight_CREAT_RT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_RT, <span class="st">"CREAT"</span>, <span class="at">is_categorical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>weight_WT_RT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_RT, <span class="st">"WT"</span>, <span class="at">is_categorical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>weight_AGE_RT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_RT, <span class="st">"AGE"</span>, <span class="at">is_categorical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>weight_SEX_RT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_RT, <span class="st">"SEX"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a>weight_CON_RT <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_RT, <span class="st">"CON"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>weight_BURN_RT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-68"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>weight_ICU_RT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-69"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>weight_OBESE_RT <span class="ot">&lt;-</span> weight_OBESE_RT <span class="sc">+</span> </span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"RT inf ens weight attribution, stratified by OBESE"</span>)</span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"Amoxicillin/Figures/S10b.jpg"</span>),</span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> weight_OBESE_RT,</span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>weight_CREAT_RT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-70"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-5.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>weight_WT_RT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-6.png" class="lightbox" data-gallery="quarto-lightbox-gallery-71"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-6.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>weight_AGE_RT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-7.png" class="lightbox" data-gallery="quarto-lightbox-gallery-72"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-7.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>weight_SEX_RT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-8.png" class="lightbox" data-gallery="quarto-lightbox-gallery-73"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-8.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>weight_CON_RT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-9.png" class="lightbox" data-gallery="quarto-lightbox-gallery-74"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-9.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>test_data_RT <span class="sc">%&gt;%</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(MODEL) <span class="sc">%&gt;%</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_weight =</span> <span class="fu">mean</span>(WEIGHT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 2
  MODEL    avg_weight
  &lt;chr&gt;         &lt;dbl&gt;
1 CARLIER       0.163
2 FOURNIER      0.419
3 MELLON        0.179
4 RAMBAUD       0.239</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrapolate dose based on the ensembled concentrations and compare it to the true simulated dose.</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>test_data_RT <span class="ot">&lt;-</span> test_data_RT <span class="sc">%&gt;%</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(REFERENCE <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DOSE_PRED =</span> (<span class="dv">60</span><span class="sc">/</span>WEIGHTED_PREDICTION) <span class="sc">*</span> DOSE_ADM) <span class="co"># Administered dose extrapolation to reach 60 mg/L</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>final_results_RT <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(test_data_RT)</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>final_results_RT<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-10.png" class="lightbox" data-gallery="quarto-lightbox-gallery-75"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-10.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_RT <span class="ot">&lt;-</span> final_results_RT<span class="sc">$</span>crcl_plot</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_RT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-11.png" class="lightbox" data-gallery="quarto-lightbox-gallery-76"><img src="Precision_dosing_methods_files/figure-html/evaluate-prediction-RT-11.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>final_results_RT<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     1.01     0.575    80.4  17.3     62.4   16.7   216
2 Incorrect                   0.915    0.579    86.7  19.1     58.5   16.0   384
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep data for method ensembling</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>test_data_RT_ens <span class="ot">&lt;-</span> test_data_RT <span class="sc">%&gt;%</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">RT =</span> DOSE_PRED) <span class="sc">%&gt;%</span> </span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"ID"</span>,<span class="st">"RT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="weighed-model-ensembling" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Weighed model ensembling</h1>
<p>This method is used to attribute weights to models based on their performance in different subgroups and on the overall performance of models in different subgroups.</p>
<p>The method is based on <span class="citation" data-cites="Agema2024-cf">Agema et al. (<a href="references.html#ref-Agema2024-cf" role="doc-biblioref">2024</a>)</span>.</p>
<section id="model-influence" class="level3" data-number="10.0.1">
<h3 data-number="10.0.1" class="anchored" data-anchor-id="model-influence"><span class="header-section-number">10.0.1</span> Model influence</h3>
<p>To calculate model influence, first, differences are calculated between <span class="math inline">\(Cmin_{\text{pred}}\)</span> and <span class="math inline">\(Cmin_{\text{ind}}\)</span> for a particular set of covariates. Then we use this difference to calculate pooled MPE and RMSE values for each model. MPE and rRMSE will be used to calculate scores as discussed in a later section.</p>
<p><a href="images/clipboard-1093848730.png" class="lightbox" data-gallery="quarto-lightbox-gallery-77"><img src="images/clipboard-1093848730.png" class="img-fluid"></a></p>
</section>
<section id="subgroup-influence" class="level3" data-number="10.0.2">
<h3 data-number="10.0.2" class="anchored" data-anchor-id="subgroup-influence"><span class="header-section-number">10.0.2</span> Subgroup influence</h3>
<p>The data is divided into subgroups. For categorical covariates (ICU, BURN, OBESE, SEX, CON (indicating continuous infusion)), a subgroup is a category, thus we have two-two-two-two-two subgroups for ICU, BURN, SEX, OBESE, and CON. Continuous covariates (WT, CREAT, AGE) are divided into four quantiles, and each quantile will represent a subgroup.<br>
First, ratios are calculated between<span class="math inline">\(Cmin_{\text{pred}}\)</span> and the <span class="math inline">\(Cmin_{\text{ind}}\)</span> for a particular set of covariates. For each sugbroup we will calculate the proportion of ratios <strong>outside</strong> the bioequivalence range of [0.80-1.25]. This proportion will represent subgroup influence. The logic behind giving more influence to subgroups with more ratios outside the bioequivalence range is that sugbroup having overall good predictions (many ratios inside the bioequivalence range), means that we can use any of the models for that subgroup, thus its influence will be lower in attributing model weights. A model having a good performance in a sugbroup with bad predictions (many ratios outside the bioequivalence range) will be preferred to a model having good performance in a subgroup having overall good predictions.</p>
<p><a href="images/clipboard-2578669345.png" class="lightbox" data-gallery="quarto-lightbox-gallery-78"><img src="images/clipboard-2578669345.png" class="img-fluid"></a></p>
</section>
<section id="score-calculation" class="level3" data-number="10.0.3">
<h3 data-number="10.0.3" class="anchored" data-anchor-id="score-calculation"><span class="header-section-number">10.0.3</span> Score calculation</h3>
<p>Scores are calculated with a negative exponential function: <span class="math display">\[
\text{Score}_{\text{MPE}} = e^{\text{penalty} \cdot |\text{MPE}|}
\]</span> <span class="math display">\[
\text{Score}_{\text{RMSE}} = e^{\text{penalty} \cdot |\text{RMSE}|}
\]</span>Model score is the product of RMSE and MPE scores. <span class="math display">\[
\text{Score}_{\text{Carlier}} = \text{Score}_{\text{RMSE}} \cdot \text{Score}_{\text{MPE}}
\]</span> Model score is normalized by the sum of scores. <span class="math display">\[
\text{Influence}_{\text{Carlier}} = \frac{\text{Score}_{\text{Carlier}}}{\sum \text{Score}}
\]</span> For this negative exponential calculation, the two penalties have to be defined</p>
<p><a href="images/clipboard-106276185.png" class="lightbox" data-gallery="quarto-lightbox-gallery-79"><img src="images/clipboard-106276185.png" class="img-fluid"></a></p>
<p>To test the algorithm we check to which 8 subgroups (ICU, BURN, WT, CREAT, OBESE, SEX, AGE, CON (= continuous or intermittant infusion)) a subject belongs, and we add the obtain the corresponding model and influence scores from the all_scores table. We normalize the four subgroup influences by their sum (so they add up to 1 for that subject). Then, for each subgroup we multiply the model influences with the normalized subgroup influence. As a product of this multiplication we have a model weights for each of the four models for each of the four subgroups. For each model, we add the four weights (for example Carlier weight for ICU = 0, Carlier weight for BURN = 1 etc). As a final step, we normalize the weights of the models by their sum so they add up to 1 for each subject. Then, we ensemble the separate Cmax predictions of the four models based on their weight. The administered dose is extrapolated by dividing the weighted concentration prediction by the target concentration (= 60 mg/L).</p>
<p>The penalties are automatically tuned based on the percentage of correct dose predictions.</p>
<p>Our <em>openMIPD</em> package is used to apply this method.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN_TRAIN <span class="ot">&lt;-</span> AMOX_CMIN_TRAIN <span class="sc">%&gt;%</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dosing_reg_strata =</span> <span class="fu">paste0</span>(DOSE_ADM,FREQ,DUR))</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>wme_tuning <span class="ot">&lt;-</span> <span class="fu">weighed_model_ensembling_tuning</span>(</span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_data =</span> AMOX_CMIN_TRAIN,</span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_variable =</span> <span class="st">"CMIN"</span>,</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">continuous_cov =</span> <span class="fu">c</span>(<span class="st">"WT"</span>, <span class="st">"CREAT"</span>, <span class="st">"AGE"</span>),</span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">categorical_cov =</span> <span class="fu">c</span>(<span class="st">"OBESE"</span>, <span class="st">"ICU"</span>, <span class="st">"BURN"</span>, <span class="st">"SEX"</span>,<span class="st">"CON"</span>),</span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">penalties_grid =</span> <span class="cn">NULL</span>,</span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">conc_inf =</span> <span class="dv">40</span>, <span class="at">conc_sup =</span> <span class="dv">80</span>, <span class="at">conc_target =</span> <span class="dv">60</span>,</span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">freq_column =</span> <span class="st">"FREQ"</span>,</span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cv_stratification_col =</span> <span class="st">"dosing_reg_strata"</span>,</span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">target_log_dose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a>wme_tuning<span class="sc">$</span>best_pen_RMSE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -8</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>wme_tuning<span class="sc">$</span>best_pen_MPE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1</code></pre>
</div>
</div>
<p>To visualize method training, the mean percentage error (MPE) and relative root mean squared error (RMSE) for each model in each covariate quantile/category is plotted as well as subgroup influences (the proportion of incorrect predictions for each covariate quantile/category, all models included).</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>training_results_WME <span class="ot">&lt;-</span> <span class="fu">weighed_model_ensembling_train</span>(</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> AMOX_CMIN_TRAIN, </span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_variable =</span> <span class="st">"CMIN"</span>, </span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pen_RMSE =</span> wme_tuning<span class="sc">$</span>best_pen_RMSE,</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">pen_MPE =</span> wme_tuning<span class="sc">$</span>best_pen_MPE,</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">continuous_cov =</span> <span class="fu">c</span>(<span class="st">"WT"</span>, <span class="st">"CREAT"</span>, <span class="st">"AGE"</span>), </span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">categorical_cov =</span> <span class="fu">c</span>(<span class="st">"OBESE"</span>, <span class="st">"ICU"</span>, <span class="st">"BURN"</span>, <span class="st">"SEX"</span>, <span class="st">"CON"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>all_scores <span class="ot">&lt;-</span> training_results_WME<span class="sc">$</span>all_scores</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 88 Ã— 10
   COVARIATE QUANTILE  SUBGROUP_INFLUENCE MODEL       MPE  RMSE MODEL_INFLUENCE
   &lt;chr&gt;     &lt;chr&gt;                  &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;           &lt;dbl&gt;
 1 AGE       18.3-49.4              0.897 CARLIER  13.0   2.23         4.07e-14
 2 AGE       18.3-49.4              0.897 FOURNIER  7.12  1.27         3.21e- 8
 3 AGE       18.3-49.4              0.897 MELLON    4.75  2.37         4.85e-11
 4 AGE       18.3-49.4              0.897 RAMBAUD   0.954 1.62         9.07e- 7
 5 AGE       49.4-57.3              0.884 CARLIER  13.5   1.39         1.97e-11
 6 AGE       49.4-57.3              0.884 FOURNIER  8.69  1.03         4.55e- 8
 7 AGE       49.4-57.3              0.884 MELLON    5.11  2.44         1.99e-11
 8 AGE       49.4-57.3              0.884 RAMBAUD   0.918 1.05         8.70e- 5
 9 AGE       57.3-69.5              0.836 CARLIER   3.81  1.06         4.66e- 6
10 AGE       57.3-69.5              0.836 FOURNIER  2.31  0.802        1.62e- 4
# â„¹ 78 more rows
# â„¹ 3 more variables: LABEL &lt;chr&gt;, lower &lt;dbl&gt;, upper &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>MPE_plot <span class="ot">&lt;-</span> training_results_WME<span class="sc">$</span>MPE_plot </span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>MPE_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-training-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-80"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-training-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"Amoxicillin/Figures/S13.jpg"</span>),</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> MPE_plot,</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>RMSE_plot <span class="ot">&lt;-</span> training_results_WME<span class="sc">$</span>RMSE_plot</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>RMSE_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-training-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-81"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-training-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"Amoxicillin/Figures/S14.jpg"</span>),</span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> RMSE_plot,</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>SUBGROUP_INFLUENCE_plot <span class="ot">&lt;-</span> training_results_WME<span class="sc">$</span>SUBGROUP_INFLUENCE_plot</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>SUBGROUP_INFLUENCE_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-training-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-82"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-training-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"Amoxicillin/Figures/S15.jpg"</span>),</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> SUBGROUP_INFLUENCE_plot,</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>test_results_WME <span class="ot">&lt;-</span>  <span class="fu">weighed_model_ensembling_test</span>(</span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">train_results =</span> training_results_WME, </span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">test_data =</span> AMOX_CMIN_TEST)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To evaluate the method, a predictions as a function of observed concentrations goodness of fit plot is presented as well a boxplot indicating the predicted/observed ratios in %. Then, the average model weights are plotted, stratified by covariate categories/quantiles.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>test_data_WME <span class="ot">&lt;-</span> test_results_WME<span class="sc">$</span>test_results</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>test_results_WME<span class="sc">$</span>GOF_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-83"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>test_results_WME<span class="sc">$</span>Boxplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-84"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plots showing the average attributed weight stratified by covariates</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>weight_BURN_WME <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_WME, <span class="st">"BURN"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>weight_ICU_WME <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_WME, <span class="st">"ICU"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>weight_OBESE_WME <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_WME, <span class="st">"OBESE"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>weight_CREAT_WME <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_WME, <span class="st">"CREAT"</span>, <span class="at">is_categorical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>weight_WT_WME <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_WME, <span class="st">"WT"</span>, <span class="at">is_categorical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a>weight_AGE_WME <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_WME, <span class="st">"AGE"</span>, <span class="at">is_categorical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>weight_SEX_WME <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_WME, <span class="st">"SEX"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>weight_CON_WME <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_WME, <span class="st">"CON"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>weight_BURN_WME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-85"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>weight_ICU_WME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-86"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>weight_OBESE_WME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-87"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-5.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>weight_CREAT_WME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-6.png" class="lightbox" data-gallery="quarto-lightbox-gallery-88"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-6.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>weight_WT_WME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-7.png" class="lightbox" data-gallery="quarto-lightbox-gallery-89"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-7.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>weight_AGE_WME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-8.png" class="lightbox" data-gallery="quarto-lightbox-gallery-90"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-8.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>weight_SEX_WME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-9.png" class="lightbox" data-gallery="quarto-lightbox-gallery-91"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-9.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>weight_CON_WME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-10.png" class="lightbox" data-gallery="quarto-lightbox-gallery-92"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-10.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>weight_OBESE_WME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-11.png" class="lightbox" data-gallery="quarto-lightbox-gallery-93"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-11.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>test_data_WME <span class="sc">%&gt;%</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(MODEL) <span class="sc">%&gt;%</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_weight =</span> <span class="fu">mean</span>(WEIGHT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 2
  MODEL    avg_weight
  &lt;chr&gt;         &lt;dbl&gt;
1 CARLIER    0.0697  
2 FOURNIER   0.152   
3 MELLON     0.000460
4 RAMBAUD    0.778   </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrapolate dose based on the ensembled concentrations and compare it to the true simulated dose.</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>test_data_WME <span class="ot">&lt;-</span> test_data_WME <span class="sc">%&gt;%</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(REFERENCE <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DOSE_PRED =</span> (<span class="dv">60</span><span class="sc">/</span>WEIGHTED_PREDICTION) <span class="sc">*</span> DOSE_ADM) <span class="co"># Administered dose extrapolation to reach 60 mg/L</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>final_results_WME <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(test_data_WME)</span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>final_results_WME<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-12.png" class="lightbox" data-gallery="quarto-lightbox-gallery-94"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-12.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_WME <span class="ot">&lt;-</span> final_results_WME<span class="sc">$</span>crcl_plot</span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_WME</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-13.png" class="lightbox" data-gallery="quarto-lightbox-gallery-95"><img src="Precision_dosing_methods_files/figure-html/evaluate-WME-prediction-13.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>final_results_WME<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     1.02     0.609    78.4  15.1     65.7   15.7   141
2 Incorrect                   0.927    0.567    86.5  19.1     58.2   16.1   456
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep data for method ensembling</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>test_data_WME_ens <span class="ot">&lt;-</span> test_data_WME <span class="sc">%&gt;%</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">WME =</span> DOSE_PRED) <span class="sc">%&gt;%</span> </span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"ID"</span>,<span class="st">"WME"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="factor-analysis-of-mixed-data-famd" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Factor Analysis of Mixed Data (FAMD)</h1>
<p>In FAMD, Principal Component Analyisis (PCA) is applied to continuous covariates and multiple correspondence analysis (MCA) to categorical covariates. FAMD is an unsupervised machine learning algorithm which is based on dimensionality reduction. Principal components are uncorrelated linear combinations of initial variables. They are directions in the variable space, perpendicular to each other that explain a maximum variance of the data. The first principal component explains most of the variance, as it has most of the dispersion of the data points along it, then the subsequent ones explain less and less and if a certain percentage (in this case, 90 %) of the data variance is explained, no more principal components are added. This process simplifies the dataset while retaining most of the relevant information.</p>
<p>Nearest neighbors is a classification technique that relies on the proximity of a data point to different classes in a variable space. To measure proximity, we can use euclidean distance, which is the length of a straight line connecting to points, or the Mahalanobis distance which accounts for variance and correlation between the variables as well. Mahalanobis distances are calculated between the centroids (geometric means) of model cohorts and a new subject. Model weights were calculated by taking the normalized reciprocal of these distances.</p>
<p>Our <em>openMIPD</em> package is used to apply this method.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>train_result_FAMD <span class="ot">&lt;-</span> <span class="fu">famd_train</span>(</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">train =</span> AMOX_CMIN_TRAIN, </span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">continuous_cov =</span> <span class="fu">c</span>(<span class="st">"WT"</span>, <span class="st">"CREAT"</span>, <span class="st">"AGE"</span>), </span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">categorical_cov =</span> <span class="fu">c</span>(<span class="st">"OBESE"</span>, <span class="st">"ICU"</span>, <span class="st">"BURN"</span>, <span class="st">"SEX"</span>), </span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">target_variable =</span> <span class="st">"CMIN"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To visualize the model, the contribution of covariates to the first (left) and second (right) principal component ar visualized for FAMD. Notably, BURN contributed the least to the first dimension, and the most to the second. The contribution of continuous covariates to the first and second principal components in PCA is also plotted. WT contributes the most to the results, and CREAT the least (out of the continuous covariates). CREAT and age are positively correlated as the angle between them is smaller, while between CREAT and WT there is an important negative correlation.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a>train_result_FAMD<span class="sc">$</span>principal_components</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       eigenvalue percentage of variance cumulative percentage of variance
comp 1  3.2226916              46.038451                          46.03845
comp 2  1.2679382              18.113402                          64.15185
comp 3  0.9498823              13.569747                          77.72160
comp 4  0.6445674               9.208106                          86.92971
comp 5  0.5435385               7.764835                          94.69454</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>contrib_dim1 <span class="ot">&lt;-</span> train_result_FAMD<span class="sc">$</span>contrib_dim1</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>contrib_dim1 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-FAMD-training-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-96"><img src="Precision_dosing_methods_files/figure-html/evaluate-FAMD-training-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"Amoxicillin/Figures/S11a.jpg"</span>),</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> contrib_dim1,</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>contrib_dim2 <span class="ot">&lt;-</span> train_result_FAMD<span class="sc">$</span>contrib_dim2</span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>contrib_dim2 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-FAMD-training-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-97"><img src="Precision_dosing_methods_files/figure-html/evaluate-FAMD-training-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"Amoxicillin/Figures/S11b.jpg"</span>),</span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> contrib_dim2,</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>contrib_quant_var <span class="ot">&lt;-</span> train_result_FAMD<span class="sc">$</span>contrib_quant_var</span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>contrib_quant_var</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-FAMD-training-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-98"><img src="Precision_dosing_methods_files/figure-html/evaluate-FAMD-training-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"Amoxicillin/Figures/S12.jpg"</span>),</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> contrib_quant_var,</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>test_result_FAMD <span class="ot">&lt;-</span> <span class="fu">famd_test</span>(</span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">test =</span> AMOX_CMIN_TEST, </span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">train_results =</span> train_result_FAMD)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To evaluate the method, a predictions as a function of observed concentrations goodness of fit plot is presented as well as the average model weights are plotted, stratified by covariate categories/quantiles.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>test_data_FAMD <span class="ot">&lt;-</span> test_result_FAMD<span class="sc">$</span>test_results</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>test_result_FAMD<span class="sc">$</span>GOF_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-99"><img src="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>weight_BURN_FAMD <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_FAMD, <span class="st">"BURN"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>weight_ICU_FAMD <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_FAMD, <span class="st">"ICU"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>weight_OBESE_FAMD <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_FAMD, <span class="st">"OBESE"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>weight_CREAT_FAMD <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_FAMD, <span class="st">"CREAT"</span>, <span class="at">is_categorical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>weight_WT_FAMD <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_FAMD, <span class="st">"WT"</span>, <span class="at">is_categorical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>weight_AGE_FAMD <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_FAMD, <span class="st">"AGE"</span>, <span class="at">is_categorical =</span> <span class="cn">FALSE</span>)</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>weight_SEX_FAMD <span class="ot">&lt;-</span> <span class="fu">generate_weight_plot</span>(test_data_FAMD, <span class="st">"SEX"</span>, <span class="at">is_categorical =</span> <span class="cn">TRUE</span>)</span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>weight_BURN_FAMD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-100"><img src="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>weight_ICU_FAMD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-101"><img src="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a>weight_OBESE_FAMD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-102"><img src="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>weight_CREAT_FAMD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-103"><img src="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-5.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>weight_AGE_FAMD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-6.png" class="lightbox" data-gallery="quarto-lightbox-gallery-104"><img src="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-6.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>weight_SEX_FAMD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-7.png" class="lightbox" data-gallery="quarto-lightbox-gallery-105"><img src="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-7.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>weight_OBESE_FAMD <span class="ot">&lt;-</span> weight_OBESE_FAMD <span class="sc">+</span> </span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"FAMD weight attribution, stratified by OBESE"</span>)</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="at">filename =</span> <span class="fu">here</span>(<span class="st">"Amoxicillin/Figures/S10a.jpg"</span>),</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> weight_OBESE_FAMD,</span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">600</span>)</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>test_data_FAMD <span class="sc">%&gt;%</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(MODEL) <span class="sc">%&gt;%</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_weight =</span> <span class="fu">mean</span>(WEIGHT, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 2
  MODEL    avg_weight
  &lt;chr&gt;         &lt;dbl&gt;
1 CARLIER       0.248
2 FOURNIER      0.257
3 MELLON        0.189
4 RAMBAUD       0.306</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extrapolate dose based on the ensembled concentrations and compare it to the true simulated dose.</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>test_data_FAMD <span class="ot">&lt;-</span> test_data_FAMD <span class="sc">%&gt;%</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(REFERENCE <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DOSE_PRED =</span> (<span class="dv">60</span><span class="sc">/</span>WEIGHTED_PREDICTION) <span class="sc">*</span> DOSE_ADM) <span class="co"># Administered dose extrapolation to reach 60 mg/L</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>final_results_FAMD <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(test_data_FAMD)</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>final_results_FAMD<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-8.png" class="lightbox" data-gallery="quarto-lightbox-gallery-106"><img src="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-8.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_FAMD <span class="ot">&lt;-</span> final_results_FAMD<span class="sc">$</span>crcl_plot</span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_FAMD</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-9.png" class="lightbox" data-gallery="quarto-lightbox-gallery-107"><img src="Precision_dosing_methods_files/figure-html/evaluate-FAMD-prediction-9.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>final_results_FAMD<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     0.967    0.510    82.1  18.6     62.1   16.5   222
2 Incorrect                   0.941    0.616    85.7  18.7     58.6   16.2   378
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep data for method ensembling</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>test_data_FAMD_ens <span class="ot">&lt;-</span> test_data_FAMD <span class="sc">%&gt;%</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">FAMD =</span> DOSE_PRED) <span class="sc">%&gt;%</span> </span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">"ID"</span>,<span class="st">"FAMD"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="method-ensembling" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Method ensembling</h1>
<p>Ensembling for machine learning (XGBoost, Random forest, k nearest neighobrs, support vector machine) and PopPK ensembling (classification tree informed ensembling, regression tree informed ensembling, weighed model ensembling, FAMD). A dose prediction to reach 60 mg/L is made for each subject and the method with the dose prediction closest to the true dose is selected. A classification tree is trained to predict the most suited dose for each subject.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First prediction for the four single ML algorithms</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For ML, take only one line per patient (the true concentration)</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> AMOX_CMIN_TRAIN <span class="sc">%&gt;%</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(REFERENCE <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">II =</span> FREQ) <span class="sc">%&gt;%</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">INF =</span> <span class="dv">24</span><span class="sc">/</span>FREQ)</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> AMOX_CMIN_TEST <span class="sc">%&gt;%</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(REFERENCE <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">II =</span> FREQ) <span class="sc">%&gt;%</span></span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">INF =</span> <span class="dv">24</span><span class="sc">/</span>FREQ)</span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-13"><a href="#cb196-13" aria-hidden="true" tabindex="-1"></a>test_data_ML <span class="ot">&lt;-</span> <span class="fu">machine_learning</span>(<span class="at">train =</span> train, <span class="at">test =</span> test,  <span class="at">continuous_cov =</span> <span class="fu">c</span>(<span class="st">"WT"</span>, <span class="st">"CREAT"</span>, <span class="st">"AGE"</span>), </span>
<span id="cb196-14"><a href="#cb196-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">categorical_cov =</span> <span class="fu">c</span>(<span class="st">"OBESE"</span>, <span class="st">"ICU"</span>, <span class="st">"BURN"</span>, <span class="st">"SEX"</span>, <span class="st">"INF"</span>), <span class="at">target_variable =</span> <span class="st">"CMIN"</span>, <span class="at">target_concentration =</span> <span class="dv">60</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1991</span>)</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflicts_prefer</span>(dplyr<span class="sc">::</span>filter)</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Put together the predictions of the 8 methods</span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> <span class="fu">list</span>(test_data_ML, test_data_WME_ens, test_data_FAMD_ens, test_data_RT_ens, test_data_CT_ens)</span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the datasets</span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">reduce</span>(datasets, full_join, <span class="at">by =</span> <span class="st">"ID"</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ID)</span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide the data to training and test data (50-50)</span></span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(data)) <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">1</span></span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a>train_data  <span class="ot">&lt;-</span> data[idx, ]</span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> data[<span class="sc">!</span>idx, ]</span>
<span id="cb197-14"><a href="#cb197-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-15"><a href="#cb197-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the name of the best method (whose dose prediction is the closest to the target dose) in a new column called Method</span></span>
<span id="cb197-16"><a href="#cb197-16" aria-hidden="true" tabindex="-1"></a>methods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"RF"</span>, <span class="st">"XGB"</span>, <span class="st">"KNN"</span>, <span class="st">"SVM"</span>, <span class="st">"WME"</span>, <span class="st">"CT"</span>, <span class="st">"RT"</span>, <span class="st">"FAMD"</span>)</span>
<span id="cb197-17"><a href="#cb197-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-18"><a href="#cb197-18" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span></span>
<span id="cb197-19"><a href="#cb197-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb197-20"><a href="#cb197-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb197-21"><a href="#cb197-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Method =</span> methods[<span class="fu">which.min</span>(<span class="fu">abs</span>(<span class="fu">c_across</span>(<span class="fu">all_of</span>(methods)) <span class="sc">-</span> DOSE_TARGET))]</span>
<span id="cb197-22"><a href="#cb197-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb197-23"><a href="#cb197-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb197-24"><a href="#cb197-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-25"><a href="#cb197-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Range for complexity parameter to test (based on cross-validation)</span></span>
<span id="cb197-26"><a href="#cb197-26" aria-hidden="true" tabindex="-1"></a>cp_values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.001</span>, <span class="fl">0.04</span>, <span class="at">by =</span> <span class="fl">0.001</span>) </span>
<span id="cb197-27"><a href="#cb197-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-28"><a href="#cb197-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert categorical variables to factors</span></span>
<span id="cb197-29"><a href="#cb197-29" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> train_data <span class="sc">%&gt;%</span></span>
<span id="cb197-30"><a href="#cb197-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(Method, ICU, BURN, OBESE, SEX), as.factor))</span>
<span id="cb197-31"><a href="#cb197-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-32"><a href="#cb197-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform cross-validation for each complexity value</span></span>
<span id="cb197-33"><a href="#cb197-33" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cp_values, <span class="cf">function</span>(cp) {</span>
<span id="cb197-34"><a href="#cb197-34" aria-hidden="true" tabindex="-1"></a>  ensfit <span class="ot">&lt;-</span> <span class="fu">rpart</span>(</span>
<span id="cb197-35"><a href="#cb197-35" aria-hidden="true" tabindex="-1"></a>    Method <span class="sc">~</span> WT <span class="sc">+</span> CREAT <span class="sc">+</span> ICU <span class="sc">+</span> BURN <span class="sc">+</span> OBESE <span class="sc">+</span> AGE <span class="sc">+</span> SEX,</span>
<span id="cb197-36"><a href="#cb197-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> train_data,</span>
<span id="cb197-37"><a href="#cb197-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">'class'</span>,</span>
<span id="cb197-38"><a href="#cb197-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">parms =</span> <span class="fu">list</span>(<span class="at">split =</span> <span class="st">"information"</span>),</span>
<span id="cb197-39"><a href="#cb197-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">rpart.control</span>(</span>
<span id="cb197-40"><a href="#cb197-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">cp =</span> cp,</span>
<span id="cb197-41"><a href="#cb197-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">xval =</span> <span class="dv">10</span>,</span>
<span id="cb197-42"><a href="#cb197-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">minsplit =</span> <span class="dv">4</span>,</span>
<span id="cb197-43"><a href="#cb197-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">minbucket =</span> <span class="dv">4</span></span>
<span id="cb197-44"><a href="#cb197-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb197-45"><a href="#cb197-45" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb197-46"><a href="#cb197-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min</span>(ensfit<span class="sc">$</span>cptable[, <span class="st">"xerror"</span>]) </span>
<span id="cb197-47"><a href="#cb197-47" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb197-48"><a href="#cb197-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-49"><a href="#cb197-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the minimal cross validation error</span></span>
<span id="cb197-50"><a href="#cb197-50" aria-hidden="true" tabindex="-1"></a>min_error <span class="ot">&lt;-</span> <span class="fu">min</span>(cv_results)</span>
<span id="cb197-51"><a href="#cb197-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-52"><a href="#cb197-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose largest complexity parameter among those achieving the minimum error</span></span>
<span id="cb197-53"><a href="#cb197-53" aria-hidden="true" tabindex="-1"></a>best_cp <span class="ot">&lt;-</span> <span class="fu">max</span>(cp_values[cv_results <span class="sc">==</span> min_error])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Refit the tree</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>ensfit <span class="ot">&lt;-</span> <span class="fu">rpart</span>(</span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>  Method <span class="sc">~</span> WT <span class="sc">+</span> CREAT <span class="sc">+</span> ICU <span class="sc">+</span> BURN <span class="sc">+</span> OBESE <span class="sc">+</span> AGE <span class="sc">+</span> SEX,</span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">'class'</span>,</span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">parms =</span> <span class="fu">list</span>(<span class="at">split =</span> <span class="st">"information"</span>),</span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">rpart.control</span>(</span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cp =</span> best_cp,</span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">xval =</span> <span class="dv">10</span>,</span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">minsplit =</span> <span class="dv">4</span>,</span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">minbucket =</span> <span class="dv">4</span></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(ensfit, <span class="at">file =</span> <span class="st">"ensfit.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The classification tree is plotted indicating the best-suited method for each subject group.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the tree</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>ens_plot <span class="ot">&lt;-</span> <span class="fu">rpart.plot</span>(ensfit, <span class="at">type =</span> <span class="dv">3</span>, <span class="at">extra =</span> <span class="dv">0</span>, <span class="at">cex.main =</span> <span class="fl">1.25</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">box.palette =</span> <span class="st">"Blues"</span>, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"Method ensembling"</span>, <span class="st">"(cp ="</span>, best_cp, <span class="st">")"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-ens-training-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-108"><img src="Precision_dosing_methods_files/figure-html/evaluate-ens-training-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ens_plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$obj
n= 300 

node), split, n, loss, yval, (yprob)
      * denotes terminal node

1) root 300 245 XGB (0.15 0.13 0.14 0.12 0.057 0.1 0.11 0.18) *

$snipped.nodes
NULL

$xlim
[1] 0 1

$ylim
[1] 0 1

$x
[1] 0.5

$y
[1] 0.5

$branch.x
  [,1]
x  0.5
    NA
    NA

$branch.y
  [,1]
y  0.5
    NA
    NA

$labs
[1] "XGB"

$cex
[1] 1

$boxes
$boxes$x1
[1] 0.4599432

$boxes$y1
[1] 0.4830402

$boxes$x2
[1] 0.5400568

$boxes$y2
[1] 0.5508794


$split.labs
[1] ""

$split.cex
[1] 1

$split.box
$split.box$x1
[1] NA

$split.box$y1
[1] NA

$split.box$x2
[1] NA

$split.box$y2
[1] NA</code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">jpeg</span>(<span class="fu">here</span>(<span class="st">"Amoxicillin/Figures/S18.jpg"</span>), <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">units =</span> <span class="st">"in"</span>, <span class="at">res =</span> <span class="dv">400</span>)</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(ensfit, <span class="at">type =</span> <span class="dv">3</span>, <span class="at">extra =</span> <span class="dv">0</span>, <span class="at">cex =</span> <span class="dv">1</span>, <span class="at">cex.main =</span> <span class="fl">1.25</span>, <span class="at">box.palette =</span> <span class="st">"Blues"</span>, <span class="at">main =</span> <span class="st">"Method ensembling"</span>)</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>png 
  2 </code></pre>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get for which patient which method is the best</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>leaves <span class="ot">&lt;-</span> <span class="fu">rownames</span>(ensfit<span class="sc">$</span>frame)[ensfit<span class="sc">$</span>frame<span class="sc">$</span>var <span class="sc">==</span> <span class="st">"&lt;leaf&gt;"</span>]</span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">&lt;-</span> <span class="fu">path.rpart</span>(ensfit, leaves, <span class="at">print.it =</span> <span class="cn">FALSE</span>)</span>
<span id="cb204-4"><a href="#cb204-4" aria-hidden="true" tabindex="-1"></a>leaf_classes <span class="ot">&lt;-</span> ensfit<span class="sc">$</span>frame<span class="sc">$</span>yval[<span class="fu">which</span>(ensfit<span class="sc">$</span>frame<span class="sc">$</span>var <span class="sc">==</span> <span class="st">"&lt;leaf&gt;"</span>)]</span>
<span id="cb204-5"><a href="#cb204-5" aria-hidden="true" tabindex="-1"></a>leaf_labels <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">attr</span>(ensfit, <span class="st">"ylevels"</span>)[leaf_classes])</span>
<span id="cb204-6"><a href="#cb204-6" aria-hidden="true" tabindex="-1"></a>leaf_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb204-7"><a href="#cb204-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Method =</span> leaf_labels,</span>
<span id="cb204-8"><a href="#cb204-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Path =</span> <span class="fu">sapply</span>(paths, <span class="cf">function</span>(path) <span class="fu">paste</span>(path, <span class="at">collapse =</span> <span class="st">" &amp; "</span>))</span>
<span id="cb204-9"><a href="#cb204-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb204-10"><a href="#cb204-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(leaf_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Method Path
1    XGB root</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make predictions for the test data</span></span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> test_data <span class="sc">%&gt;%</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(ICU, BURN, OBESE, SEX), as.factor))</span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>test_data<span class="sc">$</span>Method <span class="ot">&lt;-</span> <span class="fu">predict</span>(ensfit, <span class="at">newdata =</span> test_data, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the dose prediction of the best predicted method</span></span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>test_data_results <span class="ot">&lt;-</span> test_data <span class="sc">%&gt;%</span></span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">DOSE_PRED =</span> <span class="fu">cur_data</span>()[[Method]]) <span class="sc">%&gt;%</span></span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>results_ens <span class="ot">&lt;-</span> <span class="fu">explore_predictions</span>(test_data_results)</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>results_ens<span class="sc">$</span>target_attainment </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-ens-predict-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-109"><img src="Precision_dosing_methods_files/figure-html/evaluate-ens-predict-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>crcl_plot_ens <span class="ot">&lt;-</span> results_ens<span class="sc">$</span>crcl_plot</span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>crcl_plot_ens</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="Precision_dosing_methods_files/figure-html/evaluate-ens-predict-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-110"><img src="Precision_dosing_methods_files/figure-html/evaluate-ens-predict-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>results_ens<span class="sc">$</span>summary_stats </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 9
  Prediction_correctness mean_CREAT sd_CREAT mean_WT sd_WT mean_AGE sd_AGE Count
  &lt;chr&gt;                       &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Correct                     0.985    0.602    82.0  17.4     62.1   17.3   103
2 Incorrect                   0.838    0.396    86.0  19.3     58.8   14.8   197
# â„¹ 1 more variable: Proportion &lt;dbl&gt;</code></pre>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Agema2024-cf" class="csl-entry" role="listitem">
Agema, Bram C, Tolra Kocher, AyÅŸenur B Ã–ztÃ¼rk, Eline L Giraud, Nielka P van Erp, Brenda C M de Winter, Ron H J Mathijssen, Stijn L W Koolen, Birgit C P Koch, and Sebastiaan D T Sassen. 2024. <span>â€œSelecting the Best Pharmacokinetic Models for a Priori Model-Informed Precision Dosing with Model Ensembling.â€</span> <em>Clin. Pharmacokinet.</em> 63 (10): 1449â€“61.
</div>
<div id="ref-rambaud2020" class="csl-entry" role="listitem">
Rambaud, Antoine, Benjamin Jean Gaborit, Colin Deschanvres, Paul Le Turnier, RaphaÃ«l Lecomte, Nathalie Asseray-Madani, Anne-GaÃ«lle Leroy, et al. 2020. <span>â€œDevelopment and Validation of a Dosing Nomogram for Amoxicillin in Infective Endocarditis.â€</span> <em>The Journal of Antimicrobial Chemotherapy</em> 75 (10): 2941â€“50. <a href="https://doi.org/10.1093/jac/dkaa232">https://doi.org/10.1093/jac/dkaa232</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Objectives.html" class="pagination-link" aria-label="Objectives">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Objectives</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Machine_Learning.html" class="pagination-link" aria-label="Machine learning dose prediction">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Machine learning dose prediction</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>