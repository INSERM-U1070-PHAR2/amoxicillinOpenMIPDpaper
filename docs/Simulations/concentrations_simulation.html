<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>6&nbsp; Simulation of concentrations and secondary PK parameters – STP-BRIOCHE : A priori MIPD - Amoxicillin</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../Simulations/references.html" rel="next">
<link href="../Simulations/covariate_simulation.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-364982630eef5352dd1537128a8ed5cb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Simulations/covariate_simulation.html">Simulations</a></li><li class="breadcrumb-item"><a href="../Simulations/concentrations_simulation.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Simulation of concentrations and secondary PK parameters</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">STP-BRIOCHE : A priori MIPD - Amoxicillin</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Validation of implementation from articles</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Model_implementation_validation/quarto/valid_amox_carlier_2013.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Validation PKpop Amox Carlier 2013</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Model_implementation_validation/quarto/valid_amox_fournier_2018.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Validation PKpop Amox Fournier 2018</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Model_implementation_validation/quarto/valid_rambaud_2020.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Validation of mrgsolve implementation of Rambaud amoxicillin PopPK model developed on a population of endocarditis patients</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Model_implementation_validation/quarto/valid_amox_mellon_hammas_2020.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Validation PKpop Amox Mellon 2020</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Simulations</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Simulations/covariate_simulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Covariate simulation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Simulations/concentrations_simulation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Simulation of concentrations and secondary PK parameters</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Simulations/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">MIPD</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../MIPD/Objectives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Objectives</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../MIPD/Precision_dosing_methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Precision dosing approaches</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../MIPD/Machine_Learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Machine learning dose prediction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../MIPD/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Sensitivity analysis</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Sensitivity_analysis/Sensitivity_analysis_explication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Sensitivity analysis</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#concentrations-pred-ipred-y" id="toc-concentrations-pred-ipred-y" class="nav-link active" data-scroll-target="#concentrations-pred-ipred-y"><span class="header-section-number">6.1</span> Concentrations (PRED, IPRED, Y)</a></li>
  <li><a href="#trough-concentration-cmin" id="toc-trough-concentration-cmin" class="nav-link" data-scroll-target="#trough-concentration-cmin"><span class="header-section-number">6.2</span> Trough concentration (Cmin)</a></li>
  <li><a href="#data-visualization-stratified-by-dosing-schemes" id="toc-data-visualization-stratified-by-dosing-schemes" class="nav-link" data-scroll-target="#data-visualization-stratified-by-dosing-schemes"><span class="header-section-number">6.3</span> Data visualization stratified by dosing schemes</a></li>
  <li><a href="#appendix-what-if-you-were-interested-in-something-else-than-cmin" id="toc-appendix-what-if-you-were-interested-in-something-else-than-cmin" class="nav-link" data-scroll-target="#appendix-what-if-you-were-interested-in-something-else-than-cmin"><span class="header-section-number">6.4</span> Appendix : What if you were interested in something else than Cmin ?</a>
  <ul class="collapse">
  <li><a href="#exposure-auc" id="toc-exposure-auc" class="nav-link" data-scroll-target="#exposure-auc"><span class="header-section-number">6.4.1</span> Exposure (AUC)</a></li>
  <li><a href="#maximal-concentration-cmax" id="toc-maximal-concentration-cmax" class="nav-link" data-scroll-target="#maximal-concentration-cmax"><span class="header-section-number">6.4.2</span> Maximal concentration (Cmax)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Simulations/covariate_simulation.html">Simulations</a></li><li class="breadcrumb-item"><a href="../Simulations/concentrations_simulation.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Simulation of concentrations and secondary PK parameters</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Simulation of concentrations and secondary PK parameters</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mrgsolve)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapbayr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MESS)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># To put different plots on the same grid</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tableone)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflicts_prefer</span>(dplyr<span class="sc">::</span>filter)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflicts_prefer</span>(dplyr<span class="sc">::</span>select)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The objective is to simulate concentrations and secondary PK parameters (Cmax, Cmin &amp; AUC) using 4 validated PopPK models for amoxicillin. The 4 papers are:</p>
<ul>
<li><p><span class="citation" data-cites="Carlier2013-bq">Carlier et al. (<a href="references.html#ref-Carlier2013-bq" role="doc-biblioref">2013</a>)</span></p></li>
<li><p><span class="citation" data-cites="fournier2018">Fournier et al. (<a href="references.html#ref-fournier2018" role="doc-biblioref">2018</a>)</span></p></li>
<li><p><span class="citation" data-cites="mellon2020">Mellon et al. (<a href="references.html#ref-mellon2020" role="doc-biblioref">2020</a>)</span></p></li>
<li><p><span class="citation" data-cites="rambaud2020">Rambaud et al. (<a href="references.html#ref-rambaud2020" role="doc-biblioref">2020</a>)</span></p></li>
</ul>
<p>The original Rambaud model was non-parametric which was approximated using a parametric model (details in “Rambaud_validation.html”).</p>
<p>The only route of administration is intraveinous infusion.</p>
<p>Three types of infusion are simulated:</p>
<ul>
<li><p>intermittent (duration = 0.5 h),</p></li>
<li><p>extended (1-2 hours),</p></li>
<li><p>continuous .</p></li>
</ul>
<p>There are 8 different dosing schemes. For each model cohort the dosing scheme that was in the original article is used for simulation. For patients with renal failure (IR = CRCL &lt; 30 mL/min), a different dosing scheme is applied if it is explicited in the articles (<em>i. e.</em> Carlier, Fournier). For Mellon, there was a single administration in the original model. To have a dosing scheme compatible with the clinical context in which we want to apply our methods, administration frequency is set to every 6 h for intermittent administrations. ID means a set of covariates, not a subject (to make data manipulation easier later).</p>
<p>144 observations are simulated for each subject to have a sufficient number of observations after the first dose, as well as during a steady-state interdose interval. Observations are simulated for the period between the first and second doses and for the same duration for the first interdose interval that is entirely at steady-state. The number of observations has been determined to have at least three observations during the first interdose interval for all dosing schemes. For example, in the case of an intermittent infusion of 0.5 g q6h, there is an observation in each 5 minutes between 0 and 6 h &amp; between 24 h and 30 h (if steady-state is reached at 22 h). This means, that not only the dosing grid changes for each dosing scheme, but the observation grid as well.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>here<span class="sc">::</span><span class="fu">i_am</span>(<span class="st">"Simulations/concentrations_simulation.qmd"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Import or generate the file with the covariates (COV)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>COV <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"Data/COV.csv"</span>), <span class="at">quote =</span> <span class="st">""</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1991</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>First, the dataset needs to be created with all the information that mrgsolve needs for the simulation. In the function create_dosing_data, the input data is created for all the lines that contain an administered dose.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create dosing grid (lines where there is an administered dose)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>create_dosing_data <span class="ot">&lt;-</span> <span class="cf">function</span>(id_range, amt, ii, rate, cmt, time_seq) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  COV1 <span class="ot">&lt;-</span> COV <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(ID <span class="sc">%in%</span> id_range)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  ID <span class="ot">&lt;-</span> id_range            <span class="co"># ID range for the regimen</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create base dosing data</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  dosing_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ID =</span> ID,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">amt =</span> <span class="fu">rep</span>(amt, <span class="fu">length</span>(ID)),   <span class="co"># Dose amount in mg</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ii =</span> <span class="fu">rep</span>(ii, <span class="fu">length</span>(ID)),     <span class="co"># Interdose interval in h</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate =</span> <span class="fu">rep</span>(rate, <span class="fu">length</span>(ID)), <span class="co"># Infusion rate</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">evid =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(ID)),    <span class="co"># EVID</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">cmt =</span> cmt                     <span class="co"># Compartment</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add covariates from COV.csv</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  dosing_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dosing_data, COV1[, <span class="fu">setdiff</span>(<span class="fu">names</span>(COV1), <span class="st">"ID"</span>)])</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Repeat dosing data for all time points</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  dosing_repeated <span class="ot">&lt;-</span> dosing_data[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dosing_data), <span class="at">each =</span> <span class="fu">length</span>(time_seq)), ]</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> <span class="fu">rep</span>(time_seq, <span class="at">times =</span> <span class="fu">length</span>(ID))</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine with time</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  final_dosing_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(dosing_repeated, time)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(final_dosing_data)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, the information is created for all the lines, that do not contain a dose, but an observation. The latest possible time is 120 h, as amoxicillin has a short half life and all subjects have had a complete steady-state dosing interval by then.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to create observation grid (lines with concentration measurement)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>create_observation_data <span class="ot">&lt;-</span> <span class="cf">function</span>(id_range, obs_length) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  COV1 <span class="ot">&lt;-</span> COV <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(ID <span class="sc">%in%</span> id_range)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a> <span class="co"># Extract covariates for the specified range</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  ID <span class="ot">&lt;-</span> id_range            <span class="co"># ID range for the regimen</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create base observation data (as these are lines with concentrations, AMT, II, RATE and EVID are always 0)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  obs_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ID =</span> ID,                     <span class="co"># ID meaning a set of covariates</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">amt =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(ID)),    <span class="co"># Dose amount in mg</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ii =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(ID)),     <span class="co"># Interdose interval in h</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">rate =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(ID)),   <span class="co"># Infusion rate</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">evid =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(ID)),   <span class="co"># EVID</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">cmt =</span> <span class="st">"CENTRAL"</span>              <span class="co"># Central compartment</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add covariates</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  obs_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(obs_data, COV1[, <span class="fu">setdiff</span>(<span class="fu">names</span>(COV1), <span class="st">"ID"</span>)])</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Repeat observation data for all observation times</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  obs_repeated <span class="ot">&lt;-</span> obs_data[<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(obs_data), <span class="at">each =</span> obs_length), ]</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  time <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">120</span>, <span class="at">length.out =</span> obs_length), <span class="at">times =</span> <span class="fu">length</span>(ID))   <span class="co"># Latest possible time is 120 h as amoxicillin has a short half life</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine with time</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  final_obs_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(obs_repeated, time)</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(final_obs_data)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To remove outliers, the non-physiological PK parameter values are resimulated (at most 100 times per value) using the <em>simeta</em> function of mrgsolve. A central volume of distribution smaller than 3 L (the volume of plasma) and a clearance higher than 180 L/h (normal blood flow) is considered non-physiological. (However, the maximum simulated clearance is around 100 L/h, so its resimulation is unnecessary.)<br>
</p>
<p>Simulations are done using the mrgsolve models in .cpp format. To find the interdose interval which is entirely in steady-state, first, the time to reach steady state (TSS) has to be calculated. <span class="math display">\[
K_{10} = \frac{CL}{V_c}
\]</span></p>
<p><span class="math display">\[
K_{12} = \frac{Q}{V_c}
\]</span></p>
<p><span class="math display">\[
K_{21} = \frac{Q}{V_p}
\]</span></p>
<p><span class="math display">\[
L_2 = \frac{ \left( K_{10} + K_{12} + K_{21} \right) -
\sqrt{ \left( K_{10} + K_{12} + K_{21} \right)^2 - 4 K_{10} K_{21} } }{2}
\]</span> <span class="math display">\[
t_{1/2} = \frac{ln(2)}{L_2}
\]</span> We can consider that steady state is reached when the concentration is 90 % of the steady state concentration, which corresponds to a time of 3.3 times the half life ( as <span class="math inline">\(1 - e^{(-k_e \cdot t)} = 0.9\)</span> ).</p>
<p>First, concentrations are simulated for all data points between 0 and 120 h, then the results are filtered to choose the first interdose interval and the first interdose interval entirely in steady-state.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to simulate based on mrgsolve models</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>simulate_mrgsim <span class="ot">&lt;-</span> <span class="cf">function</span>(sim_final, model, interval) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  sim_results <span class="ot">&lt;-</span> <span class="fu">mrgsim</span>(model, sim_final) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sim_results)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Then, the filtered dataset, and the covariates will be put together, and the observation and dosing grids will be simulated based on the functions defined earlier. The dosing scheme is added as three columns (DOSE, FREQuency, DURation). Each model control stream is used two times for each simulation. Once, to simulate IPRED and Y (and <span class="math inline">\(Cmax_{\text{ind}}\)</span>, <span class="math inline">\(Cmin_{\text{ind}}\)</span> and <span class="math inline">\(AUC_{\text{ind}}\)</span> which are based on IPRED), then a second time, the omega matrix is set to 0 to simulate PRED (and CMAX_PRED and AUC_PRED based on PRED). PRED are typical concentrations which do not contain inter-individual variability. IPRED has inter-individual variability incorporated, and Y has both inter-and intra-individual variability.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to merge covariates and finalize</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>finalize_results <span class="ot">&lt;-</span> <span class="cf">function</span>(sim_results, id_range, model, dose, freq, dur) {</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  COV1 <span class="ot">&lt;-</span> COV <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(ID <span class="sc">%in%</span> id_range)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge with simulation results</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">merge</span>(sim_results, COV1, <span class="at">by =</span> <span class="st">"ID"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> result <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">MODEL =</span> model, <span class="at">DOSE_ADM =</span> dose, <span class="at">FREQ =</span> freq, <span class="at">DUR =</span> dur) <span class="sc">%&gt;%</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">distinct</span>(ID, <span class="at">TIME =</span> time, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>generate_model_regimen <span class="ot">&lt;-</span> <span class="cf">function</span>(model_name, cpp_file, regimens, sim_dur,cohort_name) {</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">mread</span>(<span class="at">model =</span> cpp_file)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  model_zero <span class="ot">&lt;-</span> <span class="fu">zero_re</span>(model)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  COV <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">here</span>(<span class="st">"Data/COV.csv"</span>), <span class="at">quote =</span> <span class="st">""</span>)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  regimen_assignments <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    cohort_cov <span class="ot">&lt;-</span> COV <span class="sc">%&gt;%</span> <span class="fu">filter</span>(MODEL_COHORT <span class="sc">==</span> cohort_name)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    cohort_regimens <span class="ot">&lt;-</span> regimens[<span class="fu">sapply</span>(regimens, <span class="cf">function</span>(x) x<span class="sc">$</span>model_cohort <span class="sc">==</span> cohort_name)]</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (ir_value <span class="cf">in</span> <span class="fu">unique</span>(cohort_cov<span class="sc">$</span>IR)) {</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>      eligible_ids <span class="ot">&lt;-</span> cohort_cov <span class="sc">%&gt;%</span> <span class="fu">filter</span>(IR <span class="sc">==</span> ir_value) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(ID)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      matched_regimens <span class="ot">&lt;-</span> cohort_regimens[<span class="fu">seq_along</span>(cohort_regimens) <span class="sc">%%</span> <span class="fu">length</span>(<span class="fu">unique</span>(cohort_cov<span class="sc">$</span>IR)) <span class="sc">==</span> ir_value]</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Distribute eligible subjects evenly across relevant dosing regimens</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>      id_splits <span class="ot">&lt;-</span> <span class="fu">split</span>(eligible_ids, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(matched_regimens), <span class="at">length.out =</span> <span class="fu">length</span>(eligible_ids)))</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(matched_regimens)) {</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>        matched_regimens[[i]]<span class="sc">$</span>assigned_ids <span class="ot">&lt;-</span> id_splits[[i]]</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>        regimen_assignments <span class="ot">&lt;-</span> <span class="fu">append</span>(regimen_assignments, <span class="fu">list</span>(matched_regimens[[i]]))</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate for the assigned regimens</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  regimen_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (regimen <span class="cf">in</span> regimen_assignments) {</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(regimen<span class="sc">$</span>assigned_ids) <span class="sc">==</span> <span class="dv">0</span>) <span class="cf">next</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    dose <span class="ot">&lt;-</span> regimen<span class="sc">$</span>dose</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    interval <span class="ot">&lt;-</span> regimen<span class="sc">$</span>interval</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    duration <span class="ot">&lt;-</span> regimen<span class="sc">$</span>duration</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    id_range <span class="ot">&lt;-</span> regimen<span class="sc">$</span>assigned_ids</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    dosing_times <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, sim_dur <span class="sc">-</span> interval, <span class="at">by =</span> interval)</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    obs_length <span class="ot">&lt;-</span> (sim_dur <span class="sc">/</span> interval) <span class="sc">*</span> sim_dur <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    dose_data <span class="ot">&lt;-</span> <span class="fu">create_dosing_data</span>(</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">id_range =</span> id_range,</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">amt =</span> dose,</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">ii =</span> interval,</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">rate =</span> dose <span class="sc">/</span> duration,</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">cmt =</span> <span class="st">"CENTRAL"</span>,</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>      <span class="at">time_seq =</span> dosing_times</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    obs_data <span class="ot">&lt;-</span> <span class="fu">create_observation_data</span>(<span class="at">id_range =</span> id_range, <span class="at">obs_length =</span> obs_length)</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    sim_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dose_data, obs_data) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ID, time, <span class="fu">desc</span>(evid))</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>processed_data <span class="ot">&lt;-</span> <span class="fu">simulate_mrgsim</span>(sim_data, model, interval)</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>finalized_data <span class="ot">&lt;-</span> <span class="fu">finalize_results</span>(</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>      <span class="at">sim_results =</span> processed_data,</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>      <span class="at">id_range =</span> id_range,</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>      <span class="at">model =</span> model_name,</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>      <span class="at">dose =</span> dose,</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">freq =</span> interval,</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">dur =</span> duration</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>    merged_data <span class="ot">&lt;-</span> finalized_data</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>    regimen_results <span class="ot">&lt;-</span> <span class="fu">append</span>(regimen_results, <span class="fu">list</span>(merged_data))</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  combined_results <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, regimen_results)</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(combined_results)</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>8 different dosing schemes are used depending on the model cohort.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define regimen parameters for all models. For each regimen, we take a different batch of 100 sets of covariates (defined by starting ID)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>regimens <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">model_cohort =</span> <span class="st">"CARLIER"</span>, <span class="at">ir_group =</span> <span class="dv">0</span>, <span class="at">dose =</span> <span class="dv">1000</span>, <span class="at">interval =</span> <span class="dv">6</span>, <span class="at">duration =</span> <span class="fl">0.5</span>),</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">model_cohort =</span> <span class="st">"CARLIER"</span>, <span class="at">ir_group =</span> <span class="dv">1</span>, <span class="at">dose =</span> <span class="dv">1000</span>, <span class="at">interval =</span> <span class="dv">8</span>, <span class="at">duration =</span> <span class="fl">0.5</span>),</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">model_cohort =</span> <span class="st">"FOURNIER"</span>, <span class="at">ir_group =</span> <span class="dv">0</span>, <span class="at">dose =</span> <span class="dv">1000</span>, <span class="at">interval =</span> <span class="dv">6</span>, <span class="at">duration =</span> <span class="dv">2</span>),</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">model_cohort =</span> <span class="st">"FOURNIER"</span>, <span class="at">ir_group =</span> <span class="dv">0</span>, <span class="at">dose =</span> <span class="dv">1500</span>, <span class="at">interval =</span> <span class="dv">6</span>, <span class="at">duration =</span> <span class="dv">1</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">model_cohort =</span> <span class="st">"FOURNIER"</span>, <span class="at">ir_group =</span> <span class="dv">0</span>, <span class="at">dose =</span> <span class="dv">2000</span>, <span class="at">interval =</span> <span class="dv">6</span>, <span class="at">duration =</span> <span class="dv">2</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">model_cohort =</span> <span class="st">"FOURNIER"</span>, <span class="at">ir_group =</span> <span class="dv">0</span>, <span class="at">dose =</span> <span class="dv">2000</span>, <span class="at">interval =</span> <span class="dv">8</span>, <span class="at">duration =</span> <span class="dv">1</span>),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">model_cohort =</span> <span class="st">"FOURNIER"</span>, <span class="at">ir_group =</span> <span class="dv">1</span>, <span class="at">dose =</span> <span class="dv">500</span>, <span class="at">interval =</span> <span class="dv">8</span>, <span class="at">duration =</span> <span class="dv">2</span>),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">model_cohort =</span> <span class="st">"MELLON"</span>, <span class="at">ir_group =</span> <span class="dv">0</span>, <span class="at">dose =</span> <span class="dv">1000</span>, <span class="at">interval =</span> <span class="dv">6</span>, <span class="at">duration =</span> <span class="fl">0.5</span>),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">model_cohort =</span> <span class="st">"RAMBAUD"</span>, <span class="at">ir_group =</span> <span class="dv">0</span>, <span class="at">dose =</span> <span class="dv">12000</span>, <span class="at">interval =</span> <span class="dv">24</span>, <span class="at">duration =</span> <span class="dv">24</span>),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">model_cohort =</span> <span class="st">"RAMBAUD"</span>, <span class="at">ir_group =</span> <span class="dv">0</span>, <span class="at">dose =</span> <span class="dv">14000</span>, <span class="at">interval =</span> <span class="dv">24</span>, <span class="at">duration =</span> <span class="dv">24</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Total simulation time</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>sim_dur <span class="ot">&lt;-</span> <span class="dv">120</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Finally, the simulations are done with each respective model, the results are merged and a MODEL column is added to identify the model used for the simulation of each concentration.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>results_Carlier <span class="ot">&lt;-</span> <span class="fu">generate_model_regimen</span>(<span class="st">"amox_Carlier"</span>, <span class="fu">here</span>(<span class="st">"Simulations/amox_Carlier"</span>), regimens, sim_dur,<span class="at">cohort_name =</span> <span class="st">"CARLIER"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>results_Fournier <span class="ot">&lt;-</span> <span class="fu">generate_model_regimen</span>(<span class="st">"amox_Fournier"</span>, <span class="fu">here</span>(<span class="st">"Simulations/amox_Fournier"</span>), regimens, sim_dur,<span class="at">cohort_name =</span> <span class="st">"FOURNIER"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>results_Mellon <span class="ot">&lt;-</span> <span class="fu">generate_model_regimen</span>(<span class="st">"amox_Mellon"</span>, <span class="fu">here</span>(<span class="st">"Simulations/amox_Mellon"</span>), regimens, sim_dur,<span class="at">cohort_name =</span> <span class="st">"MELLON"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>results_Rambaud <span class="ot">&lt;-</span> <span class="fu">generate_model_regimen</span>(<span class="st">"amox_Rambaud"</span>, <span class="fu">here</span>(<span class="st">"Simulations/amox_Rambaud"</span>), regimens, sim_dur, <span class="at">cohort_name =</span> <span class="st">"RAMBAUD"</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine results from the simulation</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>all_results_raw <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  results_Carlier,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  results_Fournier,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  results_Mellon,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  results_Rambaud</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add MODEL column indicating the model which is used for the simulation</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>all_results_raw <span class="ot">&lt;-</span> all_results_raw <span class="sc">%&gt;%</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">MODEL =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    MODEL <span class="sc">==</span> <span class="st">"amox_Carlier"</span> <span class="sc">~</span> <span class="st">"CARLIER"</span>,</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    MODEL <span class="sc">==</span> <span class="st">"amox_Fournier"</span> <span class="sc">~</span> <span class="st">"FOURNIER"</span>,</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>     MODEL <span class="sc">==</span> <span class="st">"amox_Mellon"</span> <span class="sc">~</span> <span class="st">"MELLON"</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    MODEL <span class="sc">==</span> <span class="st">"amox_Rambaud"</span> <span class="sc">~</span> <span class="st">"RAMBAUD"</span>)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter based on steady-state based on the reference (true) clearance and volume</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>ref_values <span class="ot">&lt;-</span> all_results_raw <span class="sc">%&gt;%</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(MODEL <span class="sc">==</span> MODEL_COHORT) <span class="sc">%&gt;%</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Vc, CL, Q, Vp)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>all_results <span class="ot">&lt;-</span> all_results_raw <span class="sc">%&gt;%</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ref_values, <span class="at">by =</span> <span class="st">"ID"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"_ref"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">K10 =</span> CL_ref<span class="sc">/</span>Vc_ref,</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">K12 =</span> Q_ref<span class="sc">/</span>Vc_ref,</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">K21 =</span> Q_ref<span class="sc">/</span>Vp_ref,</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">L2 =</span> ((K10<span class="sc">+</span>K12<span class="sc">+</span>K21)<span class="sc">-</span>((K10<span class="sc">+</span>K12<span class="sc">+</span>K21)<span class="sc">**</span><span class="dv">2-4</span><span class="sc">*</span>K10<span class="sc">*</span>K21)<span class="sc">**</span><span class="fl">0.5</span>)<span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">TSS =</span> <span class="fu">ceiling</span>((<span class="fl">3.3</span> <span class="sc">*</span> (<span class="fl">0.693</span> <span class="sc">/</span> L2)) <span class="sc">/</span> FREQ) <span class="sc">*</span> FREQ) <span class="sc">%&gt;%</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>((TIME <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> TIME <span class="sc">&lt;=</span> (<span class="dv">0</span> <span class="sc">+</span> FREQ)) <span class="sc">|</span> (TIME <span class="sc">&gt;=</span> TSS <span class="sc">&amp;</span> TIME <span class="sc">&lt;=</span> (TSS <span class="sc">+</span> FREQ)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="concentrations-pred-ipred-y" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="concentrations-pred-ipred-y"><span class="header-section-number">6.1</span> Concentrations (PRED, IPRED, Y)</h2>
<p>Below quantification limit observations are removed (M1 method). LLOQ concentrations for each model can be found in “mrgsolve/LLOQ.txt”.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>AMOX_SIM <span class="ot">&lt;-</span> all_results <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, TIME, IPRED, Y, WT, CREAT, BURN, ICU, OBESE, AGE, SEX, HT, BSA, MODEL, MODEL_COHORT, DOSE_ADM, FREQ, DUR, Vc, CL, TSS) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset to plot CL</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>summarized_SIM <span class="ot">&lt;-</span> AMOX_SIM <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(ID, MODEL, CL, Vc)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot for CL</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>plot_CL <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(summarized_SIM, <span class="fu">aes</span>(<span class="at">x =</span> MODEL, <span class="at">y =</span> CL, <span class="at">fill =</span> MODEL)) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Clearance distribution"</span>, <span class="at">x =</span> <span class="st">"Model"</span>, <span class="at">y =</span> <span class="st">"CL (L/h)"</span>) <span class="sc">+</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),    </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">24</span>),</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>plot_CL</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/concentrations-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="concentrations_simulation_files/figure-html/concentrations-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot for Vc</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>plot_V <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(summarized_SIM, <span class="fu">aes</span>(<span class="at">x =</span> MODEL, <span class="at">y =</span> Vc, <span class="at">fill =</span> MODEL)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Central volume distribution"</span>, <span class="at">x =</span> <span class="st">"Model"</span>, <span class="at">y =</span> <span class="st">"Vc (L)"</span>) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),    </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">24</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>plot_V</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/concentrations-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="concentrations_simulation_files/figure-html/concentrations-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="trough-concentration-cmin" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="trough-concentration-cmin"><span class="header-section-number">6.2</span> Trough concentration (Cmin)</h2>
<p>The trough concentration is the last concentration for the steady-state interdose interval</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add CMIN column by taking the last steady-state concentration</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>AMOX_CMIN1 <span class="ot">&lt;-</span> AMOX_SIM <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, MODEL) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(TIME) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CMIN_IND =</span> <span class="fu">last</span>(IPRED[TIME <span class="sc">==</span> <span class="fu">max</span>(TIME)])) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(TIME, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(ID, MODEL, CMIN_IND, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CON =</span> <span class="fu">ifelse</span>(DUR <span class="sc">==</span> <span class="dv">24</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot for CL before removing the outliers</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>plot_CMIN <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(AMOX_CMIN1, <span class="fu">aes</span>(<span class="at">x =</span> MODEL, <span class="at">y =</span> CMIN_IND, <span class="at">fill =</span> MODEL)) <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cmin distribution"</span>, <span class="at">x =</span> <span class="st">"Model"</span>, <span class="at">y =</span> <span class="st">"Cmin (mg/L)"</span>) <span class="sc">+</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),    </span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">24</span>),</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>plot_CMIN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/CMIN-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="concentrations_simulation_files/figure-html/CMIN-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create test data by taking 2400 subjects (24 from each dosing scheme and 6-6 for each model covariate cohorte per dosing scheme)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>CMIN_test <span class="ot">&lt;-</span> AMOX_CMIN1 <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">6</span> <span class="sc">|</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">26</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">31</span> <span class="sc">|</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">51</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">56</span> <span class="sc">|</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">76</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">81</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create training data by taking 7600 subjects (76 from each dosing scheme and 19-19 for each model covariate cohorte per dosing scheme)</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>CMIN_train <span class="ot">&lt;-</span> AMOX_CMIN1 <span class="sc">%&gt;%</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">7</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">25</span> <span class="sc">|</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">32</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">50</span> <span class="sc">|</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">57</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">75</span> <span class="sc">|</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">82</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">100</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset identifyer</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>CMIN_train_compare <span class="ot">&lt;-</span> CMIN_train <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Dataset =</span> <span class="st">"Train"</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>CMIN_test_compare <span class="ot">&lt;-</span> CMIN_test <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Dataset =</span> <span class="st">"Test"</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the three datasets</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>combined_CMIN <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(CMIN_train_compare, CMIN_test_compare)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the train and test sets</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CREAT"</span>, <span class="st">"WT"</span>, <span class="st">"CMIN_IND"</span>, <span class="st">"CL"</span>, <span class="st">"Vc"</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>tableOne5 <span class="ot">&lt;-</span> <span class="fu">CreateTableOne</span>(<span class="at">vars =</span> vars, <span class="at">strata =</span> <span class="st">"Dataset"</span>, <span class="at">data =</span> combined_CMIN)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>tableOne6 <span class="ot">&lt;-</span> <span class="fu">print</span>(tableOne5, <span class="at">nonnormal =</span> <span class="fu">c</span>(<span class="st">"CREAT"</span>, <span class="st">"WT"</span>, <span class="st">"CMIN_IND"</span>, <span class="st">"CL"</span>, <span class="st">"Vc"</span>), <span class="at">printToggle=</span>F, <span class="at">minMax=</span>T)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="fu">kableone</span>(tableOne6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 30%">
<col style="width: 26%">
<col style="width: 26%">
<col style="width: 7%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Test</th>
<th style="text-align: left;">Train</th>
<th style="text-align: left;">p</th>
<th style="text-align: left;">test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">n</td>
<td style="text-align: left;">600</td>
<td style="text-align: left;">1875</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">CREAT (median [range])</td>
<td style="text-align: left;">0.76 [0.24, 5.32]</td>
<td style="text-align: left;">0.77 [0.13, 8.23]</td>
<td style="text-align: left;">0.410</td>
<td style="text-align: left;">nonnorm</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT (median [range])</td>
<td style="text-align: left;">80.03 [41.33, 139.60]</td>
<td style="text-align: left;">79.99 [47.36, 141.17]</td>
<td style="text-align: left;">0.884</td>
<td style="text-align: left;">nonnorm</td>
</tr>
<tr class="even">
<td style="text-align: left;">CMIN_IND (median [range])</td>
<td style="text-align: left;">3.03 [0.00, 201.92]</td>
<td style="text-align: left;">2.96 [0.00, 443.50]</td>
<td style="text-align: left;">0.539</td>
<td style="text-align: left;">nonnorm</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CL (median [range])</td>
<td style="text-align: left;">13.08 [0.68, 61.52]</td>
<td style="text-align: left;">12.70 [1.08, 71.87]</td>
<td style="text-align: left;">0.467</td>
<td style="text-align: left;">nonnorm</td>
</tr>
<tr class="even">
<td style="text-align: left;">Vc (median [range])</td>
<td style="text-align: left;">9.60 [2.17, 38.10]</td>
<td style="text-align: left;">9.42 [1.73, 51.90]</td>
<td style="text-align: left;">0.312</td>
<td style="text-align: left;">nonnorm</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export to csv</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(CMIN_train, <span class="fu">here</span>(<span class="st">"Data/AMOX_CMIN_OBS_TRAIN.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(CMIN_test, <span class="fu">here</span>(<span class="st">"Data/AMOX_CMIN_OBS_TEST.csv"</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">quote =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-visualization-stratified-by-dosing-schemes" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="data-visualization-stratified-by-dosing-schemes"><span class="header-section-number">6.3</span> Data visualization stratified by dosing schemes</h2>
<p>The following graphs show the individual observed concentration-time curves for the data stratified by model. One graph shows the concentration-time curves for the first interdose interval and the other graph for the interdose interval after the dose which permits to reach steady state.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add dosing scheme as a categorical variable (to separate dosing schemes)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>data_ref <span class="ot">&lt;-</span> AMOX_SIM <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DOSING_SCHEME =</span> <span class="fu">paste</span>(<span class="st">"FREQ:"</span>, FREQ, <span class="st">"DOSE:"</span>, DOSE_ADM, <span class="st">"DUR:"</span>, DUR, <span class="at">sep =</span> <span class="st">" "</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>dosing_schemes <span class="ot">&lt;-</span> <span class="fu">unique</span>(data_ref<span class="sc">$</span>DOSING_SCHEME)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each dosing scheme</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>plot_dosing_schemes <span class="ot">&lt;-</span> <span class="cf">function</span>(data_ref, dosing_schemes) {</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  plot_list_before <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  plot_list_after <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(dosing_schemes)) {</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    scheme <span class="ot">&lt;-</span> dosing_schemes[i]</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract FREQ (=interdose interval)</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    scheme_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(data_ref, DOSING_SCHEME <span class="sc">==</span> scheme)</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    freq_value <span class="ot">&lt;-</span> <span class="fu">unique</span>(scheme_data<span class="sc">$</span>FREQ)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Split data before and after SS</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    data_before <span class="ot">&lt;-</span> <span class="fu">subset</span>(scheme_data, TIME <span class="sc">&lt;=</span> freq_value)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    data_after <span class="ot">&lt;-</span> <span class="fu">subset</span>(scheme_data, TIME <span class="sc">&gt;</span> TSS) <span class="sc">%&gt;%</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">TIME =</span> TIME <span class="sc">-</span> TSS)  <span class="co"># Adjust time so that it means time after SS dose</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot for before SS</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    plot_list_before[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_before, <span class="fu">aes</span>(<span class="at">x =</span> TIME, <span class="at">y =</span> IPRED, <span class="at">color =</span> MODEL, <span class="at">group =</span> ID)) <span class="sc">+</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>MODEL) <span class="sc">+</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"First interdose interval"</span>, freq_value, scheme),</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Time (h)"</span>,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"IPRED (mg/L)"</span>,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"MODEL"</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>), </span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot for after SS is reached</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>    plot_list_after[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_after, <span class="fu">aes</span>(<span class="at">x =</span> TIME, <span class="at">y =</span> IPRED, <span class="at">color =</span> MODEL, <span class="at">group =</span> ID)) <span class="sc">+</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">facet_wrap</span>(<span class="sc">~</span>MODEL) <span class="sc">+</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Steady-state"</span>, freq_value, scheme),</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Time after steady-state dose (h)"</span>,</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"IPRED (mg/L)"</span>,</span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"MODEL"</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>), </span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">before =</span> plot_list_before, <span class="at">after =</span> plot_list_after)</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>conc_profile_plots <span class="ot">&lt;-</span> <span class="fu">plot_dosing_schemes</span>(data_ref, dosing_schemes)</span>
<span id="cb14-66"><a href="#cb14-66" aria-hidden="true" tabindex="-1"></a>conc_profile_plots</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$before
$before[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="concentrations_simulation_files/figure-html/Data-visualization-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$before[[2]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="concentrations_simulation_files/figure-html/Data-visualization-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$before[[3]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="concentrations_simulation_files/figure-html/Data-visualization-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$before[[4]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="concentrations_simulation_files/figure-html/Data-visualization-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$before[[5]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="concentrations_simulation_files/figure-html/Data-visualization-5.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$before[[6]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-6.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="concentrations_simulation_files/figure-html/Data-visualization-6.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$before[[7]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-7.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="concentrations_simulation_files/figure-html/Data-visualization-7.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$before[[8]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-8.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="concentrations_simulation_files/figure-html/Data-visualization-8.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$before[[9]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-9.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="concentrations_simulation_files/figure-html/Data-visualization-9.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>

$after
$after[[1]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-10.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="concentrations_simulation_files/figure-html/Data-visualization-10.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$after[[2]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-11.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="concentrations_simulation_files/figure-html/Data-visualization-11.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$after[[3]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-12.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="concentrations_simulation_files/figure-html/Data-visualization-12.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$after[[4]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-13.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="concentrations_simulation_files/figure-html/Data-visualization-13.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$after[[5]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-14.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="concentrations_simulation_files/figure-html/Data-visualization-14.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$after[[6]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-15.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="concentrations_simulation_files/figure-html/Data-visualization-15.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$after[[7]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-16.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="concentrations_simulation_files/figure-html/Data-visualization-16.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$after[[8]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-17.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="concentrations_simulation_files/figure-html/Data-visualization-17.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
$after[[9]]</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/Data-visualization-18.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="concentrations_simulation_files/figure-html/Data-visualization-18.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Visualization of 5th, 50th and 95th percentiles (5th and 95th percentiles in dashed)</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The data is binned to 40 bins to make it smoother</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>data_percentiles_ref <span class="ot">&lt;-</span> data_ref <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TIME <span class="sc">&gt;</span> TSS) <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">TIME =</span> TIME <span class="sc">-</span> TSS) <span class="sc">|&gt;</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TIME_bin =</span> <span class="fu">ntile</span>(TIME, <span class="dv">40</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(DOSING_SCHEME, MODEL, TIME_bin) <span class="sc">%&gt;%</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">P5 =</span> <span class="fu">quantile</span>(IPRED, <span class="fl">0.05</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">P50 =</span> <span class="fu">quantile</span>(IPRED, <span class="fl">0.50</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">P95 =</span> <span class="fu">quantile</span>(IPRED, <span class="fl">0.95</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">TIME =</span> <span class="fu">median</span>(TIME, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">'drop'</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each dosing scheme</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>plot_percentiles <span class="ot">&lt;-</span> <span class="cf">function</span>(data_percentiles_ref, dosing_schemes) {</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(patchwork)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  plot_list_ref <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(dosing_schemes)) {</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    plot_list_ref[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">subset</span>(data_percentiles_ref, DOSING_SCHEME <span class="sc">==</span> dosing_schemes[i]),</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> TIME)</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> P5, <span class="at">color =</span> MODEL), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> P50, <span class="at">color =</span> MODEL), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> P95, <span class="at">color =</span> MODEL), <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(dosing_schemes[i]),</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Time post steady-state (binned)"</span>,</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"IPRED (mg/L)"</span>,</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"MODEL"</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(plot_list_ref)</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>percentile_plots <span class="ot">&lt;-</span> <span class="fu">plot_percentiles</span>(data_percentiles_ref, dosing_schemes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="appendix-what-if-you-were-interested-in-something-else-than-cmin" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="appendix-what-if-you-were-interested-in-something-else-than-cmin"><span class="header-section-number">6.4</span> Appendix : What if you were interested in something else than Cmin ?</h2>
<section id="exposure-auc" class="level3" data-number="6.4.1">
<h3 data-number="6.4.1" class="anchored" data-anchor-id="exposure-auc"><span class="header-section-number">6.4.1</span> Exposure (AUC)</h3>
<p>AUC is calculated based on the sum of the integrals of IPRED values and cumulated for both the steady-state and non stead-state inter-dose interval.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>AMOX_AUC1 <span class="ot">&lt;-</span> all_results <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, MODEL) <span class="sc">%&gt;%</span> </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ID =</span> <span class="fu">first</span>(ID),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">MODEL =</span> <span class="fu">first</span>(MODEL),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">MODEL_COHORT =</span> <span class="fu">first</span>(MODEL_COHORT),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">AUC_IND =</span> <span class="fu">sum</span>(AUC, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="co">#total AUC (based on IPRED)</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">WT =</span> <span class="fu">first</span>(WT),    </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">CREAT =</span> <span class="fu">first</span>(CREAT), </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">BURN =</span> <span class="fu">first</span>(BURN),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ICU =</span> <span class="fu">first</span>(ICU),</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">OBESE =</span> <span class="fu">first</span>(OBESE),</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">AGE =</span> <span class="fu">first</span>(AGE),</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEX =</span> <span class="fu">first</span>(SEX),</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">HT =</span> <span class="fu">first</span>(HT),</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">DUR =</span> <span class="fu">first</span>(DUR),</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">FREQ =</span> <span class="fu">first</span>(FREQ),</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">DOSE_ADM =</span> <span class="fu">first</span>(DOSE_ADM),</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">TSS =</span> <span class="fu">first</span>(TSS),</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Vc =</span> <span class="fu">first</span>(Vc),</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">CL =</span> <span class="fu">first</span>(CL)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>summarized_AUC <span class="ot">&lt;-</span> AMOX_AUC1 <span class="sc">%&gt;%</span></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(ID, MODEL, AUC_IND) </span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot for AUC</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>plot_AUC <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(summarized_AUC, <span class="fu">aes</span>(<span class="at">x =</span> MODEL, <span class="at">y =</span> AUC_IND, <span class="at">fill =</span> MODEL)) <span class="sc">+</span></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"AUC distribution"</span>, <span class="at">x =</span> <span class="st">"Model"</span>, <span class="at">y =</span> <span class="st">"AUC (mg.h/L)"</span>) <span class="sc">+</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),    </span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">24</span>),</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>plot_AUC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/AUC-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="concentrations_simulation_files/figure-html/AUC-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create test data by taking 2400 subjects (24 from each dosing scheme and 6-6 for each model covariate cohorte per dosing scheme)</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>AUC_test <span class="ot">&lt;-</span> AMOX_AUC1 <span class="sc">%&gt;%</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">6</span> <span class="sc">|</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">26</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">31</span> <span class="sc">|</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">51</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">56</span> <span class="sc">|</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">76</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">81</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create training data by taking 7600 subjects (76 from each dosing scheme and 19-19 for each model covariate cohorte per dosing scheme)</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>AUC_train <span class="ot">&lt;-</span> AMOX_AUC1 <span class="sc">%&gt;%</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>    ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">7</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">25</span> <span class="sc">|</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">32</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">50</span> <span class="sc">|</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">57</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">75</span> <span class="sc">|</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">82</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">100</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset identifyer</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>AUC_train_compare <span class="ot">&lt;-</span> AUC_train <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Dataset =</span> <span class="st">"Train"</span>)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>AUC_test_compare <span class="ot">&lt;-</span> AUC_test <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Dataset =</span> <span class="st">"Test"</span>)</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the three datasets</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>combined_AUC <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(AUC_train_compare, AUC_test_compare)</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the train and test sets</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CREAT"</span>, <span class="st">"WT"</span>, <span class="st">"AUC_IND"</span>, <span class="st">"CL"</span>, <span class="st">"Vc"</span>)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>tableOne <span class="ot">&lt;-</span> <span class="fu">CreateTableOne</span>(<span class="at">vars =</span> vars, <span class="at">strata =</span> <span class="st">"Dataset"</span>, <span class="at">data =</span> combined_AUC)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>tableOne2 <span class="ot">&lt;-</span> <span class="fu">print</span>(tableOne, <span class="at">nonnormal =</span> <span class="fu">c</span>(<span class="st">"CREAT"</span>, <span class="st">"WT"</span>, <span class="st">"AUC_IND"</span>, <span class="st">"CL"</span>, <span class="st">"Vc"</span>), <span class="at">printToggle=</span>F, <span class="at">minMax=</span>T)</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a><span class="fu">kableone</span>(tableOne2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 24%">
<col style="width: 30%">
<col style="width: 30%">
<col style="width: 5%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Test</th>
<th style="text-align: left;">Train</th>
<th style="text-align: left;">p</th>
<th style="text-align: left;">test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">n</td>
<td style="text-align: left;">600</td>
<td style="text-align: left;">1875</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">CREAT (median [range])</td>
<td style="text-align: left;">0.76 [0.24, 5.32]</td>
<td style="text-align: left;">0.77 [0.13, 8.23]</td>
<td style="text-align: left;">0.410</td>
<td style="text-align: left;">nonnorm</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT (median [range])</td>
<td style="text-align: left;">80.03 [41.33, 139.60]</td>
<td style="text-align: left;">79.99 [47.36, 141.17]</td>
<td style="text-align: left;">0.884</td>
<td style="text-align: left;">nonnorm</td>
</tr>
<tr class="even">
<td style="text-align: left;">AUC_IND (median [range])</td>
<td style="text-align: left;">39901.06 [7690.40, 1939532.48]</td>
<td style="text-align: left;">39701.47 [6336.94, 2247745.51]</td>
<td style="text-align: left;">0.926</td>
<td style="text-align: left;">nonnorm</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CL (median [range])</td>
<td style="text-align: left;">13.08 [0.68, 61.52]</td>
<td style="text-align: left;">12.70 [1.08, 71.87]</td>
<td style="text-align: left;">0.462</td>
<td style="text-align: left;">nonnorm</td>
</tr>
<tr class="even">
<td style="text-align: left;">Vc (median [range])</td>
<td style="text-align: left;">9.60 [2.17, 38.10]</td>
<td style="text-align: left;">9.42 [1.73, 51.90]</td>
<td style="text-align: left;">0.312</td>
<td style="text-align: left;">nonnorm</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="maximal-concentration-cmax" class="level3" data-number="6.4.2">
<h3 data-number="6.4.2" class="anchored" data-anchor-id="maximal-concentration-cmax"><span class="header-section-number">6.4.2</span> Maximal concentration (Cmax)</h3>
<p>Cmax is the true Cmax, not the highest observed concentration.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>AMOX_CMAX1 <span class="ot">&lt;-</span> all_results <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, MODEL) <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ID =</span> <span class="fu">first</span>(ID),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">MODEL =</span> <span class="fu">first</span>(MODEL),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">MODEL_COHORT =</span> <span class="fu">first</span>(MODEL_COHORT),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">CMAX_IND =</span> <span class="fu">max</span>(Cmax, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Cmax based on IPRED</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">WT =</span> <span class="fu">first</span>(WT), </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">CREAT =</span> <span class="fu">first</span>(CREAT), </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">BURN =</span> <span class="fu">first</span>(BURN),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ICU =</span> <span class="fu">first</span>(ICU),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">OBESE =</span> <span class="fu">first</span>(OBESE),</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">AGE =</span> <span class="fu">first</span>(AGE),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">SEX =</span> <span class="fu">first</span>(SEX),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">HT =</span> <span class="fu">first</span>(HT),</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">DUR =</span> <span class="fu">first</span>(DUR),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">FREQ =</span> <span class="fu">first</span>(FREQ),</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">DOSE_ADM =</span> <span class="fu">first</span>(DOSE_ADM),</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">TSS =</span> <span class="fu">first</span>(TSS),</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Vc =</span> <span class="fu">first</span>(Vc),</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">CL =</span> <span class="fu">first</span>(CL)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CON =</span> <span class="fu">ifelse</span>(DUR <span class="sc">==</span> <span class="dv">24</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>summarized_CMAX <span class="ot">&lt;-</span> AMOX_CMAX1 <span class="sc">%&gt;%</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(ID, MODEL, CMAX_IND)</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot for Cmax</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>plot_CMAX <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(summarized_CMAX, <span class="fu">aes</span>(<span class="at">x =</span> MODEL, <span class="at">y =</span> CMAX_IND, <span class="at">fill =</span> MODEL)) <span class="sc">+</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Cmax distribution"</span>, <span class="at">x =</span> <span class="st">"Model"</span>, <span class="at">y =</span> <span class="st">"Cmax (mg/L)"</span>) <span class="sc">+</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">30</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),    </span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>), </span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">24</span>),</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>plot_CMAX</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="concentrations_simulation_files/figure-html/CMAX-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="concentrations_simulation_files/figure-html/CMAX-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create test data by taking 2400 subjects (24 from each dosing scheme and 6-6 for each model covariate cohorte per dosing scheme)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>CMAX_test <span class="ot">&lt;-</span> AMOX_CMAX1 <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">6</span> <span class="sc">|</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">26</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">31</span> <span class="sc">|</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">51</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">56</span> <span class="sc">|</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">76</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">81</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create training data by taking 7600 subjects (76 from each dosing scheme and 19-19 for each model covariate cohorte per dosing scheme)</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>CMAX_train <span class="ot">&lt;-</span> AMOX_CMAX1 <span class="sc">%&gt;%</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">7</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">25</span> <span class="sc">|</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">32</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">50</span> <span class="sc">|</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">57</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">75</span> <span class="sc">|</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>      ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&gt;=</span> <span class="dv">82</span> <span class="sc">&amp;</span> ID <span class="sc">%%</span> <span class="dv">100</span> <span class="sc">&lt;=</span> <span class="dv">100</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset identifier</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>CMAX_train_compare <span class="ot">&lt;-</span> CMAX_train <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Dataset =</span> <span class="st">"Train"</span>)</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>CMAX_test_compare <span class="ot">&lt;-</span> CMAX_test <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Dataset =</span> <span class="st">"Test"</span>)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the three datasets</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>combined_CMAX <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(CMAX_train_compare, CMAX_test_compare)</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the train and test sets</span></span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"CREAT"</span>, <span class="st">"WT"</span>, <span class="st">"CMAX_IND"</span>, <span class="st">"CL"</span>, <span class="st">"Vc"</span>)</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>tableOne3 <span class="ot">&lt;-</span> <span class="fu">CreateTableOne</span>(<span class="at">vars =</span> vars, <span class="at">strata =</span> <span class="st">"Dataset"</span>, <span class="at">data =</span> combined_CMAX)</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>tableOne4<span class="ot">&lt;-</span><span class="fu">print</span>(tableOne3, <span class="at">nonnormal =</span> <span class="fu">c</span>(<span class="st">"CREAT"</span>, <span class="st">"WT"</span>, <span class="st">"CMAX_IND"</span>, <span class="st">"CL"</span>, <span class="st">"Vc"</span>), <span class="at">printToggle=</span>F, <span class="at">minMax=</span>T)</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a><span class="fu">kableone</span>(tableOne4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 30%">
<col style="width: 26%">
<col style="width: 26%">
<col style="width: 7%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Test</th>
<th style="text-align: left;">Train</th>
<th style="text-align: left;">p</th>
<th style="text-align: left;">test</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">n</td>
<td style="text-align: left;">600</td>
<td style="text-align: left;">1875</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">CREAT (median [range])</td>
<td style="text-align: left;">0.76 [0.24, 5.32]</td>
<td style="text-align: left;">0.77 [0.13, 8.23]</td>
<td style="text-align: left;">0.410</td>
<td style="text-align: left;">nonnorm</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT (median [range])</td>
<td style="text-align: left;">80.03 [41.33, 139.60]</td>
<td style="text-align: left;">79.99 [47.36, 141.17]</td>
<td style="text-align: left;">0.884</td>
<td style="text-align: left;">nonnorm</td>
</tr>
<tr class="even">
<td style="text-align: left;">CMAX_IND (median [range])</td>
<td style="text-align: left;">56.16 [13.38, 289.41]</td>
<td style="text-align: left;">57.91 [8.12, 443.50]</td>
<td style="text-align: left;">0.138</td>
<td style="text-align: left;">nonnorm</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CL (median [range])</td>
<td style="text-align: left;">13.08 [0.68, 61.52]</td>
<td style="text-align: left;">12.70 [1.08, 71.87]</td>
<td style="text-align: left;">0.462</td>
<td style="text-align: left;">nonnorm</td>
</tr>
<tr class="even">
<td style="text-align: left;">Vc (median [range])</td>
<td style="text-align: left;">9.60 [2.17, 38.10]</td>
<td style="text-align: left;">9.42 [1.73, 51.90]</td>
<td style="text-align: left;">0.312</td>
<td style="text-align: left;">nonnorm</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Carlier2013-bq" class="csl-entry" role="listitem">
Carlier, Mieke, Michaël Noë, Jan J De Waele, Veronique Stove, Alain G Verstraete, Jeffrey Lipman, and Jason A Roberts. 2013. <span>“Population Pharmacokinetics and Dosing Simulations of Amoxicillin/Clavulanic Acid in Critically Ill Patients.”</span> <em>J. Antimicrob. Chemother.</em> 68 (11): 2600–2608.
</div>
<div id="ref-fournier2018" class="csl-entry" role="listitem">
Fournier, Anne, Sylvain Goutelle, Yok-Ai Que, Philippe Eggimann, Olivier Pantet, Farshid Sadeghipour, Pierre Voirol, and Chantal Csajka. 2018. <span>“Population Pharmacokinetic Study of Amoxicillin-Treated Burn Patients Hospitalized at a Swiss Tertiary-Care Center.”</span> <em>Antimicrobial Agents and Chemotherapy</em> 62 (9): e00505–18. <a href="https://doi.org/10.1128/AAC.00505-18">https://doi.org/10.1128/AAC.00505-18</a>.
</div>
<div id="ref-mellon2020" class="csl-entry" role="listitem">
Mellon, G, K Hammas, C Burdet, X Duval, C Carette, N El-Helali, L Massias, F Mentré, S Czernichow, and A -C Crémieux. 2020. <span>“Population Pharmacokinetics and Dosing Simulations of Amoxicillin in Obese Adults Receiving Co-Amoxiclav.”</span> <em>Journal of Antimicrobial Chemotherapy</em> 75 (12): 3611–18. <a href="https://doi.org/10.1093/jac/dkaa368">https://doi.org/10.1093/jac/dkaa368</a>.
</div>
<div id="ref-rambaud2020" class="csl-entry" role="listitem">
Rambaud, Antoine, Benjamin Jean Gaborit, Colin Deschanvres, Paul Le Turnier, Raphaël Lecomte, Nathalie Asseray-Madani, Anne-Gaëlle Leroy, et al. 2020. <span>“Development and Validation of a Dosing Nomogram for Amoxicillin in Infective Endocarditis.”</span> <em>The Journal of Antimicrobial Chemotherapy</em> 75 (10): 2941–50. <a href="https://doi.org/10.1093/jac/dkaa232">https://doi.org/10.1093/jac/dkaa232</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../Simulations/covariate_simulation.html" class="pagination-link" aria-label="Covariate simulation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Covariate simulation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../Simulations/references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>